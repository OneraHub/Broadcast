!        Generated by TAPENADE     (INRIA, Ecuador team)
!  Tapenade 3.16 (master) -  9 Oct 2020 17:47
!
!  Differentiation of flux_num_dnc5_iso_2d in forward (tangent) mode (with options with!SliceDeadControl with!SliceDeadInstrs wit
!h!StaticTaping):
!   variations   of useful results: residu
!   with respect to varying inputs: w
!   RW status of diff variables: w:in residu:out
! This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0. If a copy of the MPL was not distributed w
!ith this file, You can obtain one at https://mozilla.org/MPL/2.0/
! =============================================================================
!          consistent fluxes for DNC5 2D
! =============================================================================
!
SUBROUTINE FLUX_NUM_DNC5_ISO_2D_D(residu, residud, w, wd, twall, x0, y0&
& , nx, ny, xc, yc, vol, volf, gh, cp, cv, prandtl, gam, rgaz, cs, muref&
& , tref, s_suth, k2, k4, im, jm)
  IMPLICIT NONE
! variables for dimension -----------------------------------------
  INTEGER :: im, jm, gh
! required arguments ----------------------------------------------
! thermo
  REAL*8, INTENT(IN) :: cp, cv, prandtl, gam, rgaz
! dissipation
  REAL*8, INTENT(IN) :: k2, k4
! viscosity
  REAL*8, INTENT(IN) :: cs, muref, tref, s_suth
  REAL*8, INTENT(IN) :: twall
  REAL*8, DIMENSION(1-gh:im+gh+1, 1-gh:jm+gh+1), INTENT(IN) :: x0
  REAL*8, DIMENSION(1-gh:im+gh+1, 1-gh:jm+gh+1), INTENT(IN) :: y0
  REAL*8, DIMENSION(1-gh:im+gh+1, 1-gh:jm+gh+1, 2), INTENT(IN) :: nx
  REAL*8, DIMENSION(1-gh:im+gh+1, 1-gh:jm+gh+1, 2), INTENT(IN) :: ny
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh), INTENT(IN) :: xc
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh), INTENT(IN) :: yc
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh), INTENT(IN) :: vol
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh, 2), INTENT(IN) :: volf
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh, 5), INTENT(IN) :: w
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh, 5), INTENT(IN) :: wd
! Returned objects ------------------------------------------------
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh, 5), INTENT(INOUT) :: residu
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh, 5), INTENT(INOUT) :: residud
! Non-required arguments -------------------------------------------
  REAL*8, DIMENSION(1-gh:im+gh+1, 1-gh:jm+gh+1, 5, 2) :: hn
  REAL*8, DIMENSION(1-gh:im+gh+1, 1-gh:jm+gh+1, 5, 2) :: hnd
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh, 5) :: f, g
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh, 5) :: fd, gd
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh) :: velx
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh) :: velxd
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh) :: vely
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh) :: velyd
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh) :: velz
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh) :: velzd
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh) :: tloc
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh) :: tlocd
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh) :: p
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh) :: pd
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh) :: mu
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh) :: mud
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh, 2) :: gradu, gradv, gradw, &
& gradmu
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh, 2) :: gradud, gradvd
  REAL*8, DIMENSION(5) :: deltar, deltal, t
  INTEGER :: i, j, h
  REAL*8 :: nx_n, nx_s, nx_e, nx_o, volm1, ux, vx, wx, tx
  REAL*8 :: uxd, vxd, wxd, txd
  REAL*8 :: ny_n, ny_s, ny_e, ny_o, uy, vy, wy, ty
  REAL*8 :: uyd, vyd, wyd, tyd
  REAL*8 :: val_n, val_s, val_e, val_o
  REAL*8 :: val_nd, val_sd, val_ed, val_od
  REAL*8 :: fxro1, fxro2, fxrou1, fxrou2, fxrov1, fxrov2, fxrow1, fxrow2&
& , fxroe1, fxroe2
  REAL*8 :: fxro1d, fxro2d, fxrou1d, fxrou2d, fxrov1d, fxrov2d, fxrow1d&
& , fxrow2d, fxroe1d, fxroe2d
  REAL*8 :: fvro1, fvro2, fvrou1, fvrou2, fvrov1, fvrov2, fvrow1, fvrow2&
& , fvroe1, fvroe2
  REAL*8 :: fvrou1d, fvrou2d, fvrov1d, fvrov2d, fvrow1d, fvrow2d, &
& fvroe1d, fvroe2d
  REAL*8 :: gvro1, gvro2, gvrou1, gvrou2, gvrov1, gvrov2, gvrow1, gvrow2&
& , gvroe1, gvroe2
  REAL*8 :: gvrou1d, gvrou2d, gvrov1d, gvrov2d, gvrow1d, gvrow2d, &
& gvroe1d, gvroe2d
  REAL*8 :: dissro1, dissro2, dissrou1, dissrou2, dissrov1, dissrov2, &
& dissrow1, dissrow2, dissroe1, dissroe2
  REAL*8 :: dissro1d, dissro2d, dissrou1d, dissrou2d, dissrov1d, &
& dissrov2d, dissrow1d, dissrow2d, dissroe1d, dissroe2d
  REAL*8 :: cpprandtl, mmu, lambda, uu, vv, ww, ro, rom1, htot, eloc, ec
  REAL*8 :: mmud, lambdad, uud, vvd, wwd, rod, rom1d, htotd, elocd, ecd
  REAL*8 :: predro1, predrou1, predrov1, predrow1, predroe1, eps2, eps4
  REAL*8 :: predro1d, predrou1d, predrov1d, predrow1d, predroe1d, eps2d&
& , eps4d
  REAL*8 :: predro2, predrou2, predrov2, predrow2, predroe2, rspec
  REAL*8 :: predro2d, predrou2d, predrov2d, predrow2d, predroe2d, rspecd
  REAL*8 :: divu, divu2, vort2, dx, dy, dxm1, dym1, dxm2, dym2
  REAL*8 :: divud, divu2d, vort2d, dxm1d, dxm2d
  REAL*8 :: nxloc, nyloc, sn, invsn, sc1, sc2
  REAL*8 :: gui, gvi, gwi, gmui
  REAL*8 :: guid, gvid
  REAL*8 :: guj, gvj, gwj, gmuj
  REAL*8 :: gujd, gvjd
  REAL*8 :: rhom, rhomr, rhoml, rhom1l, c2l, c2r, rr, r, u, ur, ul, vr, &
& vl, wr, wl, c2x, nx2, ny2
  REAL*8 :: rhomrd, rhomld, c2ld, c2rd, rrd, rd, ud, urd, uld, vrd, vld&
& , c2xd
  REAL*8 :: ab, sq, ducros1, ducros2, k_sensor1, k_sensor2
  REAL*8 :: abd, sqd, ducros1d, ducros2d, k_sensor1d, k_sensor2d
  REAL*8 :: b1, b2, b3, b4, b5, c1, c2, c3, c4, c5, d1, d2, d3, wiggle, &
& denom, betas
  REAL*8 :: c5d0, c5d1, c5d2, c5d3, c5d4, c5d5
  REAL*8 :: c3d0, c3d1, c3d2, c3d3, c3d4, c3d5
  REAL*8 :: pw, ct0, ct1, ct2, omrr, coef, test, diffro, diffrou, &
& diffrov, diffrow, diffroe, v
  REAL*8 :: pwd, omrrd, coefd, diffrod, diffroud, diffrovd, diffrowd, &
& diffroed, vd
  REAL*8 :: half, one, zero, two, twothird, fourth, twelfth, cvm1
  REAL*8 :: twentyfourth, ccross
  REAL*8 :: mach2, alpha, vn2, cprim
  INTRINSIC SQRT
  INTRINSIC ABS
  INTRINSIC TANH
  INTRINSIC MAX
  REAL*8 :: x1
  REAL*8 :: x1d
  REAL*8 :: x2
  REAL*8 :: x2d
  REAL*8 :: x3
  REAL*8 :: x3d
  REAL*8 :: x4
  REAL*8 :: x4d
  REAL*8 :: x5
  REAL*8 :: x5d
  REAL*8 :: x6
  REAL*8 :: x6d
  REAL*8 :: x7
  REAL*8 :: x7d
  REAL*8 :: x8
  REAL*8 :: x8d
  REAL*8 :: x9
  REAL*8 :: x9d
  REAL*8 :: x10
  REAL*8 :: x10d
  REAL*8 :: x11
  REAL*8 :: x11d
  REAL*8 :: x12
  REAL*8 :: x12d
  REAL*8 :: x13
  REAL*8 :: x13d
  REAL*8 :: x14
  REAL*8 :: x14d
  REAL*8 :: x15
  REAL*8 :: x15d
  REAL*8 :: x16
  REAL*8 :: x16d
  REAL*8 :: x17
  REAL*8 :: x17d
  REAL*8 :: x18
  REAL*8 :: x18d
  REAL*8 :: x19
  REAL*8 :: x19d
  REAL*8 :: x20
  REAL*8 :: x20d
  REAL*8 :: x21
  REAL*8 :: x21d
  REAL*8 :: abs0
  REAL*8 :: abs0d
  REAL*8 :: abs1
  REAL*8 :: abs1d
  REAL*8 :: max1
  REAL*8 :: max1d
  REAL*8 :: abs2
  REAL*8 :: abs2d
  REAL*8 :: abs3
  REAL*8 :: abs3d
  REAL*8 :: max2
  REAL*8 :: max2d
  REAL*8 :: abs4
  REAL*8 :: abs4d
  REAL*8 :: abs5
  REAL*8 :: abs5d
  REAL*8 :: max3
  REAL*8 :: max3d
  REAL*8 :: abs6
  REAL*8 :: abs6d
  REAL*8 :: abs7
  REAL*8 :: abs7d
  REAL*8 :: max4
  REAL*8 :: max4d
  REAL*8 :: abs8
  REAL*8 :: abs8d
  REAL*8 :: abs9
  REAL*8 :: abs9d
  REAL*8 :: max5
  REAL*8 :: max5d
  REAL*8 :: abs10
  REAL*8 :: abs10d
  REAL*8 :: abs11
  REAL*8 :: abs11d
  REAL*8 :: max6
  REAL*8 :: max6d
  REAL*8 :: abs12
  REAL*8 :: abs12d
  REAL*8 :: abs13
  REAL*8 :: abs13d
  REAL*8 :: max7
  REAL*8 :: max7d
  REAL*8 :: abs14
  REAL*8 :: abs14d
  REAL*8 :: abs15
  REAL*8 :: abs15d
  REAL*8 :: max8
  REAL*8 :: max8d
  REAL*8 :: abs16
  REAL*8 :: abs16d
  REAL*8 :: abs17
  REAL*8 :: abs17d
  REAL*8 :: max9
  REAL*8 :: max9d
  REAL*8 :: abs18
  REAL*8 :: abs18d
  REAL*8 :: abs19
  REAL*8 :: abs19d
  REAL*8 :: max10
  REAL*8 :: max10d
  REAL*8 :: abs20
  REAL*8 :: abs20d
  REAL*8 :: abs21
  REAL*8 :: abs21d
  REAL*8 :: max11
  REAL*8 :: max11d
  REAL*8 :: abs22
  REAL*8 :: abs22d
  REAL*8 :: abs23
  REAL*8 :: abs23d
  REAL*8 :: max12
  REAL*8 :: max12d
  REAL*8 :: abs24
  REAL*8 :: abs24d
  REAL*8 :: abs25
  REAL*8 :: abs25d
  REAL*8 :: max13
  REAL*8 :: max13d
  REAL*8 :: abs26
  REAL*8 :: abs26d
  REAL*8 :: abs27
  REAL*8 :: abs27d
  REAL*8 :: max14
  REAL*8 :: max14d
  REAL*8 :: max15
  REAL*8 :: max15d
  REAL*8 :: max16
  REAL*8 :: max16d
  REAL*8 :: max17
  REAL*8 :: max17d
  REAL*8 :: max18
  REAL*8 :: max18d
  REAL*8 :: max19
  REAL*8 :: max19d
  REAL*8 :: max20
  REAL*8 :: max20d
  REAL*8 :: max21
  REAL*8 :: max21d
  REAL*8 :: result1
  REAL*8 :: result1d
  REAL*8 :: arg1
  REAL*8 :: arg1d
  REAL*8 :: arg2
  REAL*8 :: arg2d
  REAL*8 :: temp
  REAL*8 :: temp0
! -----------------------------------------------------------------
!
  half = 0.5d0
  one = 1.d0
  zero = 0.d0
  two = 2.d0
  twothird = 2.d0/3.d0
  fourth = 0.25d0
  twelfth = 0.25d0/3.d0
  cpprandtl = cp/prandtl
  cvm1 = one/cv
  twentyfourth = one/24.d0
  ccross = twelfth*0.0625d0
! k2 = 1.d0
! k4 = 1.d0/60d0 already in coef for predictor
! Coef for grad o4
  denom = 1.d0/12.d0
  b1 = 8.d0*denom
  b2 = -denom
! Coef for grad o6
  denom = 1.d0/60.d0
! b1 =  45.d0 * denom
! b2 = - 9.d0 * denom
! b3 =          denom
!expression for FV
! c3 = b3
! c2 = c3 + b2
! c1 = c2 + b1
  c1 = 37.d0*denom
  c2 = -(8.d0*denom)
  c3 = denom
!predictor
  d1 = 10.d0*denom
  d2 = 5.d0*denom
  d3 = denom
! for Sutherland
  result1 = SQRT(tref)
  betas = muref*(tref+cs)/(result1*tref)
  fd = 0.0_8
  gd = 0.0_8
  pd = 0.0_8
  velxd = 0.0_8
  velyd = 0.0_8
  velzd = 0.0_8
  tlocd = 0.0_8
  mud = 0.0_8
! Primitives
  DO j=1-gh,jm+gh
!DIR$ IVDEP
    DO i=1-gh,im+gh
      rod = wd(i, j, 1)
      ro = w(i, j, 1)
      rom1d = -(one*rod/ro**2)
      rom1 = one/ro
      velxd(i, j) = rom1*wd(i, j, 2) + w(i, j, 2)*rom1d
      velx(i, j) = w(i, j, 2)*rom1
      velyd(i, j) = rom1*wd(i, j, 3) + w(i, j, 3)*rom1d
      vely(i, j) = w(i, j, 3)*rom1
      velzd(i, j) = rom1*wd(i, j, 4) + w(i, j, 4)*rom1d
      velz(i, j) = w(i, j, 4)*rom1
!
      ecd = half*(2*velx(i, j)*velxd(i, j)+2*vely(i, j)*velyd(i, j)+2*&
&       velz(i, j)*velzd(i, j))
      ec = half*(velx(i, j)*velx(i, j)+vely(i, j)*vely(i, j)+velz(i, j)*&
&       velz(i, j))
! ec  = HALF*( velx(i,j)*velx(i,j) &
!            + vely(i,j)*vely(i,j))
!
      temp = w(i, j, 5) - ec*ro
      elocd = rom1*(wd(i, j, 5)-ro*ecd-ec*rod) + temp*rom1d
      eloc = temp*rom1
!
      tlocd(i, j) = cvm1*elocd
      tloc(i, j) = eloc*cvm1
!
      pd(i, j) = (gam-one)*(eloc*rod+ro*elocd)
      p(i, j) = (gam-one)*ro*eloc
!  p(i,j)  = ro*rgaz*tloc(i,j)
      temp = w(i, j, 5) + p(i, j)
      htotd = rom1*(wd(i, j, 5)+pd(i, j)) + temp*rom1d
      htot = temp*rom1
      fd(i, j, 1) = wd(i, j, 2)
      fd(i, j, 2) = velx(i, j)*wd(i, j, 2) + w(i, j, 2)*velxd(i, j) + pd&
&       (i, j)
      fd(i, j, 3) = vely(i, j)*wd(i, j, 2) + w(i, j, 2)*velyd(i, j)
      fd(i, j, 4) = velz(i, j)*wd(i, j, 2) + w(i, j, 2)*velzd(i, j)
      fd(i, j, 5) = htot*wd(i, j, 2) + w(i, j, 2)*htotd
      gd(i, j, 1) = wd(i, j, 3)
      gd(i, j, 2) = velx(i, j)*wd(i, j, 3) + w(i, j, 3)*velxd(i, j)
      gd(i, j, 3) = vely(i, j)*wd(i, j, 3) + w(i, j, 3)*velyd(i, j) + pd&
&       (i, j)
      gd(i, j, 4) = velz(i, j)*wd(i, j, 3) + w(i, j, 3)*velzd(i, j)
      gd(i, j, 5) = htot*wd(i, j, 3) + w(i, j, 3)*htotd
!h(i,j,1)  = w(i,j,4)
!h(i,j,2)  = w(i,j,4) * velx(i,j)
!h(i,j,3)  = w(i,j,4) * vely(i,j)
!h(i,j,4)  = w(i,j,4) * velz(i,j) + p(i,j)
!h(i,j,5)  = w(i,j,4) * htot
      temp = SQRT(tloc(i, j))
      IF (tloc(i, j) .EQ. 0.0) THEN
        result1d = 0.0_8
      ELSE
        result1d = tlocd(i, j)/(2.0*temp)
      END IF
      result1 = temp
      temp = result1*tloc(i, j)/(s_suth+tloc(i, j))
      mud(i, j) = betas*(tloc(i, j)*result1d+(result1-temp)*tlocd(i, j))&
&       /(s_suth+tloc(i, j))
      mu(i, j) = betas*temp
    END DO
  END DO
  gradud = 0.0_8
  gradvd = 0.0_8
  DO j=1,jm
!DIR$ IVDEP
    DO i=1,im
! #include "rhs/gradop_7pi.F"
! #include "rhs/gradop_7pj.F"
!idir
      guid = b1*(velxd(i+1, j)-velxd(i-1, j)) + b2*(velxd(i+2, j)-velxd(&
&       i-2, j))
      gui = b1*(velx(i+1, j)-velx(i-1, j)) + b2*(velx(i+2, j)-velx(i-2, &
&       j))
      gvid = b1*(velyd(i+1, j)-velyd(i-1, j)) + b2*(velyd(i+2, j)-velyd(&
&       i-2, j))
      gvi = b1*(vely(i+1, j)-vely(i-1, j)) + b2*(vely(i+2, j)-vely(i-2, &
&       j))
!jdir
      gujd = b1*(velxd(i, j+1)-velxd(i, j-1)) + b2*(velxd(i, j+2)-velxd(&
&       i, j-2))
      guj = b1*(velx(i, j+1)-velx(i, j-1)) + b2*(velx(i, j+2)-velx(i, j-&
&       2))
      gvjd = b1*(velyd(i, j+1)-velyd(i, j-1)) + b2*(velyd(i, j+2)-velyd(&
&       i, j-2))
      gvj = b1*(vely(i, j+1)-vely(i, j-1)) + b2*(vely(i, j+2)-vely(i, j-&
&       2))
      volm1 = one/vol(i, j)
      dxm1 = half*(nx(i, j, 1)+nx(i+1, j, 1))*volm1
      dxm2 = half*(nx(i, j, 2)+nx(i, j+1, 2))*volm1
      dym1 = half*(ny(i, j, 1)+ny(i+1, j, 1))*volm1
      dym2 = half*(ny(i, j, 2)+ny(i, j+1, 2))*volm1
      gradud(i, j, 1) = dxm1*guid + dxm2*gujd
      gradu(i, j, 1) = dxm1*gui + dxm2*guj
      gradvd(i, j, 1) = dxm1*gvid + dxm2*gvjd
      gradv(i, j, 1) = dxm1*gvi + dxm2*gvj
      gradud(i, j, 2) = dym1*guid + dym2*gujd
      gradu(i, j, 2) = dym1*gui + dym2*guj
      gradvd(i, j, 2) = dym1*gvid + dym2*gvjd
      gradv(i, j, 2) = dym1*gvi + dym2*gvj
    END DO
  END DO
!
! trick for ducros in dissipation
  DO i=1,2
    DO h=1,gh
      gradud(:, 1-h, :) = two*gradud(:, 2-h, :) - gradud(:, 3-h, :)
      gradu(:, 1-h, :) = two*gradu(:, 2-h, :) - gradu(:, 3-h, :)
      gradvd(:, 1-h, :) = two*gradvd(:, 2-h, :) - gradvd(:, 3-h, :)
      gradv(:, 1-h, :) = two*gradv(:, 2-h, :) - gradv(:, 3-h, :)
      gradud(:, jm+h, :) = two*gradud(:, jm-1+h, :) - gradud(:, jm-2+h, &
&       :)
      gradu(:, jm+h, :) = two*gradu(:, jm-1+h, :) - gradu(:, jm-2+h, :)
      gradvd(:, jm+h, :) = two*gradvd(:, jm-1+h, :) - gradvd(:, jm-2+h, &
&       :)
      gradv(:, jm+h, :) = two*gradv(:, jm-1+h, :) - gradv(:, jm-2+h, :)
      gradud(1-h, :, :) = two*gradud(2-h, :, :) - gradud(3-h, :, :)
      gradu(1-h, :, :) = two*gradu(2-h, :, :) - gradu(3-h, :, :)
      gradvd(1-h, :, :) = two*gradvd(2-h, :, :) - gradvd(3-h, :, :)
      gradv(1-h, :, :) = two*gradv(2-h, :, :) - gradv(3-h, :, :)
      gradud(im+h, :, :) = two*gradud(im-1+h, :, :) - gradud(im-2+h, :, &
&       :)
      gradu(im+h, :, :) = two*gradu(im-1+h, :, :) - gradu(im-2+h, :, :)
      gradvd(im+h, :, :) = two*gradvd(im-1+h, :, :) - gradvd(im-2+h, :, &
&       :)
      gradv(im+h, :, :) = two*gradv(im-1+h, :, :) - gradv(im-2+h, :, :)
    END DO
  END DO
  hnd = 0.0_8
  DO j=4,jm+1
!DIR$ IVDEP
    DO i=1,im+1
!
      fxro1d = nx(i, j, 1)*(c1*(fd(i, j, 1)+fd(i-1, j, 1))+c2*(fd(i+1, j&
&       , 1)+fd(i-2, j, 1))+c3*(fd(i+2, j, 1)+fd(i-3, j, 1))) + ny(i, j&
&       , 1)*(c1*(gd(i, j, 1)+gd(i-1, j, 1))+c2*(gd(i+1, j, 1)+gd(i-2, j&
&       , 1))+c3*(gd(i+2, j, 1)+gd(i-3, j, 1)))
      fxrou1d = nx(i, j, 1)*(c1*(fd(i, j, 2)+fd(i-1, j, 2))+c2*(fd(i+1, &
&       j, 2)+fd(i-2, j, 2))+c3*(fd(i+2, j, 2)+fd(i-3, j, 2))) + ny(i, j&
&       , 1)*(c1*(gd(i, j, 2)+gd(i-1, j, 2))+c2*(gd(i+1, j, 2)+gd(i-2, j&
&       , 2))+c3*(gd(i+2, j, 2)+gd(i-3, j, 2)))
      fxrov1d = nx(i, j, 1)*(c1*(fd(i, j, 3)+fd(i-1, j, 3))+c2*(fd(i+1, &
&       j, 3)+fd(i-2, j, 3))+c3*(fd(i+2, j, 3)+fd(i-3, j, 3))) + ny(i, j&
&       , 1)*(c1*(gd(i, j, 3)+gd(i-1, j, 3))+c2*(gd(i+1, j, 3)+gd(i-2, j&
&       , 3))+c3*(gd(i+2, j, 3)+gd(i-3, j, 3)))
      fxrow1d = nx(i, j, 1)*(c1*(fd(i, j, 4)+fd(i-1, j, 4))+c2*(fd(i+1, &
&       j, 4)+fd(i-2, j, 4))+c3*(fd(i+2, j, 4)+fd(i-3, j, 4))) + ny(i, j&
&       , 1)*(c1*(gd(i, j, 4)+gd(i-1, j, 4))+c2*(gd(i+1, j, 4)+gd(i-2, j&
&       , 4))+c3*(gd(i+2, j, 4)+gd(i-3, j, 4)))
      fxroe1d = nx(i, j, 1)*(c1*(fd(i, j, 5)+fd(i-1, j, 5))+c2*(fd(i+1, &
&       j, 5)+fd(i-2, j, 5))+c3*(fd(i+2, j, 5)+fd(i-3, j, 5))) + ny(i, j&
&       , 1)*(c1*(gd(i, j, 5)+gd(i-1, j, 5))+c2*(gd(i+1, j, 5)+gd(i-2, j&
&       , 5))+c3*(gd(i+2, j, 5)+gd(i-3, j, 5)))
      fxro2d = nx(i, j, 2)*(c1*(fd(i, j, 1)+fd(i, j-1, 1))+c2*(fd(i, j+1&
&       , 1)+fd(i, j-2, 1))+c3*(fd(i, j+2, 1)+fd(i, j-3, 1))) + ny(i, j&
&       , 2)*(c1*(gd(i, j, 1)+gd(i, j-1, 1))+c2*(gd(i, j+1, 1)+gd(i, j-2&
&       , 1))+c3*(gd(i, j+2, 1)+gd(i, j-3, 1)))
      fxrou2d = nx(i, j, 2)*(c1*(fd(i, j, 2)+fd(i, j-1, 2))+c2*(fd(i, j+&
&       1, 2)+fd(i, j-2, 2))+c3*(fd(i, j+2, 2)+fd(i, j-3, 2))) + ny(i, j&
&       , 2)*(c1*(gd(i, j, 2)+gd(i, j-1, 2))+c2*(gd(i, j+1, 2)+gd(i, j-2&
&       , 2))+c3*(gd(i, j+2, 2)+gd(i, j-3, 2)))
      fxrov2d = nx(i, j, 2)*(c1*(fd(i, j, 3)+fd(i, j-1, 3))+c2*(fd(i, j+&
&       1, 3)+fd(i, j-2, 3))+c3*(fd(i, j+2, 3)+fd(i, j-3, 3))) + ny(i, j&
&       , 2)*(c1*(gd(i, j, 3)+gd(i, j-1, 3))+c2*(gd(i, j+1, 3)+gd(i, j-2&
&       , 3))+c3*(gd(i, j+2, 3)+gd(i, j-3, 3)))
      fxrow2d = nx(i, j, 2)*(c1*(fd(i, j, 4)+fd(i, j-1, 4))+c2*(fd(i, j+&
&       1, 4)+fd(i, j-2, 4))+c3*(fd(i, j+2, 4)+fd(i, j-3, 4))) + ny(i, j&
&       , 2)*(c1*(gd(i, j, 4)+gd(i, j-1, 4))+c2*(gd(i, j+1, 4)+gd(i, j-2&
&       , 4))+c3*(gd(i, j+2, 4)+gd(i, j-3, 4)))
      fxroe2d = nx(i, j, 2)*(c1*(fd(i, j, 5)+fd(i, j-1, 5))+c2*(fd(i, j+&
&       1, 5)+fd(i, j-2, 5))+c3*(fd(i, j+2, 5)+fd(i, j-3, 5))) + ny(i, j&
&       , 2)*(c1*(gd(i, j, 5)+gd(i, j-1, 5))+c2*(gd(i, j+1, 5)+gd(i, j-2&
&       , 5))+c3*(gd(i, j+2, 5)+gd(i, j-3, 5)))
      predro1d = d2*wd(i-2, j, 1) - d3*wd(i-3, j, 1) - d1*wd(i-1, j, 1) &
&       + d1*wd(i, j, 1) - d2*wd(i+1, j, 1) + d3*wd(i+2, j, 1)
      predro1 = -(d3*w(i-3, j, 1)) + d2*w(i-2, j, 1) - d1*w(i-1, j, 1) +&
&       d1*w(i, j, 1) - d2*w(i+1, j, 1) + d3*w(i+2, j, 1)
      predrou1d = d2*wd(i-2, j, 2) - d3*wd(i-3, j, 2) - d1*wd(i-1, j, 2)&
&       + d1*wd(i, j, 2) - d2*wd(i+1, j, 2) + d3*wd(i+2, j, 2)
      predrou1 = -(d3*w(i-3, j, 2)) + d2*w(i-2, j, 2) - d1*w(i-1, j, 2) &
&       + d1*w(i, j, 2) - d2*w(i+1, j, 2) + d3*w(i+2, j, 2)
      predrov1d = d2*wd(i-2, j, 3) - d3*wd(i-3, j, 3) - d1*wd(i-1, j, 3)&
&       + d1*wd(i, j, 3) - d2*wd(i+1, j, 3) + d3*wd(i+2, j, 3)
      predrov1 = -(d3*w(i-3, j, 3)) + d2*w(i-2, j, 3) - d1*w(i-1, j, 3) &
&       + d1*w(i, j, 3) - d2*w(i+1, j, 3) + d3*w(i+2, j, 3)
      predrow1d = d2*wd(i-2, j, 4) - d3*wd(i-3, j, 4) - d1*wd(i-1, j, 4)&
&       + d1*wd(i, j, 4) - d2*wd(i+1, j, 4) + d3*wd(i+2, j, 4)
      predrow1 = -(d3*w(i-3, j, 4)) + d2*w(i-2, j, 4) - d1*w(i-1, j, 4) &
&       + d1*w(i, j, 4) - d2*w(i+1, j, 4) + d3*w(i+2, j, 4)
      predroe1d = d2*wd(i-2, j, 5) - d3*wd(i-3, j, 5) - d1*wd(i-1, j, 5)&
&       + d1*wd(i, j, 5) - d2*wd(i+1, j, 5) + d3*wd(i+2, j, 5)
      predroe1 = -(d3*w(i-3, j, 5)) + d2*w(i-2, j, 5) - d1*w(i-1, j, 5) &
&       + d1*w(i, j, 5) - d2*w(i+1, j, 5) + d3*w(i+2, j, 5)
      predro2d = d2*wd(i, j-2, 1) - d3*wd(i, j-3, 1) - d1*wd(i, j-1, 1) &
&       + d1*wd(i, j, 1) - d2*wd(i, j+1, 1) + d3*wd(i, j+2, 1)
      predro2 = -(d3*w(i, j-3, 1)) + d2*w(i, j-2, 1) - d1*w(i, j-1, 1) +&
&       d1*w(i, j, 1) - d2*w(i, j+1, 1) + d3*w(i, j+2, 1)
      predrou2d = d2*wd(i, j-2, 2) - d3*wd(i, j-3, 2) - d1*wd(i, j-1, 2)&
&       + d1*wd(i, j, 2) - d2*wd(i, j+1, 2) + d3*wd(i, j+2, 2)
      predrou2 = -(d3*w(i, j-3, 2)) + d2*w(i, j-2, 2) - d1*w(i, j-1, 2) &
&       + d1*w(i, j, 2) - d2*w(i, j+1, 2) + d3*w(i, j+2, 2)
      predrov2d = d2*wd(i, j-2, 3) - d3*wd(i, j-3, 3) - d1*wd(i, j-1, 3)&
&       + d1*wd(i, j, 3) - d2*wd(i, j+1, 3) + d3*wd(i, j+2, 3)
      predrov2 = -(d3*w(i, j-3, 3)) + d2*w(i, j-2, 3) - d1*w(i, j-1, 3) &
&       + d1*w(i, j, 3) - d2*w(i, j+1, 3) + d3*w(i, j+2, 3)
      predrow2d = d2*wd(i, j-2, 4) - d3*wd(i, j-3, 4) - d1*wd(i, j-1, 4)&
&       + d1*wd(i, j, 4) - d2*wd(i, j+1, 4) + d3*wd(i, j+2, 4)
      predrow2 = -(d3*w(i, j-3, 4)) + d2*w(i, j-2, 4) - d1*w(i, j-1, 4) &
&       + d1*w(i, j, 4) - d2*w(i, j+1, 4) + d3*w(i, j+2, 4)
      predroe2d = d2*wd(i, j-2, 5) - d3*wd(i, j-3, 5) - d1*wd(i, j-1, 5)&
&       + d1*wd(i, j, 5) - d2*wd(i, j+1, 5) + d3*wd(i, j+2, 5)
      predroe2 = -(d3*w(i, j-3, 5)) + d2*w(i, j-2, 5) - d1*w(i, j-1, 5) &
&       + d1*w(i, j, 5) - d2*w(i, j+1, 5) + d3*w(i, j+2, 5)
! grad for viscous fluxes o4 - 5p
! for coef ref Zhing et al, JCP2000 ou Shen et al AIAAP 2008
! 1/16 = 0.0625 ccross = 1/12*1/16
! TWENTYFOURTH = ONE/24.d0
! ccros = TWELFTH*0.0625d0
      volm1 = volf(i, j, 1)
      nx_n = half*(nx(i+1, j, 1)+nx(i, j, 1))
      nx_s = -(half*(nx(i-1, j, 1)+nx(i, j, 1)))
      nx_o = half*(nx(i-1, j+1, 2)+nx(i, j+1, 2))
      nx_e = -(half*(nx(i-1, j, 2)+nx(i, j, 2)))
!
      ny_n = half*(ny(i+1, j, 1)+ny(i, j, 1))
      ny_s = -(half*(ny(i-1, j, 1)+ny(i, j, 1)))
      ny_o = half*(ny(i-1, j+1, 2)+ny(i, j+1, 2))
      ny_e = -(half*(ny(i-1, j, 2)+ny(i, j, 2)))
      val_nd = twentyfourth*(26.d0*velxd(i, j)-velxd(i+1, j)-velxd(i-1, &
&       j))
      val_n = twentyfourth*(-velx(i+1, j)+26.d0*velx(i, j)-velx(i-1, j))
      val_sd = twentyfourth*(26.d0*velxd(i-1, j)-velxd(i, j)-velxd(i-2, &
&       j))
      val_s = twentyfourth*(-velx(i, j)+26.d0*velx(i-1, j)-velx(i-2, j))
      val_ed = ccross*(velxd(i-2, j-2)-9.d0*velxd(i-1, j-2)-9.d0*velxd(i&
&       , j-2)+velxd(i+1, j-2)+7.d0*(9.d0*velxd(i-1, j-1)-velxd(i-2, j-1&
&       )+9.d0*velxd(i, j-1)-velxd(i+1, j-1))+7.d0*(9.d0*velxd(i-1, j)-&
&       velxd(i-2, j)+9.d0*velxd(i, j)-velxd(i+1, j))+velxd(i-2, j+1)-&
&       9.d0*velxd(i-1, j+1)+velxd(i+1, j+1)-9.d0*velxd(i, j+1))
      val_e = ccross*(-(-velx(i-2, j-2)+9.d0*velx(i-1, j-2)+9.d0*velx(i&
&       , j-2)-velx(i+1, j-2))+7.d0*(-velx(i-2, j-1)+9.d0*velx(i-1, j-1)&
&       +9.d0*velx(i, j-1)-velx(i+1, j-1))+7.d0*(-velx(i-2, j)+9.d0*velx&
&       (i-1, j)+9.d0*velx(i, j)-velx(i+1, j))-(-velx(i-2, j+1)+9.d0*&
&       velx(i-1, j+1)+9.d0*velx(i, j+1)-velx(i+1, j+1)))
      val_od = ccross*(velxd(i-2, j-1)-9.d0*velxd(i-1, j-1)-9.d0*velxd(i&
&       , j-1)+velxd(i+1, j-1)+7.d0*(9.d0*velxd(i-1, j)-velxd(i-2, j)+&
&       9.d0*velxd(i, j)-velxd(i+1, j))+7.d0*(9.d0*velxd(i-1, j+1)-velxd&
&       (i-2, j+1)+9.d0*velxd(i, j+1)-velxd(i+1, j+1))+velxd(i-2, j+2)-&
&       9.d0*velxd(i-1, j+2)+velxd(i+1, j+2)-9.d0*velxd(i, j+2))
      val_o = ccross*(-(-velx(i-2, j-1)+9.d0*velx(i-1, j-1)+9.d0*velx(i&
&       , j-1)-velx(i+1, j-1))+7.d0*(-velx(i-2, j)+9.d0*velx(i-1, j)+&
&       9.d0*velx(i, j)-velx(i+1, j))+7.d0*(-velx(i-2, j+1)+9.d0*velx(i-&
&       1, j+1)+9.d0*velx(i, j+1)-velx(i+1, j+1))-(-velx(i-2, j+2)+9.d0*&
&       velx(i-1, j+2)+9.d0*velx(i, j+2)-velx(i+1, j+2)))
      uxd = volm1*(nx_n*val_nd+nx_s*val_sd+nx_o*val_od+nx_e*val_ed)
      ux = (val_n*nx_n+val_s*nx_s+val_o*nx_o+val_e*nx_e)*volm1
      uyd = volm1*(ny_n*val_nd+ny_s*val_sd+ny_o*val_od+ny_e*val_ed)
      uy = (val_n*ny_n+val_s*ny_s+val_o*ny_o+val_e*ny_e)*volm1
      val_nd = twentyfourth*(26.d0*velyd(i, j)-velyd(i+1, j)-velyd(i-1, &
&       j))
      val_n = twentyfourth*(-vely(i+1, j)+26.d0*vely(i, j)-vely(i-1, j))
      val_sd = twentyfourth*(26.d0*velyd(i-1, j)-velyd(i, j)-velyd(i-2, &
&       j))
      val_s = twentyfourth*(-vely(i, j)+26.d0*vely(i-1, j)-vely(i-2, j))
      val_ed = ccross*(velyd(i-2, j-2)-9.d0*velyd(i-1, j-2)-9.d0*velyd(i&
&       , j-2)+velyd(i+1, j-2)+7.d0*(9.d0*velyd(i-1, j-1)-velyd(i-2, j-1&
&       )+9.d0*velyd(i, j-1)-velyd(i+1, j-1))+7.d0*(9.d0*velyd(i-1, j)-&
&       velyd(i-2, j)+9.d0*velyd(i, j)-velyd(i+1, j))+velyd(i-2, j+1)-&
&       9.d0*velyd(i-1, j+1)+velyd(i+1, j+1)-9.d0*velyd(i, j+1))
      val_e = ccross*(-(-vely(i-2, j-2)+9.d0*vely(i-1, j-2)+9.d0*vely(i&
&       , j-2)-vely(i+1, j-2))+7.d0*(-vely(i-2, j-1)+9.d0*vely(i-1, j-1)&
&       +9.d0*vely(i, j-1)-vely(i+1, j-1))+7.d0*(-vely(i-2, j)+9.d0*vely&
&       (i-1, j)+9.d0*vely(i, j)-vely(i+1, j))-(-vely(i-2, j+1)+9.d0*&
&       vely(i-1, j+1)+9.d0*vely(i, j+1)-vely(i+1, j+1)))
      val_od = ccross*(velyd(i-2, j-1)-9.d0*velyd(i-1, j-1)-9.d0*velyd(i&
&       , j-1)+velyd(i+1, j-1)+7.d0*(9.d0*velyd(i-1, j)-velyd(i-2, j)+&
&       9.d0*velyd(i, j)-velyd(i+1, j))+7.d0*(9.d0*velyd(i-1, j+1)-velyd&
&       (i-2, j+1)+9.d0*velyd(i, j+1)-velyd(i+1, j+1))+velyd(i-2, j+2)-&
&       9.d0*velyd(i-1, j+2)+velyd(i+1, j+2)-9.d0*velyd(i, j+2))
      val_o = ccross*(-(-vely(i-2, j-1)+9.d0*vely(i-1, j-1)+9.d0*vely(i&
&       , j-1)-vely(i+1, j-1))+7.d0*(-vely(i-2, j)+9.d0*vely(i-1, j)+&
&       9.d0*vely(i, j)-vely(i+1, j))+7.d0*(-vely(i-2, j+1)+9.d0*vely(i-&
&       1, j+1)+9.d0*vely(i, j+1)-vely(i+1, j+1))-(-vely(i-2, j+2)+9.d0*&
&       vely(i-1, j+2)+9.d0*vely(i, j+2)-vely(i+1, j+2)))
      vxd = volm1*(nx_n*val_nd+nx_s*val_sd+nx_o*val_od+nx_e*val_ed)
      vx = (val_n*nx_n+val_s*nx_s+val_o*nx_o+val_e*nx_e)*volm1
      vyd = volm1*(ny_n*val_nd+ny_s*val_sd+ny_o*val_od+ny_e*val_ed)
      vy = (val_n*ny_n+val_s*ny_s+val_o*ny_o+val_e*ny_e)*volm1
      val_nd = twentyfourth*(26.d0*velzd(i, j)-velzd(i+1, j)-velzd(i-1, &
&       j))
      val_n = twentyfourth*(-velz(i+1, j)+26.d0*velz(i, j)-velz(i-1, j))
      val_sd = twentyfourth*(26.d0*velzd(i-1, j)-velzd(i, j)-velzd(i-2, &
&       j))
      val_s = twentyfourth*(-velz(i, j)+26.d0*velz(i-1, j)-velz(i-2, j))
      val_ed = ccross*(velzd(i-2, j-2)-9.d0*velzd(i-1, j-2)-9.d0*velzd(i&
&       , j-2)+velzd(i+1, j-2)+7.d0*(9.d0*velzd(i-1, j-1)-velzd(i-2, j-1&
&       )+9.d0*velzd(i, j-1)-velzd(i+1, j-1))+7.d0*(9.d0*velzd(i-1, j)-&
&       velzd(i-2, j)+9.d0*velzd(i, j)-velzd(i+1, j))+velzd(i-2, j+1)-&
&       9.d0*velzd(i-1, j+1)+velzd(i+1, j+1)-9.d0*velzd(i, j+1))
      val_e = ccross*(-(-velz(i-2, j-2)+9.d0*velz(i-1, j-2)+9.d0*velz(i&
&       , j-2)-velz(i+1, j-2))+7.d0*(-velz(i-2, j-1)+9.d0*velz(i-1, j-1)&
&       +9.d0*velz(i, j-1)-velz(i+1, j-1))+7.d0*(-velz(i-2, j)+9.d0*velz&
&       (i-1, j)+9.d0*velz(i, j)-velz(i+1, j))-(-velz(i-2, j+1)+9.d0*&
&       velz(i-1, j+1)+9.d0*velz(i, j+1)-velz(i+1, j+1)))
      val_od = ccross*(velzd(i-2, j-1)-9.d0*velzd(i-1, j-1)-9.d0*velzd(i&
&       , j-1)+velzd(i+1, j-1)+7.d0*(9.d0*velzd(i-1, j)-velzd(i-2, j)+&
&       9.d0*velzd(i, j)-velzd(i+1, j))+7.d0*(9.d0*velzd(i-1, j+1)-velzd&
&       (i-2, j+1)+9.d0*velzd(i, j+1)-velzd(i+1, j+1))+velzd(i-2, j+2)-&
&       9.d0*velzd(i-1, j+2)+velzd(i+1, j+2)-9.d0*velzd(i, j+2))
      val_o = ccross*(-(-velz(i-2, j-1)+9.d0*velz(i-1, j-1)+9.d0*velz(i&
&       , j-1)-velz(i+1, j-1))+7.d0*(-velz(i-2, j)+9.d0*velz(i-1, j)+&
&       9.d0*velz(i, j)-velz(i+1, j))+7.d0*(-velz(i-2, j+1)+9.d0*velz(i-&
&       1, j+1)+9.d0*velz(i, j+1)-velz(i+1, j+1))-(-velz(i-2, j+2)+9.d0*&
&       velz(i-1, j+2)+9.d0*velz(i, j+2)-velz(i+1, j+2)))
      wxd = volm1*(nx_n*val_nd+nx_s*val_sd+nx_o*val_od+nx_e*val_ed)
      wx = (val_n*nx_n+val_s*nx_s+val_o*nx_o+val_e*nx_e)*volm1
      wyd = volm1*(ny_n*val_nd+ny_s*val_sd+ny_o*val_od+ny_e*val_ed)
      wy = (val_n*ny_n+val_s*ny_s+val_o*ny_o+val_e*ny_e)*volm1
      val_nd = twentyfourth*(26.d0*tlocd(i, j)-tlocd(i+1, j)-tlocd(i-1, &
&       j))
      val_n = twentyfourth*(-tloc(i+1, j)+26.d0*tloc(i, j)-tloc(i-1, j))
      val_sd = twentyfourth*(26.d0*tlocd(i-1, j)-tlocd(i, j)-tlocd(i-2, &
&       j))
      val_s = twentyfourth*(-tloc(i, j)+26.d0*tloc(i-1, j)-tloc(i-2, j))
      val_ed = ccross*(tlocd(i-2, j-2)-9.d0*tlocd(i-1, j-2)-9.d0*tlocd(i&
&       , j-2)+tlocd(i+1, j-2)+7.d0*(9.d0*tlocd(i-1, j-1)-tlocd(i-2, j-1&
&       )+9.d0*tlocd(i, j-1)-tlocd(i+1, j-1))+7.d0*(9.d0*tlocd(i-1, j)-&
&       tlocd(i-2, j)+9.d0*tlocd(i, j)-tlocd(i+1, j))+tlocd(i-2, j+1)-&
&       9.d0*tlocd(i-1, j+1)+tlocd(i+1, j+1)-9.d0*tlocd(i, j+1))
      val_e = ccross*(-(-tloc(i-2, j-2)+9.d0*tloc(i-1, j-2)+9.d0*tloc(i&
&       , j-2)-tloc(i+1, j-2))+7.d0*(-tloc(i-2, j-1)+9.d0*tloc(i-1, j-1)&
&       +9.d0*tloc(i, j-1)-tloc(i+1, j-1))+7.d0*(-tloc(i-2, j)+9.d0*tloc&
&       (i-1, j)+9.d0*tloc(i, j)-tloc(i+1, j))-(-tloc(i-2, j+1)+9.d0*&
&       tloc(i-1, j+1)+9.d0*tloc(i, j+1)-tloc(i+1, j+1)))
      val_od = ccross*(tlocd(i-2, j-1)-9.d0*tlocd(i-1, j-1)-9.d0*tlocd(i&
&       , j-1)+tlocd(i+1, j-1)+7.d0*(9.d0*tlocd(i-1, j)-tlocd(i-2, j)+&
&       9.d0*tlocd(i, j)-tlocd(i+1, j))+7.d0*(9.d0*tlocd(i-1, j+1)-tlocd&
&       (i-2, j+1)+9.d0*tlocd(i, j+1)-tlocd(i+1, j+1))+tlocd(i-2, j+2)-&
&       9.d0*tlocd(i-1, j+2)+tlocd(i+1, j+2)-9.d0*tlocd(i, j+2))
      val_o = ccross*(-(-tloc(i-2, j-1)+9.d0*tloc(i-1, j-1)+9.d0*tloc(i&
&       , j-1)-tloc(i+1, j-1))+7.d0*(-tloc(i-2, j)+9.d0*tloc(i-1, j)+&
&       9.d0*tloc(i, j)-tloc(i+1, j))+7.d0*(-tloc(i-2, j+1)+9.d0*tloc(i-&
&       1, j+1)+9.d0*tloc(i, j+1)-tloc(i+1, j+1))-(-tloc(i-2, j+2)+9.d0*&
&       tloc(i-1, j+2)+9.d0*tloc(i, j+2)-tloc(i+1, j+2)))
      txd = volm1*(nx_n*val_nd+nx_s*val_sd+nx_o*val_od+nx_e*val_ed)
      tx = (val_n*nx_n+val_s*nx_s+val_o*nx_o+val_e*nx_e)*volm1
      tyd = volm1*(ny_n*val_nd+ny_s*val_sd+ny_o*val_od+ny_e*val_ed)
      ty = (val_n*ny_n+val_s*ny_s+val_o*ny_o+val_e*ny_e)*volm1
!
! Computation of viscous fluxes
!
      uud = 0.0625d0*(9.d0*velxd(i-1, j)-velxd(i-2, j)+9.d0*velxd(i, j)-&
&       velxd(i+1, j))
      uu = 0.0625d0*(-velx(i-2, j)+9.d0*velx(i-1, j)+9.d0*velx(i, j)-&
&       velx(i+1, j))
      vvd = 0.0625d0*(9.d0*velyd(i-1, j)-velyd(i-2, j)+9.d0*velyd(i, j)-&
&       velyd(i+1, j))
      vv = 0.0625d0*(-vely(i-2, j)+9.d0*vely(i-1, j)+9.d0*vely(i, j)-&
&       vely(i+1, j))
      wwd = 0.0625d0*(9.d0*velzd(i-1, j)-velzd(i-2, j)+9.d0*velzd(i, j)-&
&       velzd(i+1, j))
      ww = 0.0625d0*(-velz(i-2, j)+9.d0*velz(i-1, j)+9.d0*velz(i, j)-&
&       velz(i+1, j))
!
      mmud = 0.0625d0*(9.d0*mud(i-1, j)-mud(i-2, j)+9.d0*mud(i, j)-mud(i&
&       +1, j))
      mmu = 0.0625d0*(-mu(i-2, j)+9.d0*mu(i-1, j)+9.d0*mu(i, j)-mu(i+1, &
&       j))
      lambdad = cpprandtl*mmud
      lambda = mmu*cpprandtl
!
      fvrou1d = twothird*((two*ux-vy)*mmud+mmu*(two*uxd-vyd))
      fvrou1 = twothird*mmu*(two*ux-vy)
      fvrov1d = (uy+vx)*mmud + mmu*(uyd+vxd)
      fvrov1 = mmu*(uy+vx)
      fvrow1d = wx*mmud + mmu*wxd
      fvrow1 = mmu*wx
      fvroe1d = tx*lambdad + lambda*txd + fvrou1*uud + uu*fvrou1d + &
&       fvrov1*vvd + vv*fvrov1d + fvrow1*wwd + ww*fvrow1d
!
      gvrou1d = (uy+vx)*mmud + mmu*(uyd+vxd)
      gvrou1 = mmu*(uy+vx)
      gvrov1d = twothird*((two*vy-ux)*mmud+mmu*(two*vyd-uxd))
      gvrov1 = twothird*mmu*(-ux+two*vy)
      gvrow1d = wy*mmud + mmu*wyd
      gvrow1 = mmu*wy
      gvroe1d = ty*lambdad + lambda*tyd + gvrou1*uud + uu*gvrou1d + &
&       gvrov1*vvd + vv*gvrov1d + gvrow1*wwd + ww*gvrow1d
!!  fvrou1 = TWOTHIRD*mmu*( TWO*ux -     vy  -   wz  )
!!  fvrov1 =          mmu*(     uy +     vx          )
!!  fvrow1 =          mmu*(     uz           +   wx  )
!!  fvroe1 = lambda*tx + uu*fvrou1 + vv*fvrov1 + ww * fvrow1
!!  !
!!  gvrou1 =          mmu*(     uy +     vx          )
!!  gvrov1 = TWOTHIRD*mmu*(    -ux + TWO*vy   -  wz  )
!!  gvrow1 =          mmu*(              vz   +  wy  )
!!  gvroe1 = lambda*ty + uu*gvrou1 + vv*gvrov1 + ww * gvrow1
! grad for viscous fluxes o4 - 5p
!
! for coef ref Zhing et al, JCP2000 ou Shen et al AIAAP 2008
! 1/16 = 0.0625 ccross = 1/12*1/16
! TWENTYFOURTH = ONE/24.d0
! ccross = TWELFTH*0.0625d0
      volm1 = volf(i, j, 2)
      nx_n = half*(nx(i+1, j-1, 1)+nx(i+1, j, 1))
      nx_s = -(half*(nx(i, j-1, 1)+nx(i, j, 1)))
      nx_o = half*(nx(i, j+1, 2)+nx(i, j, 2))
      nx_e = -(half*(nx(i, j-1, 2)+nx(i, j, 2)))
!
      ny_n = half*(ny(i+1, j-1, 1)+ny(i+1, j, 1))
      ny_s = -(half*(ny(i, j-1, 1)+ny(i, j, 1)))
      ny_o = half*(ny(i, j+1, 2)+ny(i, j, 2))
      ny_e = -(half*(ny(i, j-1, 2)+ny(i, j, 2)))
      val_nd = ccross*(velxd(i-1, j-2)-9.d0*velxd(i-1, j-1)-9.d0*velxd(i&
&       -1, j)+velxd(i-1, j+1)+7.d0*(9.d0*velxd(i, j-1)-velxd(i, j-2)+&
&       9.d0*velxd(i, j)-velxd(i, j+1))+7.d0*(9.d0*velxd(i+1, j-1)-velxd&
&       (i+1, j-2)+9.d0*velxd(i+1, j)-velxd(i+1, j+1))+velxd(i+2, j-2)-&
&       9.d0*velxd(i+2, j-1)+velxd(i+2, j+1)-9.d0*velxd(i+2, j))
      val_n = ccross*(-(-velx(i-1, j-2)+9.d0*velx(i-1, j-1)+9.d0*velx(i-&
&       1, j)-velx(i-1, j+1))+7.d0*(-velx(i, j-2)+9.d0*velx(i, j-1)+9.d0&
&       *velx(i, j)-velx(i, j+1))+7.d0*(-velx(i+1, j-2)+9.d0*velx(i+1, j&
&       -1)+9.d0*velx(i+1, j)-velx(i+1, j+1))-(-velx(i+2, j-2)+9.d0*velx&
&       (i+2, j-1)+9.d0*velx(i+2, j)-velx(i+2, j+1)))
      val_sd = ccross*(velxd(i-2, j-2)-9.d0*velxd(i-2, j-1)-9.d0*velxd(i&
&       -2, j)+velxd(i-2, j+1)+7.d0*(9.d0*velxd(i-1, j-1)-velxd(i-1, j-2&
&       )+9.d0*velxd(i-1, j)-velxd(i-1, j+1))+7.d0*(9.d0*velxd(i, j-1)-&
&       velxd(i, j-2)+9.d0*velxd(i, j)-velxd(i, j+1))+velxd(i+1, j-2)-&
&       9.d0*velxd(i+1, j-1)+velxd(i+1, j+1)-9.d0*velxd(i+1, j))
      val_s = ccross*(-(-velx(i-2, j-2)+9.d0*velx(i-2, j-1)+9.d0*velx(i-&
&       2, j)-velx(i-2, j+1))+7.d0*(-velx(i-1, j-2)+9.d0*velx(i-1, j-1)+&
&       9.d0*velx(i-1, j)-velx(i-1, j+1))+7.d0*(-velx(i, j-2)+9.d0*velx(&
&       i, j-1)+9.d0*velx(i, j)-velx(i, j+1))-(-velx(i+1, j-2)+9.d0*velx&
&       (i+1, j-1)+9.d0*velx(i+1, j)-velx(i+1, j+1)))
      val_ed = twentyfourth*(26.d0*velxd(i, j-1)-velxd(i, j)-velxd(i, j-&
&       2))
      val_e = twentyfourth*(-velx(i, j)+26.d0*velx(i, j-1)-velx(i, j-2))
      val_od = twentyfourth*(26.d0*velxd(i, j)-velxd(i, j+1)-velxd(i, j-&
&       1))
      val_o = twentyfourth*(-velx(i, j+1)+26.d0*velx(i, j)-velx(i, j-1))
      uxd = volm1*(nx_n*val_nd+nx_s*val_sd+nx_o*val_od+nx_e*val_ed)
      ux = (val_n*nx_n+val_s*nx_s+val_o*nx_o+val_e*nx_e)*volm1
      uyd = volm1*(ny_n*val_nd+ny_s*val_sd+ny_o*val_od+ny_e*val_ed)
      uy = (val_n*ny_n+val_s*ny_s+val_o*ny_o+val_e*ny_e)*volm1
      val_nd = ccross*(velyd(i-1, j-2)-9.d0*velyd(i-1, j-1)-9.d0*velyd(i&
&       -1, j)+velyd(i-1, j+1)+7.d0*(9.d0*velyd(i, j-1)-velyd(i, j-2)+&
&       9.d0*velyd(i, j)-velyd(i, j+1))+7.d0*(9.d0*velyd(i+1, j-1)-velyd&
&       (i+1, j-2)+9.d0*velyd(i+1, j)-velyd(i+1, j+1))+velyd(i+2, j-2)-&
&       9.d0*velyd(i+2, j-1)+velyd(i+2, j+1)-9.d0*velyd(i+2, j))
      val_n = ccross*(-(-vely(i-1, j-2)+9.d0*vely(i-1, j-1)+9.d0*vely(i-&
&       1, j)-vely(i-1, j+1))+7.d0*(-vely(i, j-2)+9.d0*vely(i, j-1)+9.d0&
&       *vely(i, j)-vely(i, j+1))+7.d0*(-vely(i+1, j-2)+9.d0*vely(i+1, j&
&       -1)+9.d0*vely(i+1, j)-vely(i+1, j+1))-(-vely(i+2, j-2)+9.d0*vely&
&       (i+2, j-1)+9.d0*vely(i+2, j)-vely(i+2, j+1)))
      val_sd = ccross*(velyd(i-2, j-2)-9.d0*velyd(i-2, j-1)-9.d0*velyd(i&
&       -2, j)+velyd(i-2, j+1)+7.d0*(9.d0*velyd(i-1, j-1)-velyd(i-1, j-2&
&       )+9.d0*velyd(i-1, j)-velyd(i-1, j+1))+7.d0*(9.d0*velyd(i, j-1)-&
&       velyd(i, j-2)+9.d0*velyd(i, j)-velyd(i, j+1))+velyd(i+1, j-2)-&
&       9.d0*velyd(i+1, j-1)+velyd(i+1, j+1)-9.d0*velyd(i+1, j))
      val_s = ccross*(-(-vely(i-2, j-2)+9.d0*vely(i-2, j-1)+9.d0*vely(i-&
&       2, j)-vely(i-2, j+1))+7.d0*(-vely(i-1, j-2)+9.d0*vely(i-1, j-1)+&
&       9.d0*vely(i-1, j)-vely(i-1, j+1))+7.d0*(-vely(i, j-2)+9.d0*vely(&
&       i, j-1)+9.d0*vely(i, j)-vely(i, j+1))-(-vely(i+1, j-2)+9.d0*vely&
&       (i+1, j-1)+9.d0*vely(i+1, j)-vely(i+1, j+1)))
      val_ed = twentyfourth*(26.d0*velyd(i, j-1)-velyd(i, j)-velyd(i, j-&
&       2))
      val_e = twentyfourth*(-vely(i, j)+26.d0*vely(i, j-1)-vely(i, j-2))
      val_od = twentyfourth*(26.d0*velyd(i, j)-velyd(i, j+1)-velyd(i, j-&
&       1))
      val_o = twentyfourth*(-vely(i, j+1)+26.d0*vely(i, j)-vely(i, j-1))
      vxd = volm1*(nx_n*val_nd+nx_s*val_sd+nx_o*val_od+nx_e*val_ed)
      vx = (val_n*nx_n+val_s*nx_s+val_o*nx_o+val_e*nx_e)*volm1
      vyd = volm1*(ny_n*val_nd+ny_s*val_sd+ny_o*val_od+ny_e*val_ed)
      vy = (val_n*ny_n+val_s*ny_s+val_o*ny_o+val_e*ny_e)*volm1
      val_nd = ccross*(velzd(i-1, j-2)-9.d0*velzd(i-1, j-1)-9.d0*velzd(i&
&       -1, j)+velzd(i-1, j+1)+7.d0*(9.d0*velzd(i, j-1)-velzd(i, j-2)+&
&       9.d0*velzd(i, j)-velzd(i, j+1))+7.d0*(9.d0*velzd(i+1, j-1)-velzd&
&       (i+1, j-2)+9.d0*velzd(i+1, j)-velzd(i+1, j+1))+velzd(i+2, j-2)-&
&       9.d0*velzd(i+2, j-1)+velzd(i+2, j+1)-9.d0*velzd(i+2, j))
      val_n = ccross*(-(-velz(i-1, j-2)+9.d0*velz(i-1, j-1)+9.d0*velz(i-&
&       1, j)-velz(i-1, j+1))+7.d0*(-velz(i, j-2)+9.d0*velz(i, j-1)+9.d0&
&       *velz(i, j)-velz(i, j+1))+7.d0*(-velz(i+1, j-2)+9.d0*velz(i+1, j&
&       -1)+9.d0*velz(i+1, j)-velz(i+1, j+1))-(-velz(i+2, j-2)+9.d0*velz&
&       (i+2, j-1)+9.d0*velz(i+2, j)-velz(i+2, j+1)))
      val_sd = ccross*(velzd(i-2, j-2)-9.d0*velzd(i-2, j-1)-9.d0*velzd(i&
&       -2, j)+velzd(i-2, j+1)+7.d0*(9.d0*velzd(i-1, j-1)-velzd(i-1, j-2&
&       )+9.d0*velzd(i-1, j)-velzd(i-1, j+1))+7.d0*(9.d0*velzd(i, j-1)-&
&       velzd(i, j-2)+9.d0*velzd(i, j)-velzd(i, j+1))+velzd(i+1, j-2)-&
&       9.d0*velzd(i+1, j-1)+velzd(i+1, j+1)-9.d0*velzd(i+1, j))
      val_s = ccross*(-(-velz(i-2, j-2)+9.d0*velz(i-2, j-1)+9.d0*velz(i-&
&       2, j)-velz(i-2, j+1))+7.d0*(-velz(i-1, j-2)+9.d0*velz(i-1, j-1)+&
&       9.d0*velz(i-1, j)-velz(i-1, j+1))+7.d0*(-velz(i, j-2)+9.d0*velz(&
&       i, j-1)+9.d0*velz(i, j)-velz(i, j+1))-(-velz(i+1, j-2)+9.d0*velz&
&       (i+1, j-1)+9.d0*velz(i+1, j)-velz(i+1, j+1)))
      val_ed = twentyfourth*(26.d0*velzd(i, j-1)-velzd(i, j)-velzd(i, j-&
&       2))
      val_e = twentyfourth*(-velz(i, j)+26.d0*velz(i, j-1)-velz(i, j-2))
      val_od = twentyfourth*(26.d0*velzd(i, j)-velzd(i, j+1)-velzd(i, j-&
&       1))
      val_o = twentyfourth*(-velz(i, j+1)+26.d0*velz(i, j)-velz(i, j-1))
      wxd = volm1*(nx_n*val_nd+nx_s*val_sd+nx_o*val_od+nx_e*val_ed)
      wx = (val_n*nx_n+val_s*nx_s+val_o*nx_o+val_e*nx_e)*volm1
      wyd = volm1*(ny_n*val_nd+ny_s*val_sd+ny_o*val_od+ny_e*val_ed)
      wy = (val_n*ny_n+val_s*ny_s+val_o*ny_o+val_e*ny_e)*volm1
      val_nd = ccross*(tlocd(i-1, j-2)-9.d0*tlocd(i-1, j-1)-9.d0*tlocd(i&
&       -1, j)+tlocd(i-1, j+1)+7.d0*(9.d0*tlocd(i, j-1)-tlocd(i, j-2)+&
&       9.d0*tlocd(i, j)-tlocd(i, j+1))+7.d0*(9.d0*tlocd(i+1, j-1)-tlocd&
&       (i+1, j-2)+9.d0*tlocd(i+1, j)-tlocd(i+1, j+1))+tlocd(i+2, j-2)-&
&       9.d0*tlocd(i+2, j-1)+tlocd(i+2, j+1)-9.d0*tlocd(i+2, j))
      val_n = ccross*(-(-tloc(i-1, j-2)+9.d0*tloc(i-1, j-1)+9.d0*tloc(i-&
&       1, j)-tloc(i-1, j+1))+7.d0*(-tloc(i, j-2)+9.d0*tloc(i, j-1)+9.d0&
&       *tloc(i, j)-tloc(i, j+1))+7.d0*(-tloc(i+1, j-2)+9.d0*tloc(i+1, j&
&       -1)+9.d0*tloc(i+1, j)-tloc(i+1, j+1))-(-tloc(i+2, j-2)+9.d0*tloc&
&       (i+2, j-1)+9.d0*tloc(i+2, j)-tloc(i+2, j+1)))
      val_sd = ccross*(tlocd(i-2, j-2)-9.d0*tlocd(i-2, j-1)-9.d0*tlocd(i&
&       -2, j)+tlocd(i-2, j+1)+7.d0*(9.d0*tlocd(i-1, j-1)-tlocd(i-1, j-2&
&       )+9.d0*tlocd(i-1, j)-tlocd(i-1, j+1))+7.d0*(9.d0*tlocd(i, j-1)-&
&       tlocd(i, j-2)+9.d0*tlocd(i, j)-tlocd(i, j+1))+tlocd(i+1, j-2)-&
&       9.d0*tlocd(i+1, j-1)+tlocd(i+1, j+1)-9.d0*tlocd(i+1, j))
      val_s = ccross*(-(-tloc(i-2, j-2)+9.d0*tloc(i-2, j-1)+9.d0*tloc(i-&
&       2, j)-tloc(i-2, j+1))+7.d0*(-tloc(i-1, j-2)+9.d0*tloc(i-1, j-1)+&
&       9.d0*tloc(i-1, j)-tloc(i-1, j+1))+7.d0*(-tloc(i, j-2)+9.d0*tloc(&
&       i, j-1)+9.d0*tloc(i, j)-tloc(i, j+1))-(-tloc(i+1, j-2)+9.d0*tloc&
&       (i+1, j-1)+9.d0*tloc(i+1, j)-tloc(i+1, j+1)))
      val_ed = twentyfourth*(26.d0*tlocd(i, j-1)-tlocd(i, j)-tlocd(i, j-&
&       2))
      val_e = twentyfourth*(-tloc(i, j)+26.d0*tloc(i, j-1)-tloc(i, j-2))
      val_od = twentyfourth*(26.d0*tlocd(i, j)-tlocd(i, j+1)-tlocd(i, j-&
&       1))
      val_o = twentyfourth*(-tloc(i, j+1)+26.d0*tloc(i, j)-tloc(i, j-1))
      txd = volm1*(nx_n*val_nd+nx_s*val_sd+nx_o*val_od+nx_e*val_ed)
      tx = (val_n*nx_n+val_s*nx_s+val_o*nx_o+val_e*nx_e)*volm1
      tyd = volm1*(ny_n*val_nd+ny_s*val_sd+ny_o*val_od+ny_e*val_ed)
      ty = (val_n*ny_n+val_s*ny_s+val_o*ny_o+val_e*ny_e)*volm1
      uud = 0.0625d0*(9.d0*velxd(i, j-1)-velxd(i, j-2)+9.d0*velxd(i, j)-&
&       velxd(i, j+1))
      uu = 0.0625d0*(-velx(i, j-2)+9.d0*velx(i, j-1)+9.d0*velx(i, j)-&
&       velx(i, j+1))
      vvd = 0.0625d0*(9.d0*velyd(i, j-1)-velyd(i, j-2)+9.d0*velyd(i, j)-&
&       velyd(i, j+1))
      vv = 0.0625d0*(-vely(i, j-2)+9.d0*vely(i, j-1)+9.d0*vely(i, j)-&
&       vely(i, j+1))
      wwd = 0.0625d0*(9.d0*velzd(i, j-1)-velzd(i, j-2)+9.d0*velzd(i, j)-&
&       velzd(i, j+1))
      ww = 0.0625d0*(-velz(i, j-2)+9.d0*velz(i, j-1)+9.d0*velz(i, j)-&
&       velz(i, j+1))
!
      mmud = 0.0625d0*(9.d0*mud(i, j-1)-mud(i, j-2)+9.d0*mud(i, j)-mud(i&
&       , j+1))
      mmu = 0.0625d0*(-mu(i, j-2)+9.d0*mu(i, j-1)+9.d0*mu(i, j)-mu(i, j+&
&       1))
      lambdad = cpprandtl*mmud
      lambda = mmu*cpprandtl
!
      fvrou2d = twothird*((two*ux-vy)*mmud+mmu*(two*uxd-vyd))
      fvrou2 = twothird*mmu*(two*ux-vy)
      fvrov2d = (uy+vx)*mmud + mmu*(uyd+vxd)
      fvrov2 = mmu*(uy+vx)
      fvrow2d = wx*mmud + mmu*wxd
      fvrow2 = mmu*wx
      fvroe2d = tx*lambdad + lambda*txd + fvrou2*uud + uu*fvrou2d + &
&       fvrov2*vvd + vv*fvrov2d + fvrow2*wwd + ww*fvrow2d
      gvrou2d = (uy+vx)*mmud + mmu*(uyd+vxd)
      gvrou2 = mmu*(uy+vx)
      gvrov2d = twothird*((two*vy-ux)*mmud+mmu*(two*vyd-uxd))
      gvrov2 = twothird*mmu*(-ux+two*vy)
      gvrow2d = wy*mmud + mmu*wyd
      gvrow2 = mmu*wy
      gvroe2d = ty*lambdad + lambda*tyd + gvrou2*uud + uu*gvrou2d + &
&       gvrov2*vvd + vv*gvrov2d + gvrow2*wwd + ww*gvrow2d
!!  fvrou2 = TWOTHIRD*mmu*( TWO*ux -     vy  -  wz  )
!!  fvrov2 =          mmu*(     uy +     vx         )
!!  fvrow2 =          mmu*(     uz           +  wx  )
!!  fvroe2 = (lambda*tx + uu*fvrou2 + vv*fvrov2 + ww * fvrow2)
!!
!!  gvrou2 =          mmu*(     uy +     vx       )
!!  gvrov2 = TWOTHIRD*mmu*(    -ux + TWO*vy -  wz )
!!  gvrow2 =          mmu*(              vz +  wy )
!!  gvroe2 = (lambda*ty + uu*gvrou2 + vv*gvrov2 + ww*gvrow2)
! #include "rhs/spectralradius_i.F"
! correction Rossow JCP 2000
!#include "rhs/spectralradiusRossow_i.F"
!1st direction
      rhomrd = wd(i, j, 1)
      rhomr = w(i, j, 1)
      temp = w(i, j, 2)/rhomr
      urd = (wd(i, j, 2)-temp*rhomrd)/rhomr
      ur = temp
      temp = w(i, j, 3)/rhomr
      vrd = (wd(i, j, 3)-temp*rhomrd)/rhomr
      vr = temp
      c2rd = gam*rgaz*tlocd(i, j)
      c2r = gam*rgaz*tloc(i, j)
!
      rhomld = wd(i-1, j, 1)
      rhoml = w(i-1, j, 1)
      temp = w(i-1, j, 2)/rhoml
      uld = (wd(i-1, j, 2)-temp*rhomld)/rhoml
      ul = temp
      temp = w(i-1, j, 3)/rhoml
      vld = (wd(i-1, j, 3)-temp*rhomld)/rhoml
      vl = temp
      c2ld = gam*rgaz*tlocd(i-1, j)
      c2l = gam*rgaz*tloc(i-1, j)
!
      temp = rhomr/rhoml
      temp0 = SQRT(temp)
      IF (temp .EQ. 0.0) THEN
        rd = 0.0_8
      ELSE
        rd = (rhomrd-temp*rhomld)/(2.0*temp0*rhoml)
      END IF
      r = temp0
      temp0 = one/(one+r)
      rrd = -(temp0*rd/(one+r))
      rr = temp0
      omrrd = -rrd
      omrr = one - rr
!
      ud = rr*uld + ul*rrd + omrr*urd + ur*omrrd
      u = ul*rr + ur*omrr
      vd = rr*vld + vl*rrd + omrr*vrd + vr*omrrd
      v = vl*rr + vr*omrr
!
      c2xd = rr*c2ld + c2l*rrd + omrr*c2rd + c2r*omrrd
      c2x = c2l*rr + c2r*omrr
      nx2 = nx(i, j, 1)*nx(i, j, 1) + ny(i, j, 1)*ny(i, j, 1)
      x1d = nx(i, j, 1)*ud + ny(i, j, 1)*vd
      x1 = nx(i, j, 1)*u + ny(i, j, 1)*v
      IF (x1 .GE. 0.) THEN
        abd = x1d
        ab = x1
      ELSE
        abd = -x1d
        ab = -x1
      END IF
      temp0 = SQRT(nx2*c2x)
      IF (nx2*c2x .EQ. 0.0) THEN
        sqd = 0.0_8
      ELSE
        sqd = nx2*c2xd/(2.0*temp0)
      END IF
      sq = temp0
!
      rspecd = abd + sqd
      rspec = ab + sq
      IF (p(i-1, j) - two*p(i, j) + p(i+1, j) .GE. 0.) THEN
        abs0d = pd(i-1, j) - two*pd(i, j) + pd(i+1, j)
        abs0 = p(i-1, j) - two*p(i, j) + p(i+1, j)
      ELSE
        abs0d = two*pd(i, j) - pd(i-1, j) - pd(i+1, j)
        abs0 = -(p(i-1, j)-two*p(i, j)+p(i+1, j))
      END IF
      x8d = pd(i-1, j) + two*pd(i, j) + pd(i+1, j)
      x8 = p(i-1, j) + two*p(i, j) + p(i+1, j)
      IF (x8 .GE. 0.) THEN
        abs14d = x8d
        abs14 = x8
      ELSE
        abs14d = -x8d
        abs14 = -x8
      END IF
!
!1st direction
      k_sensor1d = (abs0d-abs0*abs14d/abs14)/abs14
      k_sensor1 = abs0/abs14
      IF (p(i-2, j) - two*p(i-1, j) + p(i, j) .GE. 0.) THEN
        abs1d = pd(i-2, j) - two*pd(i-1, j) + pd(i, j)
        abs1 = p(i-2, j) - two*p(i-1, j) + p(i, j)
      ELSE
        abs1d = two*pd(i-1, j) - pd(i-2, j) - pd(i, j)
        abs1 = -(p(i-2, j)-two*p(i-1, j)+p(i, j))
      END IF
      x9d = pd(i-2, j) + two*pd(i-1, j) + pd(i, j)
      x9 = p(i-2, j) + two*p(i-1, j) + p(i, j)
      IF (x9 .GE. 0.) THEN
        abs15d = x9d
        abs15 = x9
      ELSE
        abs15d = -x9d
        abs15 = -x9
      END IF
      k_sensor2d = (abs1d-abs1*abs15d/abs15)/abs15
      k_sensor2 = abs1/abs15
      divud = gradud(i, j, 1) + gradvd(i, j, 2)
      divu = gradu(i, j, 1) + gradv(i, j, 2)
      divu2d = 2*divu*divud
      divu2 = divu*divu
      vort2d = 2*(gradv(i, j, 1)-gradu(i, j, 2))*(gradvd(i, j, 1)-gradud&
&       (i, j, 2))
      vort2 = (gradv(i, j, 1)-gradu(i, j, 2))*(gradv(i, j, 1)-gradu(i, j&
&       , 2))
      temp0 = divu2/(divu2+vort2+1d-15)
      ducros1d = (divu2d-temp0*(divu2d+vort2d))/(divu2+vort2+1d-15)
      ducros1 = temp0
! dxm1      = HALF*(ONE-tanh(2.5d0+10.d0*vol(i,j)/(sq+1.d-15)*divu) )
      arg1d = nx2*c2rd
      arg1 = c2r*nx2
      temp0 = SQRT(arg1)
      IF (arg1 .EQ. 0.0) THEN
        result1d = 0.0_8
      ELSE
        result1d = arg1d/(2.0*temp0)
      END IF
      result1 = temp0
      temp0 = 10.d0*vol(i, j)
      temp = divu/(result1+1.d-15)
      arg2d = temp0*(divud-temp*result1d)/(result1+1.d-15)
      arg2 = temp0*temp + 2.5d0
      dxm1d = -(half*(1.0-TANH(arg2)**2)*arg2d)
      dxm1 = half*(one-TANH(arg2))
      divud = gradud(i-1, j, 1) + gradvd(i-1, j, 2)
      divu = gradu(i-1, j, 1) + gradv(i-1, j, 2)
      divu2d = 2*divu*divud
      divu2 = divu*divu
      vort2d = 2*(gradv(i-1, j, 1)-gradu(i-1, j, 2))*(gradvd(i-1, j, 1)-&
&       gradud(i-1, j, 2))
      vort2 = (gradv(i-1, j, 1)-gradu(i-1, j, 2))*(gradv(i-1, j, 1)-&
&       gradu(i-1, j, 2))
      temp0 = divu2/(divu2+vort2+1d-15)
      ducros2d = (divu2d-temp0*(divu2d+vort2d))/(divu2+vort2+1d-15)
      ducros2 = temp0
! dxm2      = HALF*(ONE-tanh(2.5d0+10.d0*vol(i-1,j)/(sq+1.d-15)*divu) )
      arg1d = nx2*c2ld
      arg1 = c2l*nx2
      temp0 = SQRT(arg1)
      IF (arg1 .EQ. 0.0) THEN
        result1d = 0.0_8
      ELSE
        result1d = arg1d/(2.0*temp0)
      END IF
      result1 = temp0
      temp0 = 10.d0*vol(i-1, j)
      temp = divu/(result1+1.d-15)
      arg2d = temp0*(divud-temp*result1d)/(result1+1.d-15)
      arg2 = temp0*temp + 2.5d0
      dxm2d = -(half*(1.0-TANH(arg2)**2)*arg2d)
      dxm2 = half*(one-TANH(arg2))
      IF (k_sensor1 .LT. k_sensor2) THEN
        max1d = k_sensor2d
        max1 = k_sensor2
      ELSE
        max1d = k_sensor1d
        max1 = k_sensor1
      END IF
      IF (ducros1 .LT. ducros2) THEN
        max8d = ducros2d
        max8 = ducros2
      ELSE
        max8d = ducros1d
        max8 = ducros1
      END IF
      IF (dxm1 .LT. dxm2) THEN
        max15d = dxm2d
        max15 = dxm2
      ELSE
        max15d = dxm1d
        max15 = dxm1
      END IF
!coef      = MAX( k_sensor1*ducros1*dxm1, &
!                 k_sensor2*ducros2*dxm2)
      coefd = max15*(max8*max1d+max1*max8d) + max1*max8*max15d
      coef = max1*max8*max15
!     ! extension of shock capturing
!
!k_sensor1 = ABS(p(i,j) - TWO*p(i+1,j) + p(i+2,j)) / &
!            ABS(p(i,j) + TWO*p(i+1,j) + p(i+2,j))
!
!k_sensor2 = ABS(p(i-3,j) - TWO*p(i-2,j) + p(i-1,j)) / &
!            ABS(p(i-3,j) + TWO*p(i-2,j) + p(i-1,j))
!
!divu      = gradu(i+1,j,1)+gradv(i+1,j,2)
!divu2     = divu*divu
!vort2     = (gradv(i+1,j,1)-gradu(i+1,j,2)) * (gradv(i+1,j,1)-gradu(i+1,j,2))
!ducros1   = divu2/(divu2+vort2+1d-15)
!dxm1      = HALF*(ONE-tanh(2.5d0+10.d0*vol(i+1,j)/(sq+1.d-15)*divu) )
!
!
!divu      = gradu(i-2,j,1)+gradv(i-2,j,2)
!divu2     = divu*divu
!vort2     = (gradv(i-2,j,1)-gradu(i-2,j,2)) * (gradv(i-2,j,1)-gradu(i-2,j,2))
!ducros2   = divu2/(divu2+vort2+1d-15)
!dxm2      = HALF*(ONE-tanh(2.5d0+10.d0*vol(i-2,j)/(sq+1.d-15)*divu) )
!coef      = MAX( k_sensor1*ducros1*dxm1, &
!                 k_sensor2*ducros2*dxm2, coef)
!coef      = MAX(sensor(i-1,j  ,1), sensor(i,j  ,1), &
!                sensor(i-1,j-1,1), sensor(i,j-1,1), &
!                sensor(i-1,j+1,1), sensor(i,j+1,1)  )
!
!coef      = MAX(sensor(i-3,j,1), sensor(i-2,j,1), &
!                sensor(i-1,j,1), sensor(i  ,j,1), &
!                sensor(i+1,j,1), sensor(i+2,j,1)  )
!
!coef      = MAX(sensor(i-2,j,1), &
!                sensor(i-1,j,1), sensor(i  ,j,1), &
!                sensor(i+1,j,1))
!
!rspec      = rconv(i,j,1)
!
      eps2d = k2*coefd
      eps2 = k2*coef
      IF (zero .LT. k4 - eps2*12.d0) THEN
        eps4d = -(12.d0*eps2d)
        eps4 = k4 - eps2*12.d0
      ELSE
        eps4 = zero
        eps4d = 0.0_8
      END IF
      diffrod = half*(wd(i, j, 1)-wd(i-1, j, 1))
      diffro = half*(w(i, j, 1)-w(i-1, j, 1))
      diffroud = half*(wd(i, j, 2)-wd(i-1, j, 2))
      diffrou = half*(w(i, j, 2)-w(i-1, j, 2))
      diffrovd = half*(wd(i, j, 3)-wd(i-1, j, 3))
      diffrov = half*(w(i, j, 3)-w(i-1, j, 3))
      diffrowd = half*(wd(i, j, 4)-wd(i-1, j, 4))
      diffrow = half*(w(i, j, 4)-w(i-1, j, 4))
      diffroed = half*(wd(i, j, 5)-wd(i-1, j, 5))
      diffroe = half*(w(i, j, 5)-w(i-1, j, 5))
!
!
!     if (eps4.gt.1.d-12) then
! #include "rhs/wiggle_diri.F"
!     endif
      temp0 = eps2*diffro + eps4*predro1
      dissro1d = temp0*rspecd + rspec*(diffro*eps2d+eps2*diffrod+predro1&
&       *eps4d+eps4*predro1d)
      temp0 = eps2*diffrou + eps4*predrou1
      dissrou1d = temp0*rspecd + rspec*(diffrou*eps2d+eps2*diffroud+&
&       predrou1*eps4d+eps4*predrou1d)
      temp0 = eps2*diffrov + eps4*predrov1
      dissrov1d = temp0*rspecd + rspec*(diffrov*eps2d+eps2*diffrovd+&
&       predrov1*eps4d+eps4*predrov1d)
      temp0 = eps2*diffrow + eps4*predrow1
      dissrow1d = temp0*rspecd + rspec*(diffrow*eps2d+eps2*diffrowd+&
&       predrow1*eps4d+eps4*predrow1d)
      temp0 = eps2*diffroe + eps4*predroe1
      dissroe1d = temp0*rspecd + rspec*(diffroe*eps2d+eps2*diffroed+&
&       predroe1*eps4d+eps4*predroe1d)
! #include "rhs/spectralradius_j.F"
! correction Rossow JCP 2000
!#include "rhs/spectralradiusRossow_j.F"
!1st direction
      rhomrd = wd(i, j, 1)
      rhomr = w(i, j, 1)
      temp0 = w(i, j, 2)/rhomr
      urd = (wd(i, j, 2)-temp0*rhomrd)/rhomr
      ur = temp0
      temp0 = w(i, j, 3)/rhomr
      vrd = (wd(i, j, 3)-temp0*rhomrd)/rhomr
      vr = temp0
      c2rd = gam*rgaz*tlocd(i, j)
      c2r = gam*rgaz*tloc(i, j)
!
      rhomld = wd(i, j-1, 1)
      rhoml = w(i, j-1, 1)
      temp0 = w(i, j-1, 2)/rhoml
      uld = (wd(i, j-1, 2)-temp0*rhomld)/rhoml
      ul = temp0
      temp0 = w(i, j-1, 3)/rhoml
      vld = (wd(i, j-1, 3)-temp0*rhomld)/rhoml
      vl = temp0
      c2ld = gam*rgaz*tlocd(i, j-1)
      c2l = gam*rgaz*tloc(i, j-1)
!
      temp0 = rhomr/rhoml
      temp = SQRT(temp0)
      IF (temp0 .EQ. 0.0) THEN
        rd = 0.0_8
      ELSE
        rd = (rhomrd-temp0*rhomld)/(2.0*temp*rhoml)
      END IF
      r = temp
      temp0 = one/(one+r)
      rrd = -(temp0*rd/(one+r))
      rr = temp0
      omrrd = -rrd
      omrr = one - rr
!
      ud = rr*uld + ul*rrd + omrr*urd + ur*omrrd
      u = ul*rr + ur*omrr
      vd = rr*vld + vl*rrd + omrr*vrd + vr*omrrd
      v = vl*rr + vr*omrr
!
      c2xd = rr*c2ld + c2l*rrd + omrr*c2rd + c2r*omrrd
      c2x = c2l*rr + c2r*omrr
      nx2 = nx(i, j, 2)*nx(i, j, 2) + ny(i, j, 2)*ny(i, j, 2)
      x2d = nx(i, j, 2)*ud + ny(i, j, 2)*vd
      x2 = nx(i, j, 2)*u + ny(i, j, 2)*v
      IF (x2 .GE. 0.) THEN
        abd = x2d
        ab = x2
      ELSE
        abd = -x2d
        ab = -x2
      END IF
      temp0 = SQRT(nx2*c2x)
      IF (nx2*c2x .EQ. 0.0) THEN
        sqd = 0.0_8
      ELSE
        sqd = nx2*c2xd/(2.0*temp0)
      END IF
      sq = temp0
!
      rspecd = abd + sqd
      rspec = ab + sq
      IF (p(i, j-1) - two*p(i, j) + p(i, j+1) .GE. 0.) THEN
        abs2d = pd(i, j-1) - two*pd(i, j) + pd(i, j+1)
        abs2 = p(i, j-1) - two*p(i, j) + p(i, j+1)
      ELSE
        abs2d = two*pd(i, j) - pd(i, j-1) - pd(i, j+1)
        abs2 = -(p(i, j-1)-two*p(i, j)+p(i, j+1))
      END IF
      x10d = pd(i, j-1) + two*pd(i, j) + pd(i, j+1)
      x10 = p(i, j-1) + two*p(i, j) + p(i, j+1)
      IF (x10 .GE. 0.) THEN
        abs16d = x10d
        abs16 = x10
      ELSE
        abs16d = -x10d
        abs16 = -x10
      END IF
!
! 2nd direction
      k_sensor1d = (abs2d-abs2*abs16d/abs16)/abs16
      k_sensor1 = abs2/abs16
      IF (p(i, j-2) - two*p(i, j-1) + p(i, j) .GE. 0.) THEN
        abs3d = pd(i, j-2) - two*pd(i, j-1) + pd(i, j)
        abs3 = p(i, j-2) - two*p(i, j-1) + p(i, j)
      ELSE
        abs3d = two*pd(i, j-1) - pd(i, j-2) - pd(i, j)
        abs3 = -(p(i, j-2)-two*p(i, j-1)+p(i, j))
      END IF
      x11d = pd(i, j-2) + two*pd(i, j-1) + pd(i, j)
      x11 = p(i, j-2) + two*p(i, j-1) + p(i, j)
      IF (x11 .GE. 0.) THEN
        abs17d = x11d
        abs17 = x11
      ELSE
        abs17d = -x11d
        abs17 = -x11
      END IF
      k_sensor2d = (abs3d-abs3*abs17d/abs17)/abs17
      k_sensor2 = abs3/abs17
!     ducros1 is done in dissipation_ducros_x
      divud = gradud(i, j, 1) + gradvd(i, j, 2)
      divu = gradu(i, j, 1) + gradv(i, j, 2)
      divu2d = 2*divu*divud
      divu2 = divu*divu
      vort2d = 2*(gradv(i, j, 1)-gradu(i, j, 2))*(gradvd(i, j, 1)-gradud&
&       (i, j, 2))
      vort2 = (gradv(i, j, 1)-gradu(i, j, 2))*(gradv(i, j, 1)-gradu(i, j&
&       , 2))
      temp0 = divu2/(divu2+vort2+1d-15)
      ducros1d = (divu2d-temp0*(divu2d+vort2d))/(divu2+vort2+1d-15)
      ducros1 = temp0
! dxm1      = HALF*(ONE-tanh(2.5d0+10.d0*vol(i,j)/(sq+1.d-15)*divu) )
      arg1d = nx2*c2rd
      arg1 = c2r*nx2
      temp0 = SQRT(arg1)
      IF (arg1 .EQ. 0.0) THEN
        result1d = 0.0_8
      ELSE
        result1d = arg1d/(2.0*temp0)
      END IF
      result1 = temp0
      temp0 = 10.d0*vol(i, j)
      temp = divu/(result1+1.d-15)
      arg2d = temp0*(divud-temp*result1d)/(result1+1.d-15)
      arg2 = temp0*temp + 2.5d0
      dxm1d = -(half*(1.0-TANH(arg2)**2)*arg2d)
      dxm1 = half*(one-TANH(arg2))
      divud = gradud(i, j-1, 1) + gradvd(i, j-1, 2)
      divu = gradu(i, j-1, 1) + gradv(i, j-1, 2)
      divu2d = 2*divu*divud
      divu2 = divu*divu
      vort2d = 2*(gradv(i, j-1, 1)-gradu(i, j-1, 2))*(gradvd(i, j-1, 1)-&
&       gradud(i, j-1, 2))
      vort2 = (gradv(i, j-1, 1)-gradu(i, j-1, 2))*(gradv(i, j-1, 1)-&
&       gradu(i, j-1, 2))
      temp0 = divu2/(divu2+vort2+1.d-15)
      ducros2d = (divu2d-temp0*(divu2d+vort2d))/(divu2+vort2+1.d-15)
      ducros2 = temp0
!sq = sound/dx
! dxm2       = HALF*(ONE-tanh(2.5d0+10.d0*vol(i,j-1)/(sq+1.d-15)*divu) )
      arg1d = nx2*c2ld
      arg1 = c2l*nx2
      temp0 = SQRT(arg1)
      IF (arg1 .EQ. 0.0) THEN
        result1d = 0.0_8
      ELSE
        result1d = arg1d/(2.0*temp0)
      END IF
      result1 = temp0
      temp0 = 10.d0*vol(i, j-1)
      temp = divu/(result1+1.d-15)
      arg2d = temp0*(divud-temp*result1d)/(result1+1.d-15)
      arg2 = temp0*temp + 2.5d0
      dxm2d = -(half*(1.0-TANH(arg2)**2)*arg2d)
      dxm2 = half*(one-TANH(arg2))
      IF (k_sensor1 .LT. k_sensor2) THEN
        max2d = k_sensor2d
        max2 = k_sensor2
      ELSE
        max2d = k_sensor1d
        max2 = k_sensor1
      END IF
      IF (ducros1 .LT. ducros2) THEN
        max9d = ducros2d
        max9 = ducros2
      ELSE
        max9d = ducros1d
        max9 = ducros1
      END IF
      IF (dxm1 .LT. dxm2) THEN
        max16d = dxm2d
        max16 = dxm2
      ELSE
        max16d = dxm1d
        max16 = dxm1
      END IF
!coef      = MAX( k_sensor1*ducros1*dxm1, &
!                 k_sensor2*ducros2*dxm2)
      coefd = max16*(max9*max2d+max2*max9d) + max2*max9*max16d
      coef = max2*max9*max16
! extension of shock capturing
!k_sensor1 = ABS(p(i,j) - TWO*p(i,j+1) + p(i,j+2)) / &
!            ABS(p(i,j) + TWO*p(i,j+1) + p(i,j+2))
!
!k_sensor2 = ABS(p(i,j-3) - TWO*p(i,j-2) + p(i,j-1)) / &
!            ABS(p(i,j-3) + TWO*p(i,j-2) + p(i,j-1))
!
!divu      = gradu(i,j+1,1)+gradv(i,j+1,2)
!divu2     = divu*divu
!vort2     = (gradv(i,j+1,1)-gradu(i,j+1,2)) * (gradv(i,j+1,1)-gradu(i,j+1,2))
!ducros1   = divu2/(divu2+vort2+1d-15)
!dxm1      = HALF*(ONE-tanh(2.5d0+10.d0*vol(i,j+1)/(sq+1.d-15)*divu) )
!
!
!divu      = gradu(i,j-2,1)+gradv(i,j-2,2)
!divu2     = divu*divu
!vort2     = (gradv(i,j-2,1)-gradu(i,j-2,2)) * (gradv(i,j-2,1)-gradu(i,j-2,2))
!ducros2   = divu2/(divu2+vort2+1d-15)
!dxm2      = HALF*(ONE-tanh(2.5d0+10.d0*vol(i,j-2)/(sq+1.d-15)*divu) )
!
!coef      = MAX( k_sensor1*ducros1*dxm1, &
!                 k_sensor2*ducros2*dxm2, coef)
!coef      = MAX(sensor(i  ,j-1,2), sensor(i  ,j,2), &
!                sensor(i-1,j-1,2), sensor(i-1,j,2), &
!                sensor(i+1,j-1,2), sensor(i+1,j,2)  )
!
!coef      = MAX(sensor(i,j-3,2), sensor(i,j-2,2), &
!                sensor(i,j-1,2), sensor(i,j  ,2), &
!                sensor(i,j+1,2), sensor(i,j+2,2)  )
!
!coef      = MAX(sensor(i,j-2,2), &
!                sensor(i,j-1,2), sensor(i,j,2), &
!                sensor(i,j+1,2))
!
!rspec      = rconv(i,j,2)
      eps2d = k2*coefd
      eps2 = k2*coef
      IF (zero .LT. k4 - 12.d0*eps2) THEN
        eps4d = -(12.d0*eps2d)
        eps4 = k4 - 12.d0*eps2
      ELSE
        eps4 = zero
        eps4d = 0.0_8
      END IF
      diffrod = half*(wd(i, j, 1)-wd(i, j-1, 1))
      diffro = half*(w(i, j, 1)-w(i, j-1, 1))
      diffroud = half*(wd(i, j, 2)-wd(i, j-1, 2))
      diffrou = half*(w(i, j, 2)-w(i, j-1, 2))
      diffrovd = half*(wd(i, j, 3)-wd(i, j-1, 3))
      diffrov = half*(w(i, j, 3)-w(i, j-1, 3))
      diffrowd = half*(wd(i, j, 4)-wd(i, j-1, 4))
      diffrow = half*(w(i, j, 4)-w(i, j-1, 4))
      diffroed = half*(wd(i, j, 5)-wd(i, j-1, 5))
      diffroe = half*(w(i, j, 5)-w(i, j-1, 5))
!
!
!     if (eps4.gt.1.d-12) then
! #include "rhs/wiggle_dirj.F"
!     endif
!
      temp0 = eps2*diffro + eps4*predro2
      dissro2d = temp0*rspecd + rspec*(diffro*eps2d+eps2*diffrod+predro2&
&       *eps4d+eps4*predro2d)
      temp0 = eps2*diffrou + eps4*predrou2
      dissrou2d = temp0*rspecd + rspec*(diffrou*eps2d+eps2*diffroud+&
&       predrou2*eps4d+eps4*predrou2d)
      temp0 = eps2*diffrov + eps4*predrov2
      dissrov2d = temp0*rspecd + rspec*(diffrov*eps2d+eps2*diffrovd+&
&       predrov2*eps4d+eps4*predrov2d)
      temp0 = eps2*diffrow + eps4*predrow2
      dissrow2d = temp0*rspecd + rspec*(diffrow*eps2d+eps2*diffrowd+&
&       predrow2*eps4d+eps4*predrow2d)
      temp0 = eps2*diffroe + eps4*predroe2
      dissroe2d = temp0*rspecd + rspec*(diffroe*eps2d+eps2*diffroed+&
&       predroe2*eps4d+eps4*predroe2d)
      sc1 = nx(i, j, 1)
      sc2 = ny(i, j, 1)
      arg1 = sc1*sc1 + sc2*sc2
      sn = SQRT(arg1)
      invsn = one/sn
      nxloc = sc1*invsn
      nyloc = sc2*invsn
      hnd(i, j, 1, 1) = fxro1d - dissro1d
!
      hnd(i, j, 2, 1) = fxrou1d - dissrou1d - sn*(nxloc*fvrou1d+nyloc*&
&       gvrou1d)
!
      hnd(i, j, 3, 1) = fxrov1d - dissrov1d - sn*(nxloc*fvrov1d+nyloc*&
&       gvrov1d)
!
      hnd(i, j, 4, 1) = fxrow1d - dissrow1d - sn*(nxloc*fvrow1d+nyloc*&
&       gvrow1d)
!
      hnd(i, j, 5, 1) = fxroe1d - dissroe1d - sn*(nxloc*fvroe1d+nyloc*&
&       gvroe1d)
      sc1 = nx(i, j, 2)
      sc2 = ny(i, j, 2)
      arg1 = sc1*sc1 + sc2*sc2
      sn = SQRT(arg1)
      invsn = one/sn
      nxloc = sc1*invsn
      nyloc = sc2*invsn
      hnd(i, j, 1, 2) = fxro2d - dissro2d
!
      hnd(i, j, 2, 2) = fxrou2d - dissrou2d - sn*(nxloc*fvrou2d+nyloc*&
&       gvrou2d)
!
      hnd(i, j, 3, 2) = fxrov2d - dissrov2d - sn*(nxloc*fvrov2d+nyloc*&
&       gvrov2d)
!
      hnd(i, j, 4, 2) = fxrow2d - dissrow2d - sn*(nxloc*fvrow2d+nyloc*&
&       gvrow2d)
!
      hnd(i, j, 5, 2) = fxroe2d - dissroe2d - sn*(nxloc*fvroe2d+nyloc*&
&       gvroe2d)
    END DO
  END DO
!
! Manage Wall Fluxes
! coef for near wall off-centered fluxes
  denom = 1.d0/60.d0
! face 5/2
  c5d0 = -(3.d0*denom)
  c5d1 = 27.d0*denom
  c5d2 = 47.d0*denom
  c5d3 = -(13.d0*denom)
  c5d4 = 2.d0*denom
! face 3/2
  c3d0 = 12.d0*denom
  c3d1 = 77.d0*denom
  c3d2 = -(43.d0*denom)
  c3d3 = 17.d0*denom
  c3d4 = -(3.d0*denom)
! off centered schemes for fluxes near wall
  j = 3
!DIR$ IVDEP
  DO i=1,im+1
! for idir
    fxro1d = nx(i, j, 1)*(c1*(fd(i, j, 1)+fd(i-1, j, 1))+c2*(fd(i+1, j, &
&     1)+fd(i-2, j, 1))+c3*(fd(i+2, j, 1)+fd(i-3, j, 1))) + ny(i, j, 1)*&
&     (c1*(gd(i, j, 1)+gd(i-1, j, 1))+c2*(gd(i+1, j, 1)+gd(i-2, j, 1))+&
&     c3*(gd(i+2, j, 1)+gd(i-3, j, 1)))
    fxrou1d = nx(i, j, 1)*(c1*(fd(i, j, 2)+fd(i-1, j, 2))+c2*(fd(i+1, j&
&     , 2)+fd(i-2, j, 2))+c3*(fd(i+2, j, 2)+fd(i-3, j, 2))) + ny(i, j, 1&
&     )*(c1*(gd(i, j, 2)+gd(i-1, j, 2))+c2*(gd(i+1, j, 2)+gd(i-2, j, 2))&
&     +c3*(gd(i+2, j, 2)+gd(i-3, j, 2)))
    fxrov1d = nx(i, j, 1)*(c1*(fd(i, j, 3)+fd(i-1, j, 3))+c2*(fd(i+1, j&
&     , 3)+fd(i-2, j, 3))+c3*(fd(i+2, j, 3)+fd(i-3, j, 3))) + ny(i, j, 1&
&     )*(c1*(gd(i, j, 3)+gd(i-1, j, 3))+c2*(gd(i+1, j, 3)+gd(i-2, j, 3))&
&     +c3*(gd(i+2, j, 3)+gd(i-3, j, 3)))
    fxrow1d = nx(i, j, 1)*(c1*(fd(i, j, 4)+fd(i-1, j, 4))+c2*(fd(i+1, j&
&     , 4)+fd(i-2, j, 4))+c3*(fd(i+2, j, 4)+fd(i-3, j, 4))) + ny(i, j, 1&
&     )*(c1*(gd(i, j, 4)+gd(i-1, j, 4))+c2*(gd(i+1, j, 4)+gd(i-2, j, 4))&
&     +c3*(gd(i+2, j, 4)+gd(i-3, j, 4)))
    fxroe1d = nx(i, j, 1)*(c1*(fd(i, j, 5)+fd(i-1, j, 5))+c2*(fd(i+1, j&
&     , 5)+fd(i-2, j, 5))+c3*(fd(i+2, j, 5)+fd(i-3, j, 5))) + ny(i, j, 1&
&     )*(c1*(gd(i, j, 5)+gd(i-1, j, 5))+c2*(gd(i+1, j, 5)+gd(i-2, j, 5))&
&     +c3*(gd(i+2, j, 5)+gd(i-3, j, 5)))
! Saunier Thesis
    fxro2d = nx(i, j, 2)*(c5d0*fd(i, 1, 1)+c5d1*fd(i, 2, 1)+c5d2*fd(i, 3&
&     , 1)+c5d3*fd(i, 4, 1)+c5d4*fd(i, 5, 1)) + ny(i, j, 2)*(c5d0*gd(i, &
&     1, 1)+c5d1*gd(i, 2, 1)+c5d2*gd(i, 3, 1)+c5d3*gd(i, 4, 1)+c5d4*gd(i&
&     , 5, 1))
    fxrou2d = nx(i, j, 2)*(c5d0*fd(i, 1, 2)+c5d1*fd(i, 2, 2)+c5d2*fd(i, &
&     3, 2)+c5d3*fd(i, 4, 2)+c5d4*fd(i, 5, 2)) + ny(i, j, 2)*(c5d0*gd(i&
&     , 1, 2)+c5d1*gd(i, 2, 2)+c5d2*gd(i, 3, 2)+c5d3*gd(i, 4, 2)+c5d4*gd&
&     (i, 5, 2))
    fxrov2d = nx(i, j, 2)*(c5d0*fd(i, 1, 3)+c5d1*fd(i, 2, 3)+c5d2*fd(i, &
&     3, 3)+c5d3*fd(i, 4, 3)+c5d4*fd(i, 5, 3)) + ny(i, j, 2)*(c5d0*gd(i&
&     , 1, 3)+c5d1*gd(i, 2, 3)+c5d2*gd(i, 3, 3)+c5d3*gd(i, 4, 3)+c5d4*gd&
&     (i, 5, 3))
    fxrow2d = nx(i, j, 2)*(c5d0*fd(i, 1, 4)+c5d1*fd(i, 2, 4)+c5d2*fd(i, &
&     3, 4)+c5d3*fd(i, 4, 4)+c5d4*fd(i, 5, 4)) + ny(i, j, 2)*(c5d0*gd(i&
&     , 1, 4)+c5d1*gd(i, 2, 4)+c5d2*gd(i, 3, 4)+c5d3*gd(i, 4, 4)+c5d4*gd&
&     (i, 5, 4))
    fxroe2d = nx(i, j, 2)*(c5d0*fd(i, 1, 5)+c5d1*fd(i, 2, 5)+c5d2*fd(i, &
&     3, 5)+c5d3*fd(i, 4, 5)+c5d4*fd(i, 5, 5)) + ny(i, j, 2)*(c5d0*gd(i&
&     , 1, 5)+c5d1*gd(i, 2, 5)+c5d2*gd(i, 3, 5)+c5d3*gd(i, 4, 5)+c5d4*gd&
&     (i, 5, 5))
    predro1d = d2*wd(i-2, j, 1) - d3*wd(i-3, j, 1) - d1*wd(i-1, j, 1) + &
&     d1*wd(i, j, 1) - d2*wd(i+1, j, 1) + d3*wd(i+2, j, 1)
    predro1 = -(d3*w(i-3, j, 1)) + d2*w(i-2, j, 1) - d1*w(i-1, j, 1) + &
&     d1*w(i, j, 1) - d2*w(i+1, j, 1) + d3*w(i+2, j, 1)
    predrou1d = d2*wd(i-2, j, 2) - d3*wd(i-3, j, 2) - d1*wd(i-1, j, 2) +&
&     d1*wd(i, j, 2) - d2*wd(i+1, j, 2) + d3*wd(i+2, j, 2)
    predrou1 = -(d3*w(i-3, j, 2)) + d2*w(i-2, j, 2) - d1*w(i-1, j, 2) + &
&     d1*w(i, j, 2) - d2*w(i+1, j, 2) + d3*w(i+2, j, 2)
    predrov1d = d2*wd(i-2, j, 3) - d3*wd(i-3, j, 3) - d1*wd(i-1, j, 3) +&
&     d1*wd(i, j, 3) - d2*wd(i+1, j, 3) + d3*wd(i+2, j, 3)
    predrov1 = -(d3*w(i-3, j, 3)) + d2*w(i-2, j, 3) - d1*w(i-1, j, 3) + &
&     d1*w(i, j, 3) - d2*w(i+1, j, 3) + d3*w(i+2, j, 3)
    predrow1d = d2*wd(i-2, j, 4) - d3*wd(i-3, j, 4) - d1*wd(i-1, j, 4) +&
&     d1*wd(i, j, 4) - d2*wd(i+1, j, 4) + d3*wd(i+2, j, 4)
    predrow1 = -(d3*w(i-3, j, 4)) + d2*w(i-2, j, 4) - d1*w(i-1, j, 4) + &
&     d1*w(i, j, 4) - d2*w(i+1, j, 4) + d3*w(i+2, j, 4)
    predroe1d = d2*wd(i-2, j, 5) - d3*wd(i-3, j, 5) - d1*wd(i-1, j, 5) +&
&     d1*wd(i, j, 5) - d2*wd(i+1, j, 5) + d3*wd(i+2, j, 5)
    predroe1 = -(d3*w(i-3, j, 5)) + d2*w(i-2, j, 5) - d1*w(i-1, j, 5) + &
&     d1*w(i, j, 5) - d2*w(i+1, j, 5) + d3*w(i+2, j, 5)
    predro2d = d2*wd(i, j-2, 1) - d3*wd(i, j-3, 1) - d1*wd(i, j-1, 1) + &
&     d1*wd(i, j, 1) - d2*wd(i, j+1, 1) + d3*wd(i, j+2, 1)
    predro2 = -(d3*w(i, j-3, 1)) + d2*w(i, j-2, 1) - d1*w(i, j-1, 1) + &
&     d1*w(i, j, 1) - d2*w(i, j+1, 1) + d3*w(i, j+2, 1)
    predrou2d = d2*wd(i, j-2, 2) - d3*wd(i, j-3, 2) - d1*wd(i, j-1, 2) +&
&     d1*wd(i, j, 2) - d2*wd(i, j+1, 2) + d3*wd(i, j+2, 2)
    predrou2 = -(d3*w(i, j-3, 2)) + d2*w(i, j-2, 2) - d1*w(i, j-1, 2) + &
&     d1*w(i, j, 2) - d2*w(i, j+1, 2) + d3*w(i, j+2, 2)
    predrov2d = d2*wd(i, j-2, 3) - d3*wd(i, j-3, 3) - d1*wd(i, j-1, 3) +&
&     d1*wd(i, j, 3) - d2*wd(i, j+1, 3) + d3*wd(i, j+2, 3)
    predrov2 = -(d3*w(i, j-3, 3)) + d2*w(i, j-2, 3) - d1*w(i, j-1, 3) + &
&     d1*w(i, j, 3) - d2*w(i, j+1, 3) + d3*w(i, j+2, 3)
    predrow2d = d2*wd(i, j-2, 4) - d3*wd(i, j-3, 4) - d1*wd(i, j-1, 4) +&
&     d1*wd(i, j, 4) - d2*wd(i, j+1, 4) + d3*wd(i, j+2, 4)
    predrow2 = -(d3*w(i, j-3, 4)) + d2*w(i, j-2, 4) - d1*w(i, j-1, 4) + &
&     d1*w(i, j, 4) - d2*w(i, j+1, 4) + d3*w(i, j+2, 4)
    predroe2d = d2*wd(i, j-2, 5) - d3*wd(i, j-3, 5) - d1*wd(i, j-1, 5) +&
&     d1*wd(i, j, 5) - d2*wd(i, j+1, 5) + d3*wd(i, j+2, 5)
    predroe2 = -(d3*w(i, j-3, 5)) + d2*w(i, j-2, 5) - d1*w(i, j-1, 5) + &
&     d1*w(i, j, 5) - d2*w(i, j+1, 5) + d3*w(i, j+2, 5)
! grad for viscous fluxes o4 - 5p
! for coef ref Zhing et al, JCP2000 ou Shen et al AIAAP 2008
! 1/16 = 0.0625 ccross = 1/12*1/16
! TWENTYFOURTH = ONE/24.d0
! ccros = TWELFTH*0.0625d0
    volm1 = volf(i, j, 1)
    nx_n = half*(nx(i+1, j, 1)+nx(i, j, 1))
    nx_s = -(half*(nx(i-1, j, 1)+nx(i, j, 1)))
    nx_o = half*(nx(i-1, j+1, 2)+nx(i, j+1, 2))
    nx_e = -(half*(nx(i-1, j, 2)+nx(i, j, 2)))
!
    ny_n = half*(ny(i+1, j, 1)+ny(i, j, 1))
    ny_s = -(half*(ny(i-1, j, 1)+ny(i, j, 1)))
    ny_o = half*(ny(i-1, j+1, 2)+ny(i, j+1, 2))
    ny_e = -(half*(ny(i-1, j, 2)+ny(i, j, 2)))
    val_nd = twentyfourth*(26.d0*velxd(i, j)-velxd(i+1, j)-velxd(i-1, j)&
&     )
    val_n = twentyfourth*(-velx(i+1, j)+26.d0*velx(i, j)-velx(i-1, j))
    val_sd = twentyfourth*(26.d0*velxd(i-1, j)-velxd(i, j)-velxd(i-2, j)&
&     )
    val_s = twentyfourth*(-velx(i, j)+26.d0*velx(i-1, j)-velx(i-2, j))
    val_ed = ccross*(velxd(i-2, j-2)-9.d0*velxd(i-1, j-2)-9.d0*velxd(i, &
&     j-2)+velxd(i+1, j-2)+7.d0*(9.d0*velxd(i-1, j-1)-velxd(i-2, j-1)+&
&     9.d0*velxd(i, j-1)-velxd(i+1, j-1))+7.d0*(9.d0*velxd(i-1, j)-velxd&
&     (i-2, j)+9.d0*velxd(i, j)-velxd(i+1, j))+velxd(i-2, j+1)-9.d0*&
&     velxd(i-1, j+1)+velxd(i+1, j+1)-9.d0*velxd(i, j+1))
    val_e = ccross*(-(-velx(i-2, j-2)+9.d0*velx(i-1, j-2)+9.d0*velx(i, j&
&     -2)-velx(i+1, j-2))+7.d0*(-velx(i-2, j-1)+9.d0*velx(i-1, j-1)+9.d0&
&     *velx(i, j-1)-velx(i+1, j-1))+7.d0*(-velx(i-2, j)+9.d0*velx(i-1, j&
&     )+9.d0*velx(i, j)-velx(i+1, j))-(-velx(i-2, j+1)+9.d0*velx(i-1, j+&
&     1)+9.d0*velx(i, j+1)-velx(i+1, j+1)))
    val_od = ccross*(velxd(i-2, j-1)-9.d0*velxd(i-1, j-1)-9.d0*velxd(i, &
&     j-1)+velxd(i+1, j-1)+7.d0*(9.d0*velxd(i-1, j)-velxd(i-2, j)+9.d0*&
&     velxd(i, j)-velxd(i+1, j))+7.d0*(9.d0*velxd(i-1, j+1)-velxd(i-2, j&
&     +1)+9.d0*velxd(i, j+1)-velxd(i+1, j+1))+velxd(i-2, j+2)-9.d0*velxd&
&     (i-1, j+2)+velxd(i+1, j+2)-9.d0*velxd(i, j+2))
    val_o = ccross*(-(-velx(i-2, j-1)+9.d0*velx(i-1, j-1)+9.d0*velx(i, j&
&     -1)-velx(i+1, j-1))+7.d0*(-velx(i-2, j)+9.d0*velx(i-1, j)+9.d0*&
&     velx(i, j)-velx(i+1, j))+7.d0*(-velx(i-2, j+1)+9.d0*velx(i-1, j+1)&
&     +9.d0*velx(i, j+1)-velx(i+1, j+1))-(-velx(i-2, j+2)+9.d0*velx(i-1&
&     , j+2)+9.d0*velx(i, j+2)-velx(i+1, j+2)))
    uxd = volm1*(nx_n*val_nd+nx_s*val_sd+nx_o*val_od+nx_e*val_ed)
    ux = (val_n*nx_n+val_s*nx_s+val_o*nx_o+val_e*nx_e)*volm1
    uyd = volm1*(ny_n*val_nd+ny_s*val_sd+ny_o*val_od+ny_e*val_ed)
    uy = (val_n*ny_n+val_s*ny_s+val_o*ny_o+val_e*ny_e)*volm1
    val_nd = twentyfourth*(26.d0*velyd(i, j)-velyd(i+1, j)-velyd(i-1, j)&
&     )
    val_n = twentyfourth*(-vely(i+1, j)+26.d0*vely(i, j)-vely(i-1, j))
    val_sd = twentyfourth*(26.d0*velyd(i-1, j)-velyd(i, j)-velyd(i-2, j)&
&     )
    val_s = twentyfourth*(-vely(i, j)+26.d0*vely(i-1, j)-vely(i-2, j))
    val_ed = ccross*(velyd(i-2, j-2)-9.d0*velyd(i-1, j-2)-9.d0*velyd(i, &
&     j-2)+velyd(i+1, j-2)+7.d0*(9.d0*velyd(i-1, j-1)-velyd(i-2, j-1)+&
&     9.d0*velyd(i, j-1)-velyd(i+1, j-1))+7.d0*(9.d0*velyd(i-1, j)-velyd&
&     (i-2, j)+9.d0*velyd(i, j)-velyd(i+1, j))+velyd(i-2, j+1)-9.d0*&
&     velyd(i-1, j+1)+velyd(i+1, j+1)-9.d0*velyd(i, j+1))
    val_e = ccross*(-(-vely(i-2, j-2)+9.d0*vely(i-1, j-2)+9.d0*vely(i, j&
&     -2)-vely(i+1, j-2))+7.d0*(-vely(i-2, j-1)+9.d0*vely(i-1, j-1)+9.d0&
&     *vely(i, j-1)-vely(i+1, j-1))+7.d0*(-vely(i-2, j)+9.d0*vely(i-1, j&
&     )+9.d0*vely(i, j)-vely(i+1, j))-(-vely(i-2, j+1)+9.d0*vely(i-1, j+&
&     1)+9.d0*vely(i, j+1)-vely(i+1, j+1)))
    val_od = ccross*(velyd(i-2, j-1)-9.d0*velyd(i-1, j-1)-9.d0*velyd(i, &
&     j-1)+velyd(i+1, j-1)+7.d0*(9.d0*velyd(i-1, j)-velyd(i-2, j)+9.d0*&
&     velyd(i, j)-velyd(i+1, j))+7.d0*(9.d0*velyd(i-1, j+1)-velyd(i-2, j&
&     +1)+9.d0*velyd(i, j+1)-velyd(i+1, j+1))+velyd(i-2, j+2)-9.d0*velyd&
&     (i-1, j+2)+velyd(i+1, j+2)-9.d0*velyd(i, j+2))
    val_o = ccross*(-(-vely(i-2, j-1)+9.d0*vely(i-1, j-1)+9.d0*vely(i, j&
&     -1)-vely(i+1, j-1))+7.d0*(-vely(i-2, j)+9.d0*vely(i-1, j)+9.d0*&
&     vely(i, j)-vely(i+1, j))+7.d0*(-vely(i-2, j+1)+9.d0*vely(i-1, j+1)&
&     +9.d0*vely(i, j+1)-vely(i+1, j+1))-(-vely(i-2, j+2)+9.d0*vely(i-1&
&     , j+2)+9.d0*vely(i, j+2)-vely(i+1, j+2)))
    vxd = volm1*(nx_n*val_nd+nx_s*val_sd+nx_o*val_od+nx_e*val_ed)
    vx = (val_n*nx_n+val_s*nx_s+val_o*nx_o+val_e*nx_e)*volm1
    vyd = volm1*(ny_n*val_nd+ny_s*val_sd+ny_o*val_od+ny_e*val_ed)
    vy = (val_n*ny_n+val_s*ny_s+val_o*ny_o+val_e*ny_e)*volm1
    val_nd = twentyfourth*(26.d0*velzd(i, j)-velzd(i+1, j)-velzd(i-1, j)&
&     )
    val_n = twentyfourth*(-velz(i+1, j)+26.d0*velz(i, j)-velz(i-1, j))
    val_sd = twentyfourth*(26.d0*velzd(i-1, j)-velzd(i, j)-velzd(i-2, j)&
&     )
    val_s = twentyfourth*(-velz(i, j)+26.d0*velz(i-1, j)-velz(i-2, j))
    val_ed = ccross*(velzd(i-2, j-2)-9.d0*velzd(i-1, j-2)-9.d0*velzd(i, &
&     j-2)+velzd(i+1, j-2)+7.d0*(9.d0*velzd(i-1, j-1)-velzd(i-2, j-1)+&
&     9.d0*velzd(i, j-1)-velzd(i+1, j-1))+7.d0*(9.d0*velzd(i-1, j)-velzd&
&     (i-2, j)+9.d0*velzd(i, j)-velzd(i+1, j))+velzd(i-2, j+1)-9.d0*&
&     velzd(i-1, j+1)+velzd(i+1, j+1)-9.d0*velzd(i, j+1))
    val_e = ccross*(-(-velz(i-2, j-2)+9.d0*velz(i-1, j-2)+9.d0*velz(i, j&
&     -2)-velz(i+1, j-2))+7.d0*(-velz(i-2, j-1)+9.d0*velz(i-1, j-1)+9.d0&
&     *velz(i, j-1)-velz(i+1, j-1))+7.d0*(-velz(i-2, j)+9.d0*velz(i-1, j&
&     )+9.d0*velz(i, j)-velz(i+1, j))-(-velz(i-2, j+1)+9.d0*velz(i-1, j+&
&     1)+9.d0*velz(i, j+1)-velz(i+1, j+1)))
    val_od = ccross*(velzd(i-2, j-1)-9.d0*velzd(i-1, j-1)-9.d0*velzd(i, &
&     j-1)+velzd(i+1, j-1)+7.d0*(9.d0*velzd(i-1, j)-velzd(i-2, j)+9.d0*&
&     velzd(i, j)-velzd(i+1, j))+7.d0*(9.d0*velzd(i-1, j+1)-velzd(i-2, j&
&     +1)+9.d0*velzd(i, j+1)-velzd(i+1, j+1))+velzd(i-2, j+2)-9.d0*velzd&
&     (i-1, j+2)+velzd(i+1, j+2)-9.d0*velzd(i, j+2))
    val_o = ccross*(-(-velz(i-2, j-1)+9.d0*velz(i-1, j-1)+9.d0*velz(i, j&
&     -1)-velz(i+1, j-1))+7.d0*(-velz(i-2, j)+9.d0*velz(i-1, j)+9.d0*&
&     velz(i, j)-velz(i+1, j))+7.d0*(-velz(i-2, j+1)+9.d0*velz(i-1, j+1)&
&     +9.d0*velz(i, j+1)-velz(i+1, j+1))-(-velz(i-2, j+2)+9.d0*velz(i-1&
&     , j+2)+9.d0*velz(i, j+2)-velz(i+1, j+2)))
    wxd = volm1*(nx_n*val_nd+nx_s*val_sd+nx_o*val_od+nx_e*val_ed)
    wx = (val_n*nx_n+val_s*nx_s+val_o*nx_o+val_e*nx_e)*volm1
    wyd = volm1*(ny_n*val_nd+ny_s*val_sd+ny_o*val_od+ny_e*val_ed)
    wy = (val_n*ny_n+val_s*ny_s+val_o*ny_o+val_e*ny_e)*volm1
    val_nd = twentyfourth*(26.d0*tlocd(i, j)-tlocd(i+1, j)-tlocd(i-1, j)&
&     )
    val_n = twentyfourth*(-tloc(i+1, j)+26.d0*tloc(i, j)-tloc(i-1, j))
    val_sd = twentyfourth*(26.d0*tlocd(i-1, j)-tlocd(i, j)-tlocd(i-2, j)&
&     )
    val_s = twentyfourth*(-tloc(i, j)+26.d0*tloc(i-1, j)-tloc(i-2, j))
    val_ed = ccross*(tlocd(i-2, j-2)-9.d0*tlocd(i-1, j-2)-9.d0*tlocd(i, &
&     j-2)+tlocd(i+1, j-2)+7.d0*(9.d0*tlocd(i-1, j-1)-tlocd(i-2, j-1)+&
&     9.d0*tlocd(i, j-1)-tlocd(i+1, j-1))+7.d0*(9.d0*tlocd(i-1, j)-tlocd&
&     (i-2, j)+9.d0*tlocd(i, j)-tlocd(i+1, j))+tlocd(i-2, j+1)-9.d0*&
&     tlocd(i-1, j+1)+tlocd(i+1, j+1)-9.d0*tlocd(i, j+1))
    val_e = ccross*(-(-tloc(i-2, j-2)+9.d0*tloc(i-1, j-2)+9.d0*tloc(i, j&
&     -2)-tloc(i+1, j-2))+7.d0*(-tloc(i-2, j-1)+9.d0*tloc(i-1, j-1)+9.d0&
&     *tloc(i, j-1)-tloc(i+1, j-1))+7.d0*(-tloc(i-2, j)+9.d0*tloc(i-1, j&
&     )+9.d0*tloc(i, j)-tloc(i+1, j))-(-tloc(i-2, j+1)+9.d0*tloc(i-1, j+&
&     1)+9.d0*tloc(i, j+1)-tloc(i+1, j+1)))
    val_od = ccross*(tlocd(i-2, j-1)-9.d0*tlocd(i-1, j-1)-9.d0*tlocd(i, &
&     j-1)+tlocd(i+1, j-1)+7.d0*(9.d0*tlocd(i-1, j)-tlocd(i-2, j)+9.d0*&
&     tlocd(i, j)-tlocd(i+1, j))+7.d0*(9.d0*tlocd(i-1, j+1)-tlocd(i-2, j&
&     +1)+9.d0*tlocd(i, j+1)-tlocd(i+1, j+1))+tlocd(i-2, j+2)-9.d0*tlocd&
&     (i-1, j+2)+tlocd(i+1, j+2)-9.d0*tlocd(i, j+2))
    val_o = ccross*(-(-tloc(i-2, j-1)+9.d0*tloc(i-1, j-1)+9.d0*tloc(i, j&
&     -1)-tloc(i+1, j-1))+7.d0*(-tloc(i-2, j)+9.d0*tloc(i-1, j)+9.d0*&
&     tloc(i, j)-tloc(i+1, j))+7.d0*(-tloc(i-2, j+1)+9.d0*tloc(i-1, j+1)&
&     +9.d0*tloc(i, j+1)-tloc(i+1, j+1))-(-tloc(i-2, j+2)+9.d0*tloc(i-1&
&     , j+2)+9.d0*tloc(i, j+2)-tloc(i+1, j+2)))
    txd = volm1*(nx_n*val_nd+nx_s*val_sd+nx_o*val_od+nx_e*val_ed)
    tx = (val_n*nx_n+val_s*nx_s+val_o*nx_o+val_e*nx_e)*volm1
    tyd = volm1*(ny_n*val_nd+ny_s*val_sd+ny_o*val_od+ny_e*val_ed)
    ty = (val_n*ny_n+val_s*ny_s+val_o*ny_o+val_e*ny_e)*volm1
!
! Computation of viscous fluxes
!
    uud = 0.0625d0*(9.d0*velxd(i-1, j)-velxd(i-2, j)+9.d0*velxd(i, j)-&
&     velxd(i+1, j))
    uu = 0.0625d0*(-velx(i-2, j)+9.d0*velx(i-1, j)+9.d0*velx(i, j)-velx(&
&     i+1, j))
    vvd = 0.0625d0*(9.d0*velyd(i-1, j)-velyd(i-2, j)+9.d0*velyd(i, j)-&
&     velyd(i+1, j))
    vv = 0.0625d0*(-vely(i-2, j)+9.d0*vely(i-1, j)+9.d0*vely(i, j)-vely(&
&     i+1, j))
    wwd = 0.0625d0*(9.d0*velzd(i-1, j)-velzd(i-2, j)+9.d0*velzd(i, j)-&
&     velzd(i+1, j))
    ww = 0.0625d0*(-velz(i-2, j)+9.d0*velz(i-1, j)+9.d0*velz(i, j)-velz(&
&     i+1, j))
!
    mmud = 0.0625d0*(9.d0*mud(i-1, j)-mud(i-2, j)+9.d0*mud(i, j)-mud(i+1&
&     , j))
    mmu = 0.0625d0*(-mu(i-2, j)+9.d0*mu(i-1, j)+9.d0*mu(i, j)-mu(i+1, j)&
&     )
    lambdad = cpprandtl*mmud
    lambda = mmu*cpprandtl
!
    fvrou1d = twothird*((two*ux-vy)*mmud+mmu*(two*uxd-vyd))
    fvrou1 = twothird*mmu*(two*ux-vy)
    fvrov1d = (uy+vx)*mmud + mmu*(uyd+vxd)
    fvrov1 = mmu*(uy+vx)
    fvrow1d = wx*mmud + mmu*wxd
    fvrow1 = mmu*wx
    fvroe1d = tx*lambdad + lambda*txd + fvrou1*uud + uu*fvrou1d + fvrov1&
&     *vvd + vv*fvrov1d + fvrow1*wwd + ww*fvrow1d
!
    gvrou1d = (uy+vx)*mmud + mmu*(uyd+vxd)
    gvrou1 = mmu*(uy+vx)
    gvrov1d = twothird*((two*vy-ux)*mmud+mmu*(two*vyd-uxd))
    gvrov1 = twothird*mmu*(-ux+two*vy)
    gvrow1d = wy*mmud + mmu*wyd
    gvrow1 = mmu*wy
    gvroe1d = ty*lambdad + lambda*tyd + gvrou1*uud + uu*gvrou1d + gvrov1&
&     *vvd + vv*gvrov1d + gvrow1*wwd + ww*gvrow1d
!!  fvrou1 = TWOTHIRD*mmu*( TWO*ux -     vy  -   wz  )
!!  fvrov1 =          mmu*(     uy +     vx          )
!!  fvrow1 =          mmu*(     uz           +   wx  )
!!  fvroe1 = lambda*tx + uu*fvrou1 + vv*fvrov1 + ww * fvrow1
!!  !
!!  gvrou1 =          mmu*(     uy +     vx          )
!!  gvrov1 = TWOTHIRD*mmu*(    -ux + TWO*vy   -  wz  )
!!  gvrow1 =          mmu*(              vz   +  wy  )
!!  gvroe1 = lambda*ty + uu*gvrou1 + vv*gvrov1 + ww * gvrow1
! grad for viscous fluxes o4 - 5p
!
! for coef ref Zhing et al, JCP2000 ou Shen et al AIAAP 2008
! 1/16 = 0.0625 ccross = 1/12*1/16
! TWENTYFOURTH = ONE/24.d0
! ccross = TWELFTH*0.0625d0
    volm1 = volf(i, j, 2)
    nx_n = half*(nx(i+1, j-1, 1)+nx(i+1, j, 1))
    nx_s = -(half*(nx(i, j-1, 1)+nx(i, j, 1)))
    nx_o = half*(nx(i, j+1, 2)+nx(i, j, 2))
    nx_e = -(half*(nx(i, j-1, 2)+nx(i, j, 2)))
!
    ny_n = half*(ny(i+1, j-1, 1)+ny(i+1, j, 1))
    ny_s = -(half*(ny(i, j-1, 1)+ny(i, j, 1)))
    ny_o = half*(ny(i, j+1, 2)+ny(i, j, 2))
    ny_e = -(half*(ny(i, j-1, 2)+ny(i, j, 2)))
    val_nd = ccross*(velxd(i-1, j-2)-9.d0*velxd(i-1, j-1)-9.d0*velxd(i-1&
&     , j)+velxd(i-1, j+1)+7.d0*(9.d0*velxd(i, j-1)-velxd(i, j-2)+9.d0*&
&     velxd(i, j)-velxd(i, j+1))+7.d0*(9.d0*velxd(i+1, j-1)-velxd(i+1, j&
&     -2)+9.d0*velxd(i+1, j)-velxd(i+1, j+1))+velxd(i+2, j-2)-9.d0*velxd&
&     (i+2, j-1)+velxd(i+2, j+1)-9.d0*velxd(i+2, j))
    val_n = ccross*(-(-velx(i-1, j-2)+9.d0*velx(i-1, j-1)+9.d0*velx(i-1&
&     , j)-velx(i-1, j+1))+7.d0*(-velx(i, j-2)+9.d0*velx(i, j-1)+9.d0*&
&     velx(i, j)-velx(i, j+1))+7.d0*(-velx(i+1, j-2)+9.d0*velx(i+1, j-1)&
&     +9.d0*velx(i+1, j)-velx(i+1, j+1))-(-velx(i+2, j-2)+9.d0*velx(i+2&
&     , j-1)+9.d0*velx(i+2, j)-velx(i+2, j+1)))
    val_sd = ccross*(velxd(i-2, j-2)-9.d0*velxd(i-2, j-1)-9.d0*velxd(i-2&
&     , j)+velxd(i-2, j+1)+7.d0*(9.d0*velxd(i-1, j-1)-velxd(i-1, j-2)+&
&     9.d0*velxd(i-1, j)-velxd(i-1, j+1))+7.d0*(9.d0*velxd(i, j-1)-velxd&
&     (i, j-2)+9.d0*velxd(i, j)-velxd(i, j+1))+velxd(i+1, j-2)-9.d0*&
&     velxd(i+1, j-1)+velxd(i+1, j+1)-9.d0*velxd(i+1, j))
    val_s = ccross*(-(-velx(i-2, j-2)+9.d0*velx(i-2, j-1)+9.d0*velx(i-2&
&     , j)-velx(i-2, j+1))+7.d0*(-velx(i-1, j-2)+9.d0*velx(i-1, j-1)+&
&     9.d0*velx(i-1, j)-velx(i-1, j+1))+7.d0*(-velx(i, j-2)+9.d0*velx(i&
&     , j-1)+9.d0*velx(i, j)-velx(i, j+1))-(-velx(i+1, j-2)+9.d0*velx(i+&
&     1, j-1)+9.d0*velx(i+1, j)-velx(i+1, j+1)))
    val_ed = twentyfourth*(26.d0*velxd(i, j-1)-velxd(i, j)-velxd(i, j-2)&
&     )
    val_e = twentyfourth*(-velx(i, j)+26.d0*velx(i, j-1)-velx(i, j-2))
    val_od = twentyfourth*(26.d0*velxd(i, j)-velxd(i, j+1)-velxd(i, j-1)&
&     )
    val_o = twentyfourth*(-velx(i, j+1)+26.d0*velx(i, j)-velx(i, j-1))
    uxd = volm1*(nx_n*val_nd+nx_s*val_sd+nx_o*val_od+nx_e*val_ed)
    ux = (val_n*nx_n+val_s*nx_s+val_o*nx_o+val_e*nx_e)*volm1
    uyd = volm1*(ny_n*val_nd+ny_s*val_sd+ny_o*val_od+ny_e*val_ed)
    uy = (val_n*ny_n+val_s*ny_s+val_o*ny_o+val_e*ny_e)*volm1
    val_nd = ccross*(velyd(i-1, j-2)-9.d0*velyd(i-1, j-1)-9.d0*velyd(i-1&
&     , j)+velyd(i-1, j+1)+7.d0*(9.d0*velyd(i, j-1)-velyd(i, j-2)+9.d0*&
&     velyd(i, j)-velyd(i, j+1))+7.d0*(9.d0*velyd(i+1, j-1)-velyd(i+1, j&
&     -2)+9.d0*velyd(i+1, j)-velyd(i+1, j+1))+velyd(i+2, j-2)-9.d0*velyd&
&     (i+2, j-1)+velyd(i+2, j+1)-9.d0*velyd(i+2, j))
    val_n = ccross*(-(-vely(i-1, j-2)+9.d0*vely(i-1, j-1)+9.d0*vely(i-1&
&     , j)-vely(i-1, j+1))+7.d0*(-vely(i, j-2)+9.d0*vely(i, j-1)+9.d0*&
&     vely(i, j)-vely(i, j+1))+7.d0*(-vely(i+1, j-2)+9.d0*vely(i+1, j-1)&
&     +9.d0*vely(i+1, j)-vely(i+1, j+1))-(-vely(i+2, j-2)+9.d0*vely(i+2&
&     , j-1)+9.d0*vely(i+2, j)-vely(i+2, j+1)))
    val_sd = ccross*(velyd(i-2, j-2)-9.d0*velyd(i-2, j-1)-9.d0*velyd(i-2&
&     , j)+velyd(i-2, j+1)+7.d0*(9.d0*velyd(i-1, j-1)-velyd(i-1, j-2)+&
&     9.d0*velyd(i-1, j)-velyd(i-1, j+1))+7.d0*(9.d0*velyd(i, j-1)-velyd&
&     (i, j-2)+9.d0*velyd(i, j)-velyd(i, j+1))+velyd(i+1, j-2)-9.d0*&
&     velyd(i+1, j-1)+velyd(i+1, j+1)-9.d0*velyd(i+1, j))
    val_s = ccross*(-(-vely(i-2, j-2)+9.d0*vely(i-2, j-1)+9.d0*vely(i-2&
&     , j)-vely(i-2, j+1))+7.d0*(-vely(i-1, j-2)+9.d0*vely(i-1, j-1)+&
&     9.d0*vely(i-1, j)-vely(i-1, j+1))+7.d0*(-vely(i, j-2)+9.d0*vely(i&
&     , j-1)+9.d0*vely(i, j)-vely(i, j+1))-(-vely(i+1, j-2)+9.d0*vely(i+&
&     1, j-1)+9.d0*vely(i+1, j)-vely(i+1, j+1)))
    val_ed = twentyfourth*(26.d0*velyd(i, j-1)-velyd(i, j)-velyd(i, j-2)&
&     )
    val_e = twentyfourth*(-vely(i, j)+26.d0*vely(i, j-1)-vely(i, j-2))
    val_od = twentyfourth*(26.d0*velyd(i, j)-velyd(i, j+1)-velyd(i, j-1)&
&     )
    val_o = twentyfourth*(-vely(i, j+1)+26.d0*vely(i, j)-vely(i, j-1))
    vxd = volm1*(nx_n*val_nd+nx_s*val_sd+nx_o*val_od+nx_e*val_ed)
    vx = (val_n*nx_n+val_s*nx_s+val_o*nx_o+val_e*nx_e)*volm1
    vyd = volm1*(ny_n*val_nd+ny_s*val_sd+ny_o*val_od+ny_e*val_ed)
    vy = (val_n*ny_n+val_s*ny_s+val_o*ny_o+val_e*ny_e)*volm1
    val_nd = ccross*(velzd(i-1, j-2)-9.d0*velzd(i-1, j-1)-9.d0*velzd(i-1&
&     , j)+velzd(i-1, j+1)+7.d0*(9.d0*velzd(i, j-1)-velzd(i, j-2)+9.d0*&
&     velzd(i, j)-velzd(i, j+1))+7.d0*(9.d0*velzd(i+1, j-1)-velzd(i+1, j&
&     -2)+9.d0*velzd(i+1, j)-velzd(i+1, j+1))+velzd(i+2, j-2)-9.d0*velzd&
&     (i+2, j-1)+velzd(i+2, j+1)-9.d0*velzd(i+2, j))
    val_n = ccross*(-(-velz(i-1, j-2)+9.d0*velz(i-1, j-1)+9.d0*velz(i-1&
&     , j)-velz(i-1, j+1))+7.d0*(-velz(i, j-2)+9.d0*velz(i, j-1)+9.d0*&
&     velz(i, j)-velz(i, j+1))+7.d0*(-velz(i+1, j-2)+9.d0*velz(i+1, j-1)&
&     +9.d0*velz(i+1, j)-velz(i+1, j+1))-(-velz(i+2, j-2)+9.d0*velz(i+2&
&     , j-1)+9.d0*velz(i+2, j)-velz(i+2, j+1)))
    val_sd = ccross*(velzd(i-2, j-2)-9.d0*velzd(i-2, j-1)-9.d0*velzd(i-2&
&     , j)+velzd(i-2, j+1)+7.d0*(9.d0*velzd(i-1, j-1)-velzd(i-1, j-2)+&
&     9.d0*velzd(i-1, j)-velzd(i-1, j+1))+7.d0*(9.d0*velzd(i, j-1)-velzd&
&     (i, j-2)+9.d0*velzd(i, j)-velzd(i, j+1))+velzd(i+1, j-2)-9.d0*&
&     velzd(i+1, j-1)+velzd(i+1, j+1)-9.d0*velzd(i+1, j))
    val_s = ccross*(-(-velz(i-2, j-2)+9.d0*velz(i-2, j-1)+9.d0*velz(i-2&
&     , j)-velz(i-2, j+1))+7.d0*(-velz(i-1, j-2)+9.d0*velz(i-1, j-1)+&
&     9.d0*velz(i-1, j)-velz(i-1, j+1))+7.d0*(-velz(i, j-2)+9.d0*velz(i&
&     , j-1)+9.d0*velz(i, j)-velz(i, j+1))-(-velz(i+1, j-2)+9.d0*velz(i+&
&     1, j-1)+9.d0*velz(i+1, j)-velz(i+1, j+1)))
    val_ed = twentyfourth*(26.d0*velzd(i, j-1)-velzd(i, j)-velzd(i, j-2)&
&     )
    val_e = twentyfourth*(-velz(i, j)+26.d0*velz(i, j-1)-velz(i, j-2))
    val_od = twentyfourth*(26.d0*velzd(i, j)-velzd(i, j+1)-velzd(i, j-1)&
&     )
    val_o = twentyfourth*(-velz(i, j+1)+26.d0*velz(i, j)-velz(i, j-1))
    wxd = volm1*(nx_n*val_nd+nx_s*val_sd+nx_o*val_od+nx_e*val_ed)
    wx = (val_n*nx_n+val_s*nx_s+val_o*nx_o+val_e*nx_e)*volm1
    wyd = volm1*(ny_n*val_nd+ny_s*val_sd+ny_o*val_od+ny_e*val_ed)
    wy = (val_n*ny_n+val_s*ny_s+val_o*ny_o+val_e*ny_e)*volm1
    val_nd = ccross*(tlocd(i-1, j-2)-9.d0*tlocd(i-1, j-1)-9.d0*tlocd(i-1&
&     , j)+tlocd(i-1, j+1)+7.d0*(9.d0*tlocd(i, j-1)-tlocd(i, j-2)+9.d0*&
&     tlocd(i, j)-tlocd(i, j+1))+7.d0*(9.d0*tlocd(i+1, j-1)-tlocd(i+1, j&
&     -2)+9.d0*tlocd(i+1, j)-tlocd(i+1, j+1))+tlocd(i+2, j-2)-9.d0*tlocd&
&     (i+2, j-1)+tlocd(i+2, j+1)-9.d0*tlocd(i+2, j))
    val_n = ccross*(-(-tloc(i-1, j-2)+9.d0*tloc(i-1, j-1)+9.d0*tloc(i-1&
&     , j)-tloc(i-1, j+1))+7.d0*(-tloc(i, j-2)+9.d0*tloc(i, j-1)+9.d0*&
&     tloc(i, j)-tloc(i, j+1))+7.d0*(-tloc(i+1, j-2)+9.d0*tloc(i+1, j-1)&
&     +9.d0*tloc(i+1, j)-tloc(i+1, j+1))-(-tloc(i+2, j-2)+9.d0*tloc(i+2&
&     , j-1)+9.d0*tloc(i+2, j)-tloc(i+2, j+1)))
    val_sd = ccross*(tlocd(i-2, j-2)-9.d0*tlocd(i-2, j-1)-9.d0*tlocd(i-2&
&     , j)+tlocd(i-2, j+1)+7.d0*(9.d0*tlocd(i-1, j-1)-tlocd(i-1, j-2)+&
&     9.d0*tlocd(i-1, j)-tlocd(i-1, j+1))+7.d0*(9.d0*tlocd(i, j-1)-tlocd&
&     (i, j-2)+9.d0*tlocd(i, j)-tlocd(i, j+1))+tlocd(i+1, j-2)-9.d0*&
&     tlocd(i+1, j-1)+tlocd(i+1, j+1)-9.d0*tlocd(i+1, j))
    val_s = ccross*(-(-tloc(i-2, j-2)+9.d0*tloc(i-2, j-1)+9.d0*tloc(i-2&
&     , j)-tloc(i-2, j+1))+7.d0*(-tloc(i-1, j-2)+9.d0*tloc(i-1, j-1)+&
&     9.d0*tloc(i-1, j)-tloc(i-1, j+1))+7.d0*(-tloc(i, j-2)+9.d0*tloc(i&
&     , j-1)+9.d0*tloc(i, j)-tloc(i, j+1))-(-tloc(i+1, j-2)+9.d0*tloc(i+&
&     1, j-1)+9.d0*tloc(i+1, j)-tloc(i+1, j+1)))
    val_ed = twentyfourth*(26.d0*tlocd(i, j-1)-tlocd(i, j)-tlocd(i, j-2)&
&     )
    val_e = twentyfourth*(-tloc(i, j)+26.d0*tloc(i, j-1)-tloc(i, j-2))
    val_od = twentyfourth*(26.d0*tlocd(i, j)-tlocd(i, j+1)-tlocd(i, j-1)&
&     )
    val_o = twentyfourth*(-tloc(i, j+1)+26.d0*tloc(i, j)-tloc(i, j-1))
    txd = volm1*(nx_n*val_nd+nx_s*val_sd+nx_o*val_od+nx_e*val_ed)
    tx = (val_n*nx_n+val_s*nx_s+val_o*nx_o+val_e*nx_e)*volm1
    tyd = volm1*(ny_n*val_nd+ny_s*val_sd+ny_o*val_od+ny_e*val_ed)
    ty = (val_n*ny_n+val_s*ny_s+val_o*ny_o+val_e*ny_e)*volm1
    uud = 0.0625d0*(9.d0*velxd(i, j-1)-velxd(i, j-2)+9.d0*velxd(i, j)-&
&     velxd(i, j+1))
    uu = 0.0625d0*(-velx(i, j-2)+9.d0*velx(i, j-1)+9.d0*velx(i, j)-velx(&
&     i, j+1))
    vvd = 0.0625d0*(9.d0*velyd(i, j-1)-velyd(i, j-2)+9.d0*velyd(i, j)-&
&     velyd(i, j+1))
    vv = 0.0625d0*(-vely(i, j-2)+9.d0*vely(i, j-1)+9.d0*vely(i, j)-vely(&
&     i, j+1))
    wwd = 0.0625d0*(9.d0*velzd(i, j-1)-velzd(i, j-2)+9.d0*velzd(i, j)-&
&     velzd(i, j+1))
    ww = 0.0625d0*(-velz(i, j-2)+9.d0*velz(i, j-1)+9.d0*velz(i, j)-velz(&
&     i, j+1))
!
    mmud = 0.0625d0*(9.d0*mud(i, j-1)-mud(i, j-2)+9.d0*mud(i, j)-mud(i, &
&     j+1))
    mmu = 0.0625d0*(-mu(i, j-2)+9.d0*mu(i, j-1)+9.d0*mu(i, j)-mu(i, j+1)&
&     )
    lambdad = cpprandtl*mmud
    lambda = mmu*cpprandtl
!
    fvrou2d = twothird*((two*ux-vy)*mmud+mmu*(two*uxd-vyd))
    fvrou2 = twothird*mmu*(two*ux-vy)
    fvrov2d = (uy+vx)*mmud + mmu*(uyd+vxd)
    fvrov2 = mmu*(uy+vx)
    fvrow2d = wx*mmud + mmu*wxd
    fvrow2 = mmu*wx
    fvroe2d = tx*lambdad + lambda*txd + fvrou2*uud + uu*fvrou2d + fvrov2&
&     *vvd + vv*fvrov2d + fvrow2*wwd + ww*fvrow2d
    gvrou2d = (uy+vx)*mmud + mmu*(uyd+vxd)
    gvrou2 = mmu*(uy+vx)
    gvrov2d = twothird*((two*vy-ux)*mmud+mmu*(two*vyd-uxd))
    gvrov2 = twothird*mmu*(-ux+two*vy)
    gvrow2d = wy*mmud + mmu*wyd
    gvrow2 = mmu*wy
    gvroe2d = ty*lambdad + lambda*tyd + gvrou2*uud + uu*gvrou2d + gvrov2&
&     *vvd + vv*gvrov2d + gvrow2*wwd + ww*gvrow2d
!!  fvrou2 = TWOTHIRD*mmu*( TWO*ux -     vy  -  wz  )
!!  fvrov2 =          mmu*(     uy +     vx         )
!!  fvrow2 =          mmu*(     uz           +  wx  )
!!  fvroe2 = (lambda*tx + uu*fvrou2 + vv*fvrov2 + ww * fvrow2)
!!
!!  gvrou2 =          mmu*(     uy +     vx       )
!!  gvrov2 = TWOTHIRD*mmu*(    -ux + TWO*vy -  wz )
!!  gvrow2 =          mmu*(              vz +  wy )
!!  gvroe2 = (lambda*ty + uu*gvrou2 + vv*gvrov2 + ww*gvrow2)
! #include "rhs/spectralradius_i.F"
! correction Rossow JCP 2000
!#include "rhs/spectralradiusRossow_i.F"
!1st direction
    rhomrd = wd(i, j, 1)
    rhomr = w(i, j, 1)
    temp0 = w(i, j, 2)/rhomr
    urd = (wd(i, j, 2)-temp0*rhomrd)/rhomr
    ur = temp0
    temp0 = w(i, j, 3)/rhomr
    vrd = (wd(i, j, 3)-temp0*rhomrd)/rhomr
    vr = temp0
    c2rd = gam*rgaz*tlocd(i, j)
    c2r = gam*rgaz*tloc(i, j)
!
    rhomld = wd(i-1, j, 1)
    rhoml = w(i-1, j, 1)
    temp0 = w(i-1, j, 2)/rhoml
    uld = (wd(i-1, j, 2)-temp0*rhomld)/rhoml
    ul = temp0
    temp0 = w(i-1, j, 3)/rhoml
    vld = (wd(i-1, j, 3)-temp0*rhomld)/rhoml
    vl = temp0
    c2ld = gam*rgaz*tlocd(i-1, j)
    c2l = gam*rgaz*tloc(i-1, j)
!
    temp0 = rhomr/rhoml
    temp = SQRT(temp0)
    IF (temp0 .EQ. 0.0) THEN
      rd = 0.0_8
    ELSE
      rd = (rhomrd-temp0*rhomld)/(2.0*temp*rhoml)
    END IF
    r = temp
    temp0 = one/(one+r)
    rrd = -(temp0*rd/(one+r))
    rr = temp0
    omrrd = -rrd
    omrr = one - rr
!
    ud = rr*uld + ul*rrd + omrr*urd + ur*omrrd
    u = ul*rr + ur*omrr
    vd = rr*vld + vl*rrd + omrr*vrd + vr*omrrd
    v = vl*rr + vr*omrr
!
    c2xd = rr*c2ld + c2l*rrd + omrr*c2rd + c2r*omrrd
    c2x = c2l*rr + c2r*omrr
    nx2 = nx(i, j, 1)*nx(i, j, 1) + ny(i, j, 1)*ny(i, j, 1)
    x3d = nx(i, j, 1)*ud + ny(i, j, 1)*vd
    x3 = nx(i, j, 1)*u + ny(i, j, 1)*v
    IF (x3 .GE. 0.) THEN
      abd = x3d
      ab = x3
    ELSE
      abd = -x3d
      ab = -x3
    END IF
    temp0 = SQRT(nx2*c2x)
    IF (nx2*c2x .EQ. 0.0) THEN
      sqd = 0.0_8
    ELSE
      sqd = nx2*c2xd/(2.0*temp0)
    END IF
    sq = temp0
!
    rspecd = abd + sqd
    rspec = ab + sq
    IF (p(i-1, j) - two*p(i, j) + p(i+1, j) .GE. 0.) THEN
      abs4d = pd(i-1, j) - two*pd(i, j) + pd(i+1, j)
      abs4 = p(i-1, j) - two*p(i, j) + p(i+1, j)
    ELSE
      abs4d = two*pd(i, j) - pd(i-1, j) - pd(i+1, j)
      abs4 = -(p(i-1, j)-two*p(i, j)+p(i+1, j))
    END IF
    x12d = pd(i-1, j) + two*pd(i, j) + pd(i+1, j)
    x12 = p(i-1, j) + two*p(i, j) + p(i+1, j)
    IF (x12 .GE. 0.) THEN
      abs18d = x12d
      abs18 = x12
    ELSE
      abs18d = -x12d
      abs18 = -x12
    END IF
!
!1st direction
    k_sensor1d = (abs4d-abs4*abs18d/abs18)/abs18
    k_sensor1 = abs4/abs18
    IF (p(i-2, j) - two*p(i-1, j) + p(i, j) .GE. 0.) THEN
      abs5d = pd(i-2, j) - two*pd(i-1, j) + pd(i, j)
      abs5 = p(i-2, j) - two*p(i-1, j) + p(i, j)
    ELSE
      abs5d = two*pd(i-1, j) - pd(i-2, j) - pd(i, j)
      abs5 = -(p(i-2, j)-two*p(i-1, j)+p(i, j))
    END IF
    x13d = pd(i-2, j) + two*pd(i-1, j) + pd(i, j)
    x13 = p(i-2, j) + two*p(i-1, j) + p(i, j)
    IF (x13 .GE. 0.) THEN
      abs19d = x13d
      abs19 = x13
    ELSE
      abs19d = -x13d
      abs19 = -x13
    END IF
    k_sensor2d = (abs5d-abs5*abs19d/abs19)/abs19
    k_sensor2 = abs5/abs19
    divud = gradud(i, j, 1) + gradvd(i, j, 2)
    divu = gradu(i, j, 1) + gradv(i, j, 2)
    divu2d = 2*divu*divud
    divu2 = divu*divu
    vort2d = 2*(gradv(i, j, 1)-gradu(i, j, 2))*(gradvd(i, j, 1)-gradud(i&
&     , j, 2))
    vort2 = (gradv(i, j, 1)-gradu(i, j, 2))*(gradv(i, j, 1)-gradu(i, j, &
&     2))
    temp0 = divu2/(divu2+vort2+1d-15)
    ducros1d = (divu2d-temp0*(divu2d+vort2d))/(divu2+vort2+1d-15)
    ducros1 = temp0
! dxm1      = HALF*(ONE-tanh(2.5d0+10.d0*vol(i,j)/(sq+1.d-15)*divu) )
    arg1d = nx2*c2rd
    arg1 = c2r*nx2
    temp0 = SQRT(arg1)
    IF (arg1 .EQ. 0.0) THEN
      result1d = 0.0_8
    ELSE
      result1d = arg1d/(2.0*temp0)
    END IF
    result1 = temp0
    temp0 = 10.d0*vol(i, j)
    temp = divu/(result1+1.d-15)
    arg2d = temp0*(divud-temp*result1d)/(result1+1.d-15)
    arg2 = temp0*temp + 2.5d0
    dxm1d = -(half*(1.0-TANH(arg2)**2)*arg2d)
    dxm1 = half*(one-TANH(arg2))
    divud = gradud(i-1, j, 1) + gradvd(i-1, j, 2)
    divu = gradu(i-1, j, 1) + gradv(i-1, j, 2)
    divu2d = 2*divu*divud
    divu2 = divu*divu
    vort2d = 2*(gradv(i-1, j, 1)-gradu(i-1, j, 2))*(gradvd(i-1, j, 1)-&
&     gradud(i-1, j, 2))
    vort2 = (gradv(i-1, j, 1)-gradu(i-1, j, 2))*(gradv(i-1, j, 1)-gradu(&
&     i-1, j, 2))
    temp0 = divu2/(divu2+vort2+1d-15)
    ducros2d = (divu2d-temp0*(divu2d+vort2d))/(divu2+vort2+1d-15)
    ducros2 = temp0
! dxm2      = HALF*(ONE-tanh(2.5d0+10.d0*vol(i-1,j)/(sq+1.d-15)*divu) )
    arg1d = nx2*c2ld
    arg1 = c2l*nx2
    temp0 = SQRT(arg1)
    IF (arg1 .EQ. 0.0) THEN
      result1d = 0.0_8
    ELSE
      result1d = arg1d/(2.0*temp0)
    END IF
    result1 = temp0
    temp0 = 10.d0*vol(i-1, j)
    temp = divu/(result1+1.d-15)
    arg2d = temp0*(divud-temp*result1d)/(result1+1.d-15)
    arg2 = temp0*temp + 2.5d0
    dxm2d = -(half*(1.0-TANH(arg2)**2)*arg2d)
    dxm2 = half*(one-TANH(arg2))
    IF (k_sensor1 .LT. k_sensor2) THEN
      max3d = k_sensor2d
      max3 = k_sensor2
    ELSE
      max3d = k_sensor1d
      max3 = k_sensor1
    END IF
    IF (ducros1 .LT. ducros2) THEN
      max10d = ducros2d
      max10 = ducros2
    ELSE
      max10d = ducros1d
      max10 = ducros1
    END IF
    IF (dxm1 .LT. dxm2) THEN
      max17d = dxm2d
      max17 = dxm2
    ELSE
      max17d = dxm1d
      max17 = dxm1
    END IF
!coef      = MAX( k_sensor1*ducros1*dxm1, &
!                 k_sensor2*ducros2*dxm2)
    coefd = max17*(max10*max3d+max3*max10d) + max3*max10*max17d
    coef = max3*max10*max17
!     ! extension of shock capturing
!
!k_sensor1 = ABS(p(i,j) - TWO*p(i+1,j) + p(i+2,j)) / &
!            ABS(p(i,j) + TWO*p(i+1,j) + p(i+2,j))
!
!k_sensor2 = ABS(p(i-3,j) - TWO*p(i-2,j) + p(i-1,j)) / &
!            ABS(p(i-3,j) + TWO*p(i-2,j) + p(i-1,j))
!
!divu      = gradu(i+1,j,1)+gradv(i+1,j,2)
!divu2     = divu*divu
!vort2     = (gradv(i+1,j,1)-gradu(i+1,j,2)) * (gradv(i+1,j,1)-gradu(i+1,j,2))
!ducros1   = divu2/(divu2+vort2+1d-15)
!dxm1      = HALF*(ONE-tanh(2.5d0+10.d0*vol(i+1,j)/(sq+1.d-15)*divu) )
!
!
!divu      = gradu(i-2,j,1)+gradv(i-2,j,2)
!divu2     = divu*divu
!vort2     = (gradv(i-2,j,1)-gradu(i-2,j,2)) * (gradv(i-2,j,1)-gradu(i-2,j,2))
!ducros2   = divu2/(divu2+vort2+1d-15)
!dxm2      = HALF*(ONE-tanh(2.5d0+10.d0*vol(i-2,j)/(sq+1.d-15)*divu) )
!coef      = MAX( k_sensor1*ducros1*dxm1, &
!                 k_sensor2*ducros2*dxm2, coef)
!coef      = MAX(sensor(i-1,j  ,1), sensor(i,j  ,1), &
!                sensor(i-1,j-1,1), sensor(i,j-1,1), &
!                sensor(i-1,j+1,1), sensor(i,j+1,1)  )
!
!coef      = MAX(sensor(i-3,j,1), sensor(i-2,j,1), &
!                sensor(i-1,j,1), sensor(i  ,j,1), &
!                sensor(i+1,j,1), sensor(i+2,j,1)  )
!
!coef      = MAX(sensor(i-2,j,1), &
!                sensor(i-1,j,1), sensor(i  ,j,1), &
!                sensor(i+1,j,1))
!
!rspec      = rconv(i,j,1)
!
    eps2d = k2*coefd
    eps2 = k2*coef
    IF (zero .LT. k4 - eps2*12.d0) THEN
      eps4d = -(12.d0*eps2d)
      eps4 = k4 - eps2*12.d0
    ELSE
      eps4 = zero
      eps4d = 0.0_8
    END IF
    diffrod = half*(wd(i, j, 1)-wd(i-1, j, 1))
    diffro = half*(w(i, j, 1)-w(i-1, j, 1))
    diffroud = half*(wd(i, j, 2)-wd(i-1, j, 2))
    diffrou = half*(w(i, j, 2)-w(i-1, j, 2))
    diffrovd = half*(wd(i, j, 3)-wd(i-1, j, 3))
    diffrov = half*(w(i, j, 3)-w(i-1, j, 3))
    diffrowd = half*(wd(i, j, 4)-wd(i-1, j, 4))
    diffrow = half*(w(i, j, 4)-w(i-1, j, 4))
    diffroed = half*(wd(i, j, 5)-wd(i-1, j, 5))
    diffroe = half*(w(i, j, 5)-w(i-1, j, 5))
!
!
!     if (eps4.gt.1.d-12) then
! #include "rhs/wiggle_diri.F"
!     endif
    temp0 = eps2*diffro + eps4*predro1
    dissro1d = temp0*rspecd + rspec*(diffro*eps2d+eps2*diffrod+predro1*&
&     eps4d+eps4*predro1d)
    temp0 = eps2*diffrou + eps4*predrou1
    dissrou1d = temp0*rspecd + rspec*(diffrou*eps2d+eps2*diffroud+&
&     predrou1*eps4d+eps4*predrou1d)
    temp0 = eps2*diffrov + eps4*predrov1
    dissrov1d = temp0*rspecd + rspec*(diffrov*eps2d+eps2*diffrovd+&
&     predrov1*eps4d+eps4*predrov1d)
    temp0 = eps2*diffrow + eps4*predrow1
    dissrow1d = temp0*rspecd + rspec*(diffrow*eps2d+eps2*diffrowd+&
&     predrow1*eps4d+eps4*predrow1d)
    temp0 = eps2*diffroe + eps4*predroe1
    dissroe1d = temp0*rspecd + rspec*(diffroe*eps2d+eps2*diffroed+&
&     predroe1*eps4d+eps4*predroe1d)
! #include "rhs/spectralradius_j.F"
! correction Rossow JCP 2000
!#include "rhs/spectralradiusRossow_j.F"
!1st direction
    rhomrd = wd(i, j, 1)
    rhomr = w(i, j, 1)
    temp0 = w(i, j, 2)/rhomr
    urd = (wd(i, j, 2)-temp0*rhomrd)/rhomr
    ur = temp0
    temp0 = w(i, j, 3)/rhomr
    vrd = (wd(i, j, 3)-temp0*rhomrd)/rhomr
    vr = temp0
    c2rd = gam*rgaz*tlocd(i, j)
    c2r = gam*rgaz*tloc(i, j)
!
    rhomld = wd(i, j-1, 1)
    rhoml = w(i, j-1, 1)
    temp0 = w(i, j-1, 2)/rhoml
    uld = (wd(i, j-1, 2)-temp0*rhomld)/rhoml
    ul = temp0
    temp0 = w(i, j-1, 3)/rhoml
    vld = (wd(i, j-1, 3)-temp0*rhomld)/rhoml
    vl = temp0
    c2ld = gam*rgaz*tlocd(i, j-1)
    c2l = gam*rgaz*tloc(i, j-1)
!
    temp0 = rhomr/rhoml
    temp = SQRT(temp0)
    IF (temp0 .EQ. 0.0) THEN
      rd = 0.0_8
    ELSE
      rd = (rhomrd-temp0*rhomld)/(2.0*temp*rhoml)
    END IF
    r = temp
    temp0 = one/(one+r)
    rrd = -(temp0*rd/(one+r))
    rr = temp0
    omrrd = -rrd
    omrr = one - rr
!
    ud = rr*uld + ul*rrd + omrr*urd + ur*omrrd
    u = ul*rr + ur*omrr
    vd = rr*vld + vl*rrd + omrr*vrd + vr*omrrd
    v = vl*rr + vr*omrr
!
    c2xd = rr*c2ld + c2l*rrd + omrr*c2rd + c2r*omrrd
    c2x = c2l*rr + c2r*omrr
    nx2 = nx(i, j, 2)*nx(i, j, 2) + ny(i, j, 2)*ny(i, j, 2)
    x4d = nx(i, j, 2)*ud + ny(i, j, 2)*vd
    x4 = nx(i, j, 2)*u + ny(i, j, 2)*v
    IF (x4 .GE. 0.) THEN
      abd = x4d
      ab = x4
    ELSE
      abd = -x4d
      ab = -x4
    END IF
    temp0 = SQRT(nx2*c2x)
    IF (nx2*c2x .EQ. 0.0) THEN
      sqd = 0.0_8
    ELSE
      sqd = nx2*c2xd/(2.0*temp0)
    END IF
    sq = temp0
!
    rspecd = abd + sqd
    rspec = ab + sq
    IF (p(i, j-1) - two*p(i, j) + p(i, j+1) .GE. 0.) THEN
      abs6d = pd(i, j-1) - two*pd(i, j) + pd(i, j+1)
      abs6 = p(i, j-1) - two*p(i, j) + p(i, j+1)
    ELSE
      abs6d = two*pd(i, j) - pd(i, j-1) - pd(i, j+1)
      abs6 = -(p(i, j-1)-two*p(i, j)+p(i, j+1))
    END IF
    x14d = pd(i, j-1) + two*pd(i, j) + pd(i, j+1)
    x14 = p(i, j-1) + two*p(i, j) + p(i, j+1)
    IF (x14 .GE. 0.) THEN
      abs20d = x14d
      abs20 = x14
    ELSE
      abs20d = -x14d
      abs20 = -x14
    END IF
!
! 2nd direction
    k_sensor1d = (abs6d-abs6*abs20d/abs20)/abs20
    k_sensor1 = abs6/abs20
    IF (p(i, j-2) - two*p(i, j-1) + p(i, j) .GE. 0.) THEN
      abs7d = pd(i, j-2) - two*pd(i, j-1) + pd(i, j)
      abs7 = p(i, j-2) - two*p(i, j-1) + p(i, j)
    ELSE
      abs7d = two*pd(i, j-1) - pd(i, j-2) - pd(i, j)
      abs7 = -(p(i, j-2)-two*p(i, j-1)+p(i, j))
    END IF
    x15d = pd(i, j-2) + two*pd(i, j-1) + pd(i, j)
    x15 = p(i, j-2) + two*p(i, j-1) + p(i, j)
    IF (x15 .GE. 0.) THEN
      abs21d = x15d
      abs21 = x15
    ELSE
      abs21d = -x15d
      abs21 = -x15
    END IF
    k_sensor2d = (abs7d-abs7*abs21d/abs21)/abs21
    k_sensor2 = abs7/abs21
!     ducros1 is done in dissipation_ducros_x
    divud = gradud(i, j, 1) + gradvd(i, j, 2)
    divu = gradu(i, j, 1) + gradv(i, j, 2)
    divu2d = 2*divu*divud
    divu2 = divu*divu
    vort2d = 2*(gradv(i, j, 1)-gradu(i, j, 2))*(gradvd(i, j, 1)-gradud(i&
&     , j, 2))
    vort2 = (gradv(i, j, 1)-gradu(i, j, 2))*(gradv(i, j, 1)-gradu(i, j, &
&     2))
    temp0 = divu2/(divu2+vort2+1d-15)
    ducros1d = (divu2d-temp0*(divu2d+vort2d))/(divu2+vort2+1d-15)
    ducros1 = temp0
! dxm1      = HALF*(ONE-tanh(2.5d0+10.d0*vol(i,j)/(sq+1.d-15)*divu) )
    arg1d = nx2*c2rd
    arg1 = c2r*nx2
    temp0 = SQRT(arg1)
    IF (arg1 .EQ. 0.0) THEN
      result1d = 0.0_8
    ELSE
      result1d = arg1d/(2.0*temp0)
    END IF
    result1 = temp0
    temp0 = 10.d0*vol(i, j)
    temp = divu/(result1+1.d-15)
    arg2d = temp0*(divud-temp*result1d)/(result1+1.d-15)
    arg2 = temp0*temp + 2.5d0
    dxm1d = -(half*(1.0-TANH(arg2)**2)*arg2d)
    dxm1 = half*(one-TANH(arg2))
    divud = gradud(i, j-1, 1) + gradvd(i, j-1, 2)
    divu = gradu(i, j-1, 1) + gradv(i, j-1, 2)
    divu2d = 2*divu*divud
    divu2 = divu*divu
    vort2d = 2*(gradv(i, j-1, 1)-gradu(i, j-1, 2))*(gradvd(i, j-1, 1)-&
&     gradud(i, j-1, 2))
    vort2 = (gradv(i, j-1, 1)-gradu(i, j-1, 2))*(gradv(i, j-1, 1)-gradu(&
&     i, j-1, 2))
    temp0 = divu2/(divu2+vort2+1.d-15)
    ducros2d = (divu2d-temp0*(divu2d+vort2d))/(divu2+vort2+1.d-15)
    ducros2 = temp0
!sq = sound/dx
! dxm2       = HALF*(ONE-tanh(2.5d0+10.d0*vol(i,j-1)/(sq+1.d-15)*divu) )
    arg1d = nx2*c2ld
    arg1 = c2l*nx2
    temp0 = SQRT(arg1)
    IF (arg1 .EQ. 0.0) THEN
      result1d = 0.0_8
    ELSE
      result1d = arg1d/(2.0*temp0)
    END IF
    result1 = temp0
    temp0 = 10.d0*vol(i, j-1)
    temp = divu/(result1+1.d-15)
    arg2d = temp0*(divud-temp*result1d)/(result1+1.d-15)
    arg2 = temp0*temp + 2.5d0
    dxm2d = -(half*(1.0-TANH(arg2)**2)*arg2d)
    dxm2 = half*(one-TANH(arg2))
    IF (k_sensor1 .LT. k_sensor2) THEN
      max4d = k_sensor2d
      max4 = k_sensor2
    ELSE
      max4d = k_sensor1d
      max4 = k_sensor1
    END IF
    IF (ducros1 .LT. ducros2) THEN
      max11d = ducros2d
      max11 = ducros2
    ELSE
      max11d = ducros1d
      max11 = ducros1
    END IF
    IF (dxm1 .LT. dxm2) THEN
      max18d = dxm2d
      max18 = dxm2
    ELSE
      max18d = dxm1d
      max18 = dxm1
    END IF
!coef      = MAX( k_sensor1*ducros1*dxm1, &
!                 k_sensor2*ducros2*dxm2)
    coefd = max18*(max11*max4d+max4*max11d) + max4*max11*max18d
    coef = max4*max11*max18
! extension of shock capturing
!k_sensor1 = ABS(p(i,j) - TWO*p(i,j+1) + p(i,j+2)) / &
!            ABS(p(i,j) + TWO*p(i,j+1) + p(i,j+2))
!
!k_sensor2 = ABS(p(i,j-3) - TWO*p(i,j-2) + p(i,j-1)) / &
!            ABS(p(i,j-3) + TWO*p(i,j-2) + p(i,j-1))
!
!divu      = gradu(i,j+1,1)+gradv(i,j+1,2)
!divu2     = divu*divu
!vort2     = (gradv(i,j+1,1)-gradu(i,j+1,2)) * (gradv(i,j+1,1)-gradu(i,j+1,2))
!ducros1   = divu2/(divu2+vort2+1d-15)
!dxm1      = HALF*(ONE-tanh(2.5d0+10.d0*vol(i,j+1)/(sq+1.d-15)*divu) )
!
!
!divu      = gradu(i,j-2,1)+gradv(i,j-2,2)
!divu2     = divu*divu
!vort2     = (gradv(i,j-2,1)-gradu(i,j-2,2)) * (gradv(i,j-2,1)-gradu(i,j-2,2))
!ducros2   = divu2/(divu2+vort2+1d-15)
!dxm2      = HALF*(ONE-tanh(2.5d0+10.d0*vol(i,j-2)/(sq+1.d-15)*divu) )
!
!coef      = MAX( k_sensor1*ducros1*dxm1, &
!                 k_sensor2*ducros2*dxm2, coef)
!coef      = MAX(sensor(i  ,j-1,2), sensor(i  ,j,2), &
!                sensor(i-1,j-1,2), sensor(i-1,j,2), &
!                sensor(i+1,j-1,2), sensor(i+1,j,2)  )
!
!coef      = MAX(sensor(i,j-3,2), sensor(i,j-2,2), &
!                sensor(i,j-1,2), sensor(i,j  ,2), &
!                sensor(i,j+1,2), sensor(i,j+2,2)  )
!
!coef      = MAX(sensor(i,j-2,2), &
!                sensor(i,j-1,2), sensor(i,j,2), &
!                sensor(i,j+1,2))
!
!rspec      = rconv(i,j,2)
    eps2d = k2*coefd
    eps2 = k2*coef
    IF (zero .LT. k4 - 12.d0*eps2) THEN
      eps4d = -(12.d0*eps2d)
      eps4 = k4 - 12.d0*eps2
    ELSE
      eps4 = zero
      eps4d = 0.0_8
    END IF
    diffrod = half*(wd(i, j, 1)-wd(i, j-1, 1))
    diffro = half*(w(i, j, 1)-w(i, j-1, 1))
    diffroud = half*(wd(i, j, 2)-wd(i, j-1, 2))
    diffrou = half*(w(i, j, 2)-w(i, j-1, 2))
    diffrovd = half*(wd(i, j, 3)-wd(i, j-1, 3))
    diffrov = half*(w(i, j, 3)-w(i, j-1, 3))
    diffrowd = half*(wd(i, j, 4)-wd(i, j-1, 4))
    diffrow = half*(w(i, j, 4)-w(i, j-1, 4))
    diffroed = half*(wd(i, j, 5)-wd(i, j-1, 5))
    diffroe = half*(w(i, j, 5)-w(i, j-1, 5))
!
!
!     if (eps4.gt.1.d-12) then
! #include "rhs/wiggle_dirj.F"
!     endif
!
    temp0 = eps2*diffro + eps4*predro2
    dissro2d = temp0*rspecd + rspec*(diffro*eps2d+eps2*diffrod+predro2*&
&     eps4d+eps4*predro2d)
    temp0 = eps2*diffrou + eps4*predrou2
    dissrou2d = temp0*rspecd + rspec*(diffrou*eps2d+eps2*diffroud+&
&     predrou2*eps4d+eps4*predrou2d)
    temp0 = eps2*diffrov + eps4*predrov2
    dissrov2d = temp0*rspecd + rspec*(diffrov*eps2d+eps2*diffrovd+&
&     predrov2*eps4d+eps4*predrov2d)
    temp0 = eps2*diffrow + eps4*predrow2
    dissrow2d = temp0*rspecd + rspec*(diffrow*eps2d+eps2*diffrowd+&
&     predrow2*eps4d+eps4*predrow2d)
    temp0 = eps2*diffroe + eps4*predroe2
    dissroe2d = temp0*rspecd + rspec*(diffroe*eps2d+eps2*diffroed+&
&     predroe2*eps4d+eps4*predroe2d)
    sc1 = nx(i, j, 1)
    sc2 = ny(i, j, 1)
    arg1 = sc1*sc1 + sc2*sc2
    sn = SQRT(arg1)
    invsn = one/sn
    nxloc = sc1*invsn
    nyloc = sc2*invsn
    hnd(i, j, 1, 1) = fxro1d - dissro1d
!
    hnd(i, j, 2, 1) = fxrou1d - dissrou1d - sn*(nxloc*fvrou1d+nyloc*&
&     gvrou1d)
!
    hnd(i, j, 3, 1) = fxrov1d - dissrov1d - sn*(nxloc*fvrov1d+nyloc*&
&     gvrov1d)
!
    hnd(i, j, 4, 1) = fxrow1d - dissrow1d - sn*(nxloc*fvrow1d+nyloc*&
&     gvrow1d)
!
    hnd(i, j, 5, 1) = fxroe1d - dissroe1d - sn*(nxloc*fvroe1d+nyloc*&
&     gvroe1d)
    sc1 = nx(i, j, 2)
    sc2 = ny(i, j, 2)
    arg1 = sc1*sc1 + sc2*sc2
    sn = SQRT(arg1)
    invsn = one/sn
    nxloc = sc1*invsn
    nyloc = sc2*invsn
    hnd(i, j, 1, 2) = fxro2d - dissro2d
!
    hnd(i, j, 2, 2) = fxrou2d - dissrou2d - sn*(nxloc*fvrou2d+nyloc*&
&     gvrou2d)
!
    hnd(i, j, 3, 2) = fxrov2d - dissrov2d - sn*(nxloc*fvrov2d+nyloc*&
&     gvrov2d)
!
    hnd(i, j, 4, 2) = fxrow2d - dissrow2d - sn*(nxloc*fvrow2d+nyloc*&
&     gvrow2d)
!
    hnd(i, j, 5, 2) = fxroe2d - dissroe2d - sn*(nxloc*fvroe2d+nyloc*&
&     gvroe2d)
  END DO
  j = 2
!DIR$ IVDEP
  DO i=1,im+1
! for idir
    fxro1d = nx(i, j, 1)*(c1*(fd(i, j, 1)+fd(i-1, j, 1))+c2*(fd(i+1, j, &
&     1)+fd(i-2, j, 1))+c3*(fd(i+2, j, 1)+fd(i-3, j, 1))) + ny(i, j, 1)*&
&     (c1*(gd(i, j, 1)+gd(i-1, j, 1))+c2*(gd(i+1, j, 1)+gd(i-2, j, 1))+&
&     c3*(gd(i+2, j, 1)+gd(i-3, j, 1)))
    fxrou1d = nx(i, j, 1)*(c1*(fd(i, j, 2)+fd(i-1, j, 2))+c2*(fd(i+1, j&
&     , 2)+fd(i-2, j, 2))+c3*(fd(i+2, j, 2)+fd(i-3, j, 2))) + ny(i, j, 1&
&     )*(c1*(gd(i, j, 2)+gd(i-1, j, 2))+c2*(gd(i+1, j, 2)+gd(i-2, j, 2))&
&     +c3*(gd(i+2, j, 2)+gd(i-3, j, 2)))
    fxrov1d = nx(i, j, 1)*(c1*(fd(i, j, 3)+fd(i-1, j, 3))+c2*(fd(i+1, j&
&     , 3)+fd(i-2, j, 3))+c3*(fd(i+2, j, 3)+fd(i-3, j, 3))) + ny(i, j, 1&
&     )*(c1*(gd(i, j, 3)+gd(i-1, j, 3))+c2*(gd(i+1, j, 3)+gd(i-2, j, 3))&
&     +c3*(gd(i+2, j, 3)+gd(i-3, j, 3)))
    fxrow1d = nx(i, j, 1)*(c1*(fd(i, j, 4)+fd(i-1, j, 4))+c2*(fd(i+1, j&
&     , 4)+fd(i-2, j, 4))+c3*(fd(i+2, j, 4)+fd(i-3, j, 4))) + ny(i, j, 1&
&     )*(c1*(gd(i, j, 4)+gd(i-1, j, 4))+c2*(gd(i+1, j, 4)+gd(i-2, j, 4))&
&     +c3*(gd(i+2, j, 4)+gd(i-3, j, 4)))
    fxroe1d = nx(i, j, 1)*(c1*(fd(i, j, 5)+fd(i-1, j, 5))+c2*(fd(i+1, j&
&     , 5)+fd(i-2, j, 5))+c3*(fd(i+2, j, 5)+fd(i-3, j, 5))) + ny(i, j, 1&
&     )*(c1*(gd(i, j, 5)+gd(i-1, j, 5))+c2*(gd(i+1, j, 5)+gd(i-2, j, 5))&
&     +c3*(gd(i+2, j, 5)+gd(i-3, j, 5)))
! Saunier Thesis
    fxro2d = nx(i, j, 2)*(c3d0*fd(i, 1, 1)+c3d1*fd(i, 2, 1)+c3d2*fd(i, 3&
&     , 1)+c3d3*fd(i, 4, 1)+c3d4*fd(i, 5, 1)) + ny(i, j, 2)*(c3d0*gd(i, &
&     1, 1)+c3d1*gd(i, 2, 1)+c3d2*gd(i, 3, 1)+c3d3*gd(i, 4, 1)+c3d4*gd(i&
&     , 5, 1))
    fxrou2d = nx(i, j, 2)*(c3d0*fd(i, 1, 2)+c3d1*fd(i, 2, 2)+c3d2*fd(i, &
&     3, 2)+c3d3*fd(i, 4, 2)+c3d4*fd(i, 5, 2)) + ny(i, j, 2)*(c3d0*gd(i&
&     , 1, 2)+c3d1*gd(i, 2, 2)+c3d2*gd(i, 3, 2)+c3d3*gd(i, 4, 2)+c3d4*gd&
&     (i, 5, 2))
    fxrov2d = nx(i, j, 2)*(c3d0*fd(i, 1, 3)+c3d1*fd(i, 2, 3)+c3d2*fd(i, &
&     3, 3)+c3d3*fd(i, 4, 3)+c3d4*fd(i, 5, 3)) + ny(i, j, 2)*(c3d0*gd(i&
&     , 1, 3)+c3d1*gd(i, 2, 3)+c3d2*gd(i, 3, 3)+c3d3*gd(i, 4, 3)+c3d4*gd&
&     (i, 5, 3))
    fxrow2d = nx(i, j, 2)*(c3d0*fd(i, 1, 4)+c3d1*fd(i, 2, 4)+c3d2*fd(i, &
&     3, 4)+c3d3*fd(i, 4, 4)+c3d4*fd(i, 5, 4)) + ny(i, j, 2)*(c3d0*gd(i&
&     , 1, 4)+c3d1*gd(i, 2, 4)+c3d2*gd(i, 3, 4)+c3d3*gd(i, 4, 4)+c3d4*gd&
&     (i, 5, 4))
    fxroe2d = nx(i, j, 2)*(c3d0*fd(i, 1, 5)+c3d1*fd(i, 2, 5)+c3d2*fd(i, &
&     3, 5)+c3d3*fd(i, 4, 5)+c3d4*fd(i, 5, 5)) + ny(i, j, 2)*(c3d0*gd(i&
&     , 1, 5)+c3d1*gd(i, 2, 5)+c3d2*gd(i, 3, 5)+c3d3*gd(i, 4, 5)+c3d4*gd&
&     (i, 5, 5))
    predro1d = d2*wd(i-2, j, 1) - d3*wd(i-3, j, 1) - d1*wd(i-1, j, 1) + &
&     d1*wd(i, j, 1) - d2*wd(i+1, j, 1) + d3*wd(i+2, j, 1)
    predro1 = -(d3*w(i-3, j, 1)) + d2*w(i-2, j, 1) - d1*w(i-1, j, 1) + &
&     d1*w(i, j, 1) - d2*w(i+1, j, 1) + d3*w(i+2, j, 1)
    predrou1d = d2*wd(i-2, j, 2) - d3*wd(i-3, j, 2) - d1*wd(i-1, j, 2) +&
&     d1*wd(i, j, 2) - d2*wd(i+1, j, 2) + d3*wd(i+2, j, 2)
    predrou1 = -(d3*w(i-3, j, 2)) + d2*w(i-2, j, 2) - d1*w(i-1, j, 2) + &
&     d1*w(i, j, 2) - d2*w(i+1, j, 2) + d3*w(i+2, j, 2)
    predrov1d = d2*wd(i-2, j, 3) - d3*wd(i-3, j, 3) - d1*wd(i-1, j, 3) +&
&     d1*wd(i, j, 3) - d2*wd(i+1, j, 3) + d3*wd(i+2, j, 3)
    predrov1 = -(d3*w(i-3, j, 3)) + d2*w(i-2, j, 3) - d1*w(i-1, j, 3) + &
&     d1*w(i, j, 3) - d2*w(i+1, j, 3) + d3*w(i+2, j, 3)
    predrow1d = d2*wd(i-2, j, 4) - d3*wd(i-3, j, 4) - d1*wd(i-1, j, 4) +&
&     d1*wd(i, j, 4) - d2*wd(i+1, j, 4) + d3*wd(i+2, j, 4)
    predrow1 = -(d3*w(i-3, j, 4)) + d2*w(i-2, j, 4) - d1*w(i-1, j, 4) + &
&     d1*w(i, j, 4) - d2*w(i+1, j, 4) + d3*w(i+2, j, 4)
    predroe1d = d2*wd(i-2, j, 5) - d3*wd(i-3, j, 5) - d1*wd(i-1, j, 5) +&
&     d1*wd(i, j, 5) - d2*wd(i+1, j, 5) + d3*wd(i+2, j, 5)
    predroe1 = -(d3*w(i-3, j, 5)) + d2*w(i-2, j, 5) - d1*w(i-1, j, 5) + &
&     d1*w(i, j, 5) - d2*w(i+1, j, 5) + d3*w(i+2, j, 5)
    predro2d = d2*wd(i, j-2, 1) - d3*wd(i, j-3, 1) - d1*wd(i, j-1, 1) + &
&     d1*wd(i, j, 1) - d2*wd(i, j+1, 1) + d3*wd(i, j+2, 1)
    predro2 = -(d3*w(i, j-3, 1)) + d2*w(i, j-2, 1) - d1*w(i, j-1, 1) + &
&     d1*w(i, j, 1) - d2*w(i, j+1, 1) + d3*w(i, j+2, 1)
    predrou2d = d2*wd(i, j-2, 2) - d3*wd(i, j-3, 2) - d1*wd(i, j-1, 2) +&
&     d1*wd(i, j, 2) - d2*wd(i, j+1, 2) + d3*wd(i, j+2, 2)
    predrou2 = -(d3*w(i, j-3, 2)) + d2*w(i, j-2, 2) - d1*w(i, j-1, 2) + &
&     d1*w(i, j, 2) - d2*w(i, j+1, 2) + d3*w(i, j+2, 2)
    predrov2d = d2*wd(i, j-2, 3) - d3*wd(i, j-3, 3) - d1*wd(i, j-1, 3) +&
&     d1*wd(i, j, 3) - d2*wd(i, j+1, 3) + d3*wd(i, j+2, 3)
    predrov2 = -(d3*w(i, j-3, 3)) + d2*w(i, j-2, 3) - d1*w(i, j-1, 3) + &
&     d1*w(i, j, 3) - d2*w(i, j+1, 3) + d3*w(i, j+2, 3)
    predrow2d = d2*wd(i, j-2, 4) - d3*wd(i, j-3, 4) - d1*wd(i, j-1, 4) +&
&     d1*wd(i, j, 4) - d2*wd(i, j+1, 4) + d3*wd(i, j+2, 4)
    predrow2 = -(d3*w(i, j-3, 4)) + d2*w(i, j-2, 4) - d1*w(i, j-1, 4) + &
&     d1*w(i, j, 4) - d2*w(i, j+1, 4) + d3*w(i, j+2, 4)
    predroe2d = d2*wd(i, j-2, 5) - d3*wd(i, j-3, 5) - d1*wd(i, j-1, 5) +&
&     d1*wd(i, j, 5) - d2*wd(i, j+1, 5) + d3*wd(i, j+2, 5)
    predroe2 = -(d3*w(i, j-3, 5)) + d2*w(i, j-2, 5) - d1*w(i, j-1, 5) + &
&     d1*w(i, j, 5) - d2*w(i, j+1, 5) + d3*w(i, j+2, 5)
! grad for viscous fluxes o2 - 3p
!
    volm1 = volf(i, j, 1)
! Normals
    nx_n = half*(nx(i+1, j, 1)+nx(i, j, 1))
    nx_s = -(half*(nx(i-1, j, 1)+nx(i, j, 1)))
    nx_o = half*(nx(i-1, j+1, 2)+nx(i, j+1, 2))
    nx_e = -(half*(nx(i-1, j, 2)+nx(i, j, 2)))
!
    ny_n = half*(ny(i+1, j, 1)+ny(i, j, 1))
    ny_s = -(half*(ny(i-1, j, 1)+ny(i, j, 1)))
    ny_o = half*(ny(i-1, j+1, 2)+ny(i, j+1, 2))
    ny_e = -(half*(ny(i-1, j, 2)+ny(i, j, 2)))
    val_nd = velxd(i, j)
    val_n = velx(i, j)
    val_sd = velxd(i-1, j)
    val_s = velx(i-1, j)
    val_ed = fourth*(velxd(i, j)+velxd(i, j-1)+velxd(i-1, j)+velxd(i-1, &
&     j-1))
    val_e = fourth*(velx(i, j)+velx(i, j-1)+velx(i-1, j)+velx(i-1, j-1))
    val_od = fourth*(velxd(i, j)+velxd(i, j+1)+velxd(i-1, j)+velxd(i-1, &
&     j+1))
    val_o = fourth*(velx(i, j)+velx(i, j+1)+velx(i-1, j)+velx(i-1, j+1))
    uxd = volm1*(nx_n*val_nd+nx_s*val_sd+nx_o*val_od+nx_e*val_ed)
    ux = (val_n*nx_n+val_s*nx_s+val_o*nx_o+val_e*nx_e)*volm1
    uyd = volm1*(ny_n*val_nd+ny_s*val_sd+ny_o*val_od+ny_e*val_ed)
    uy = (val_n*ny_n+val_s*ny_s+val_o*ny_o+val_e*ny_e)*volm1
    val_nd = velyd(i, j)
    val_n = vely(i, j)
    val_sd = velyd(i-1, j)
    val_s = vely(i-1, j)
    val_ed = fourth*(velyd(i, j)+velyd(i, j-1)+velyd(i-1, j)+velyd(i-1, &
&     j-1))
    val_e = fourth*(vely(i, j)+vely(i, j-1)+vely(i-1, j)+vely(i-1, j-1))
    val_od = fourth*(velyd(i, j)+velyd(i, j+1)+velyd(i-1, j)+velyd(i-1, &
&     j+1))
    val_o = fourth*(vely(i, j)+vely(i, j+1)+vely(i-1, j)+vely(i-1, j+1))
    vxd = volm1*(nx_n*val_nd+nx_s*val_sd+nx_o*val_od+nx_e*val_ed)
    vx = (val_n*nx_n+val_s*nx_s+val_o*nx_o+val_e*nx_e)*volm1
    vyd = volm1*(ny_n*val_nd+ny_s*val_sd+ny_o*val_od+ny_e*val_ed)
    vy = (val_n*ny_n+val_s*ny_s+val_o*ny_o+val_e*ny_e)*volm1
    val_nd = velzd(i, j)
    val_n = velz(i, j)
    val_sd = velzd(i-1, j)
    val_s = velz(i-1, j)
    val_ed = fourth*(velzd(i, j)+velzd(i, j-1)+velzd(i-1, j)+velzd(i-1, &
&     j-1))
    val_e = fourth*(velz(i, j)+velz(i, j-1)+velz(i-1, j)+velz(i-1, j-1))
    val_od = fourth*(velzd(i, j)+velzd(i, j+1)+velzd(i-1, j)+velzd(i-1, &
&     j+1))
    val_o = fourth*(velz(i, j)+velz(i, j+1)+velz(i-1, j)+velz(i-1, j+1))
    wxd = volm1*(nx_n*val_nd+nx_s*val_sd+nx_o*val_od+nx_e*val_ed)
    wx = (val_n*nx_n+val_s*nx_s+val_o*nx_o+val_e*nx_e)*volm1
    wyd = volm1*(ny_n*val_nd+ny_s*val_sd+ny_o*val_od+ny_e*val_ed)
    wy = (val_n*ny_n+val_s*ny_s+val_o*ny_o+val_e*ny_e)*volm1
    val_nd = tlocd(i, j)
    val_n = tloc(i, j)
    val_sd = tlocd(i-1, j)
    val_s = tloc(i-1, j)
    val_ed = fourth*(tlocd(i, j)+tlocd(i, j-1)+tlocd(i-1, j)+tlocd(i-1, &
&     j-1))
    val_e = fourth*(tloc(i, j)+tloc(i, j-1)+tloc(i-1, j)+tloc(i-1, j-1))
    val_od = fourth*(tlocd(i, j)+tlocd(i, j+1)+tlocd(i-1, j)+tlocd(i-1, &
&     j+1))
    val_o = fourth*(tloc(i, j)+tloc(i, j+1)+tloc(i-1, j)+tloc(i-1, j+1))
!
    txd = volm1*(nx_n*val_nd+nx_s*val_sd+nx_o*val_od+nx_e*val_ed)
    tx = (val_n*nx_n+val_s*nx_s+val_o*nx_o+val_e*nx_e)*volm1
    tyd = volm1*(ny_n*val_nd+ny_s*val_sd+ny_o*val_od+ny_e*val_ed)
    ty = (val_n*ny_n+val_s*ny_s+val_o*ny_o+val_e*ny_e)*volm1
!
! Computation of viscous fluxes
!
    uud = half*(velxd(i, j)+velxd(i-1, j))
    uu = half*(velx(i, j)+velx(i-1, j))
    vvd = half*(velyd(i, j)+velyd(i-1, j))
    vv = half*(vely(i, j)+vely(i-1, j))
    wwd = half*(velzd(i, j)+velzd(i-1, j))
    ww = half*(velz(i, j)+velz(i-1, j))
!
    mmud = half*(mud(i, j)+mud(i-1, j))
    mmu = half*(mu(i, j)+mu(i-1, j))
    lambdad = half*cpprandtl*(mud(i, j)+mud(i-1, j))
    lambda = half*(mu(i, j)+mu(i-1, j))*cpprandtl
!
    fvrou1d = twothird*((two*ux-vy)*mmud+mmu*(two*uxd-vyd))
    fvrou1 = twothird*mmu*(two*ux-vy)
    fvrov1d = (uy+vx)*mmud + mmu*(uyd+vxd)
    fvrov1 = mmu*(uy+vx)
    fvrow1d = wx*mmud + mmu*wxd
    fvrow1 = mmu*wx
    fvroe1d = tx*lambdad + lambda*txd + fvrou1*uud + uu*fvrou1d + fvrov1&
&     *vvd + vv*fvrov1d + fvrow1*wwd + ww*fvrow1d
!
    gvrou1d = (uy+vx)*mmud + mmu*(uyd+vxd)
    gvrou1 = mmu*(uy+vx)
    gvrov1d = twothird*((two*vy-ux)*mmud+mmu*(two*vyd-uxd))
    gvrov1 = twothird*mmu*(-ux+two*vy)
    gvrow1d = wy*mmud + mmu*wyd
    gvrow1 = mmu*wy
    gvroe1d = ty*lambdad + lambda*tyd + gvrou1*uud + uu*gvrou1d + gvrov1&
&     *vvd + vv*gvrov1d + gvrow1*wwd + ww*gvrow1d
!!  fvrou1 = TWOTHIRD*mmu*( TWO*ux -     vy  -   wz  )
!!  fvrov1 =          mmu*(     uy +     vx          )
!!  fvrow1 =          mmu*(     uz           +   wx  )
!!  fvroe1 = lambda*tx + uu*fvrou1 + vv*fvrov1 + ww * fvrow1
!!  !
!!  gvrou1 =          mmu*(     uy +     vx          )
!!  gvrov1 = TWOTHIRD*mmu*(    -ux + TWO*vy   -  wz  )
!!  gvrow1 =          mmu*(              vz   +  wy  )
!!  gvroe1 = lambda*ty + uu*gvrou1 + vv*gvrov1 + ww * gvrow1
! grad for viscous fluxes o2 - 3p
!
    volm1 = volf(i, j, 2)
    nx_n = half*(nx(i+1, j-1, 1)+nx(i+1, j, 1))
    nx_s = -(half*(nx(i, j-1, 1)+nx(i, j, 1)))
    nx_o = half*(nx(i, j+1, 2)+nx(i, j, 2))
    nx_e = -(half*(nx(i, j-1, 2)+nx(i, j, 2)))
!
    ny_n = half*(ny(i+1, j-1, 1)+ny(i+1, j, 1))
    ny_s = -(half*(ny(i, j-1, 1)+ny(i, j, 1)))
    ny_o = half*(ny(i, j+1, 2)+ny(i, j, 2))
    ny_e = -(half*(ny(i, j-1, 2)+ny(i, j, 2)))
    val_nd = fourth*(velxd(i, j)+velxd(i+1, j)+velxd(i, j-1)+velxd(i+1, &
&     j-1))
    val_n = fourth*(velx(i, j)+velx(i+1, j)+velx(i, j-1)+velx(i+1, j-1))
    val_sd = fourth*(velxd(i, j)+velxd(i-1, j)+velxd(i, j-1)+velxd(i-1, &
&     j-1))
    val_s = fourth*(velx(i, j)+velx(i-1, j)+velx(i, j-1)+velx(i-1, j-1))
    val_od = velxd(i, j)
    val_o = velx(i, j)
    val_ed = velxd(i, j-1)
    val_e = velx(i, j-1)
    uxd = volm1*(nx_n*val_nd+nx_s*val_sd+nx_o*val_od+nx_e*val_ed)
    ux = (val_n*nx_n+val_s*nx_s+val_o*nx_o+val_e*nx_e)*volm1
    uyd = volm1*(ny_n*val_nd+ny_s*val_sd+ny_o*val_od+ny_e*val_ed)
    uy = (val_n*ny_n+val_s*ny_s+val_o*ny_o+val_e*ny_e)*volm1
    val_nd = fourth*(velyd(i, j)+velyd(i+1, j)+velyd(i, j-1)+velyd(i+1, &
&     j-1))
    val_n = fourth*(vely(i, j)+vely(i+1, j)+vely(i, j-1)+vely(i+1, j-1))
    val_sd = fourth*(velyd(i, j)+velyd(i-1, j)+velyd(i, j-1)+velyd(i-1, &
&     j-1))
    val_s = fourth*(vely(i, j)+vely(i-1, j)+vely(i, j-1)+vely(i-1, j-1))
    val_od = velyd(i, j)
    val_o = vely(i, j)
    val_ed = velyd(i, j-1)
    val_e = vely(i, j-1)
    vxd = volm1*(nx_n*val_nd+nx_s*val_sd+nx_o*val_od+nx_e*val_ed)
    vx = (val_n*nx_n+val_s*nx_s+val_o*nx_o+val_e*nx_e)*volm1
    vyd = volm1*(ny_n*val_nd+ny_s*val_sd+ny_o*val_od+ny_e*val_ed)
    vy = (val_n*ny_n+val_s*ny_s+val_o*ny_o+val_e*ny_e)*volm1
    val_nd = fourth*(velzd(i, j)+velzd(i+1, j)+velzd(i, j-1)+velzd(i+1, &
&     j-1))
    val_n = fourth*(velz(i, j)+velz(i+1, j)+velz(i, j-1)+velz(i+1, j-1))
    val_sd = fourth*(velzd(i, j)+velzd(i-1, j)+velzd(i, j-1)+velzd(i-1, &
&     j-1))
    val_s = fourth*(velz(i, j)+velz(i-1, j)+velz(i, j-1)+velz(i-1, j-1))
    val_od = velzd(i, j)
    val_o = velz(i, j)
    val_ed = velzd(i, j-1)
    val_e = velz(i, j-1)
    wxd = volm1*(nx_n*val_nd+nx_s*val_sd+nx_o*val_od+nx_e*val_ed)
    wx = (val_n*nx_n+val_s*nx_s+val_o*nx_o+val_e*nx_e)*volm1
    wyd = volm1*(ny_n*val_nd+ny_s*val_sd+ny_o*val_od+ny_e*val_ed)
    wy = (val_n*ny_n+val_s*ny_s+val_o*ny_o+val_e*ny_e)*volm1
    val_nd = fourth*(tlocd(i, j)+tlocd(i+1, j)+tlocd(i, j-1)+tlocd(i+1, &
&     j-1))
    val_n = fourth*(tloc(i, j)+tloc(i+1, j)+tloc(i, j-1)+tloc(i+1, j-1))
    val_sd = fourth*(tlocd(i, j)+tlocd(i-1, j)+tlocd(i, j-1)+tlocd(i-1, &
&     j-1))
    val_s = fourth*(tloc(i, j)+tloc(i-1, j)+tloc(i, j-1)+tloc(i-1, j-1))
    val_od = tlocd(i, j)
    val_o = tloc(i, j)
    val_ed = tlocd(i, j-1)
    val_e = tloc(i, j-1)
    txd = volm1*(nx_n*val_nd+nx_s*val_sd+nx_o*val_od+nx_e*val_ed)
    tx = (val_n*nx_n+val_s*nx_s+val_o*nx_o+val_e*nx_e)*volm1
    tyd = volm1*(ny_n*val_nd+ny_s*val_sd+ny_o*val_od+ny_e*val_ed)
    ty = (val_n*ny_n+val_s*ny_s+val_o*ny_o+val_e*ny_e)*volm1
    uud = half*(velxd(i, j)+velxd(i, j-1))
    uu = half*(velx(i, j)+velx(i, j-1))
    vvd = half*(velyd(i, j)+velyd(i, j-1))
    vv = half*(vely(i, j)+vely(i, j-1))
    wwd = half*(velzd(i, j)+velzd(i, j-1))
    ww = half*(velz(i, j)+velz(i, j-1))
!
    mmud = half*(mud(i, j)+mud(i, j-1))
    mmu = half*(mu(i, j)+mu(i, j-1))
    lambdad = half*cpprandtl*(mud(i, j)+mud(i, j-1))
    lambda = half*(mu(i, j)+mu(i, j-1))*cpprandtl
!
    fvrou2d = twothird*((two*ux-vy)*mmud+mmu*(two*uxd-vyd))
    fvrou2 = twothird*mmu*(two*ux-vy)
    fvrov2d = (uy+vx)*mmud + mmu*(uyd+vxd)
    fvrov2 = mmu*(uy+vx)
    fvrow2d = wx*mmud + mmu*wxd
    fvrow2 = mmu*wx
    fvroe2d = tx*lambdad + lambda*txd + fvrou2*uud + uu*fvrou2d + fvrov2&
&     *vvd + vv*fvrov2d + fvrow2*wwd + ww*fvrow2d
    gvrou2d = (uy+vx)*mmud + mmu*(uyd+vxd)
    gvrou2 = mmu*(uy+vx)
    gvrov2d = twothird*((two*vy-ux)*mmud+mmu*(two*vyd-uxd))
    gvrov2 = twothird*mmu*(-ux+two*vy)
    gvrow2d = wy*mmud + mmu*wyd
    gvrow2 = mmu*wy
    gvroe2d = ty*lambdad + lambda*tyd + gvrou2*uud + uu*gvrou2d + gvrov2&
&     *vvd + vv*gvrov2d + gvrow2*wwd + ww*gvrow2d
!!  fvrou2 = TWOTHIRD*mmu*( TWO*ux -     vy  -  wz  )
!!  fvrov2 =          mmu*(     uy +     vx         )
!!  fvrow2 =          mmu*(     uz           +  wx  )
!!  fvroe2 = (lambda*tx + uu*fvrou2 + vv*fvrov2 + ww * fvrow2)
!!
!!  gvrou2 =          mmu*(     uy +     vx       )
!!  gvrov2 = TWOTHIRD*mmu*(    -ux + TWO*vy -  wz )
!!  gvrow2 =          mmu*(              vz +  wy )
!!  gvroe2 = (lambda*ty + uu*gvrou2 + vv*gvrov2 + ww*gvrow2)
! #include "rhs/spectralradius_i.F"
! correction Rossow JCP 2000
!#include "rhs/spectralradiusRossow_i.F"
!1st direction
    rhomrd = wd(i, j, 1)
    rhomr = w(i, j, 1)
    temp0 = w(i, j, 2)/rhomr
    urd = (wd(i, j, 2)-temp0*rhomrd)/rhomr
    ur = temp0
    temp0 = w(i, j, 3)/rhomr
    vrd = (wd(i, j, 3)-temp0*rhomrd)/rhomr
    vr = temp0
    c2rd = gam*rgaz*tlocd(i, j)
    c2r = gam*rgaz*tloc(i, j)
!
    rhomld = wd(i-1, j, 1)
    rhoml = w(i-1, j, 1)
    temp0 = w(i-1, j, 2)/rhoml
    uld = (wd(i-1, j, 2)-temp0*rhomld)/rhoml
    ul = temp0
    temp0 = w(i-1, j, 3)/rhoml
    vld = (wd(i-1, j, 3)-temp0*rhomld)/rhoml
    vl = temp0
    c2ld = gam*rgaz*tlocd(i-1, j)
    c2l = gam*rgaz*tloc(i-1, j)
!
    temp0 = rhomr/rhoml
    temp = SQRT(temp0)
    IF (temp0 .EQ. 0.0) THEN
      rd = 0.0_8
    ELSE
      rd = (rhomrd-temp0*rhomld)/(2.0*temp*rhoml)
    END IF
    r = temp
    temp0 = one/(one+r)
    rrd = -(temp0*rd/(one+r))
    rr = temp0
    omrrd = -rrd
    omrr = one - rr
!
    ud = rr*uld + ul*rrd + omrr*urd + ur*omrrd
    u = ul*rr + ur*omrr
    vd = rr*vld + vl*rrd + omrr*vrd + vr*omrrd
    v = vl*rr + vr*omrr
!
    c2xd = rr*c2ld + c2l*rrd + omrr*c2rd + c2r*omrrd
    c2x = c2l*rr + c2r*omrr
    nx2 = nx(i, j, 1)*nx(i, j, 1) + ny(i, j, 1)*ny(i, j, 1)
    x5d = nx(i, j, 1)*ud + ny(i, j, 1)*vd
    x5 = nx(i, j, 1)*u + ny(i, j, 1)*v
    IF (x5 .GE. 0.) THEN
      abd = x5d
      ab = x5
    ELSE
      abd = -x5d
      ab = -x5
    END IF
    temp0 = SQRT(nx2*c2x)
    IF (nx2*c2x .EQ. 0.0) THEN
      sqd = 0.0_8
    ELSE
      sqd = nx2*c2xd/(2.0*temp0)
    END IF
    sq = temp0
!
    rspecd = abd + sqd
    rspec = ab + sq
    IF (p(i-1, j) - two*p(i, j) + p(i+1, j) .GE. 0.) THEN
      abs8d = pd(i-1, j) - two*pd(i, j) + pd(i+1, j)
      abs8 = p(i-1, j) - two*p(i, j) + p(i+1, j)
    ELSE
      abs8d = two*pd(i, j) - pd(i-1, j) - pd(i+1, j)
      abs8 = -(p(i-1, j)-two*p(i, j)+p(i+1, j))
    END IF
    x16d = pd(i-1, j) + two*pd(i, j) + pd(i+1, j)
    x16 = p(i-1, j) + two*p(i, j) + p(i+1, j)
    IF (x16 .GE. 0.) THEN
      abs22d = x16d
      abs22 = x16
    ELSE
      abs22d = -x16d
      abs22 = -x16
    END IF
!
!1st direction
    k_sensor1d = (abs8d-abs8*abs22d/abs22)/abs22
    k_sensor1 = abs8/abs22
    IF (p(i-2, j) - two*p(i-1, j) + p(i, j) .GE. 0.) THEN
      abs9d = pd(i-2, j) - two*pd(i-1, j) + pd(i, j)
      abs9 = p(i-2, j) - two*p(i-1, j) + p(i, j)
    ELSE
      abs9d = two*pd(i-1, j) - pd(i-2, j) - pd(i, j)
      abs9 = -(p(i-2, j)-two*p(i-1, j)+p(i, j))
    END IF
    x17d = pd(i-2, j) + two*pd(i-1, j) + pd(i, j)
    x17 = p(i-2, j) + two*p(i-1, j) + p(i, j)
    IF (x17 .GE. 0.) THEN
      abs23d = x17d
      abs23 = x17
    ELSE
      abs23d = -x17d
      abs23 = -x17
    END IF
    k_sensor2d = (abs9d-abs9*abs23d/abs23)/abs23
    k_sensor2 = abs9/abs23
    divud = gradud(i, j, 1) + gradvd(i, j, 2)
    divu = gradu(i, j, 1) + gradv(i, j, 2)
    divu2d = 2*divu*divud
    divu2 = divu*divu
    vort2d = 2*(gradv(i, j, 1)-gradu(i, j, 2))*(gradvd(i, j, 1)-gradud(i&
&     , j, 2))
    vort2 = (gradv(i, j, 1)-gradu(i, j, 2))*(gradv(i, j, 1)-gradu(i, j, &
&     2))
    temp0 = divu2/(divu2+vort2+1d-15)
    ducros1d = (divu2d-temp0*(divu2d+vort2d))/(divu2+vort2+1d-15)
    ducros1 = temp0
! dxm1      = HALF*(ONE-tanh(2.5d0+10.d0*vol(i,j)/(sq+1.d-15)*divu) )
    arg1d = nx2*c2rd
    arg1 = c2r*nx2
    temp0 = SQRT(arg1)
    IF (arg1 .EQ. 0.0) THEN
      result1d = 0.0_8
    ELSE
      result1d = arg1d/(2.0*temp0)
    END IF
    result1 = temp0
    temp0 = 10.d0*vol(i, j)
    temp = divu/(result1+1.d-15)
    arg2d = temp0*(divud-temp*result1d)/(result1+1.d-15)
    arg2 = temp0*temp + 2.5d0
    dxm1d = -(half*(1.0-TANH(arg2)**2)*arg2d)
    dxm1 = half*(one-TANH(arg2))
    divud = gradud(i-1, j, 1) + gradvd(i-1, j, 2)
    divu = gradu(i-1, j, 1) + gradv(i-1, j, 2)
    divu2d = 2*divu*divud
    divu2 = divu*divu
    vort2d = 2*(gradv(i-1, j, 1)-gradu(i-1, j, 2))*(gradvd(i-1, j, 1)-&
&     gradud(i-1, j, 2))
    vort2 = (gradv(i-1, j, 1)-gradu(i-1, j, 2))*(gradv(i-1, j, 1)-gradu(&
&     i-1, j, 2))
    temp0 = divu2/(divu2+vort2+1d-15)
    ducros2d = (divu2d-temp0*(divu2d+vort2d))/(divu2+vort2+1d-15)
    ducros2 = temp0
! dxm2      = HALF*(ONE-tanh(2.5d0+10.d0*vol(i-1,j)/(sq+1.d-15)*divu) )
    arg1d = nx2*c2ld
    arg1 = c2l*nx2
    temp0 = SQRT(arg1)
    IF (arg1 .EQ. 0.0) THEN
      result1d = 0.0_8
    ELSE
      result1d = arg1d/(2.0*temp0)
    END IF
    result1 = temp0
    temp0 = 10.d0*vol(i-1, j)
    temp = divu/(result1+1.d-15)
    arg2d = temp0*(divud-temp*result1d)/(result1+1.d-15)
    arg2 = temp0*temp + 2.5d0
    dxm2d = -(half*(1.0-TANH(arg2)**2)*arg2d)
    dxm2 = half*(one-TANH(arg2))
    IF (k_sensor1 .LT. k_sensor2) THEN
      max5d = k_sensor2d
      max5 = k_sensor2
    ELSE
      max5d = k_sensor1d
      max5 = k_sensor1
    END IF
    IF (ducros1 .LT. ducros2) THEN
      max12d = ducros2d
      max12 = ducros2
    ELSE
      max12d = ducros1d
      max12 = ducros1
    END IF
    IF (dxm1 .LT. dxm2) THEN
      max19d = dxm2d
      max19 = dxm2
    ELSE
      max19d = dxm1d
      max19 = dxm1
    END IF
!coef      = MAX( k_sensor1*ducros1*dxm1, &
!                 k_sensor2*ducros2*dxm2)
    coefd = max19*(max12*max5d+max5*max12d) + max5*max12*max19d
    coef = max5*max12*max19
!     ! extension of shock capturing
!
!k_sensor1 = ABS(p(i,j) - TWO*p(i+1,j) + p(i+2,j)) / &
!            ABS(p(i,j) + TWO*p(i+1,j) + p(i+2,j))
!
!k_sensor2 = ABS(p(i-3,j) - TWO*p(i-2,j) + p(i-1,j)) / &
!            ABS(p(i-3,j) + TWO*p(i-2,j) + p(i-1,j))
!
!divu      = gradu(i+1,j,1)+gradv(i+1,j,2)
!divu2     = divu*divu
!vort2     = (gradv(i+1,j,1)-gradu(i+1,j,2)) * (gradv(i+1,j,1)-gradu(i+1,j,2))
!ducros1   = divu2/(divu2+vort2+1d-15)
!dxm1      = HALF*(ONE-tanh(2.5d0+10.d0*vol(i+1,j)/(sq+1.d-15)*divu) )
!
!
!divu      = gradu(i-2,j,1)+gradv(i-2,j,2)
!divu2     = divu*divu
!vort2     = (gradv(i-2,j,1)-gradu(i-2,j,2)) * (gradv(i-2,j,1)-gradu(i-2,j,2))
!ducros2   = divu2/(divu2+vort2+1d-15)
!dxm2      = HALF*(ONE-tanh(2.5d0+10.d0*vol(i-2,j)/(sq+1.d-15)*divu) )
!coef      = MAX( k_sensor1*ducros1*dxm1, &
!                 k_sensor2*ducros2*dxm2, coef)
!coef      = MAX(sensor(i-1,j  ,1), sensor(i,j  ,1), &
!                sensor(i-1,j-1,1), sensor(i,j-1,1), &
!                sensor(i-1,j+1,1), sensor(i,j+1,1)  )
!
!coef      = MAX(sensor(i-3,j,1), sensor(i-2,j,1), &
!                sensor(i-1,j,1), sensor(i  ,j,1), &
!                sensor(i+1,j,1), sensor(i+2,j,1)  )
!
!coef      = MAX(sensor(i-2,j,1), &
!                sensor(i-1,j,1), sensor(i  ,j,1), &
!                sensor(i+1,j,1))
!
!rspec      = rconv(i,j,1)
!
    eps2d = k2*coefd
    eps2 = k2*coef
    IF (zero .LT. k4 - eps2*12.d0) THEN
      eps4d = -(12.d0*eps2d)
      eps4 = k4 - eps2*12.d0
    ELSE
      eps4 = zero
      eps4d = 0.0_8
    END IF
    diffrod = half*(wd(i, j, 1)-wd(i-1, j, 1))
    diffro = half*(w(i, j, 1)-w(i-1, j, 1))
    diffroud = half*(wd(i, j, 2)-wd(i-1, j, 2))
    diffrou = half*(w(i, j, 2)-w(i-1, j, 2))
    diffrovd = half*(wd(i, j, 3)-wd(i-1, j, 3))
    diffrov = half*(w(i, j, 3)-w(i-1, j, 3))
    diffrowd = half*(wd(i, j, 4)-wd(i-1, j, 4))
    diffrow = half*(w(i, j, 4)-w(i-1, j, 4))
    diffroed = half*(wd(i, j, 5)-wd(i-1, j, 5))
    diffroe = half*(w(i, j, 5)-w(i-1, j, 5))
!
!
!     if (eps4.gt.1.d-12) then
! #include "rhs/wiggle_diri.F"
!     endif
    temp0 = eps2*diffro + eps4*predro1
    dissro1d = temp0*rspecd + rspec*(diffro*eps2d+eps2*diffrod+predro1*&
&     eps4d+eps4*predro1d)
    temp0 = eps2*diffrou + eps4*predrou1
    dissrou1d = temp0*rspecd + rspec*(diffrou*eps2d+eps2*diffroud+&
&     predrou1*eps4d+eps4*predrou1d)
    temp0 = eps2*diffrov + eps4*predrov1
    dissrov1d = temp0*rspecd + rspec*(diffrov*eps2d+eps2*diffrovd+&
&     predrov1*eps4d+eps4*predrov1d)
    temp0 = eps2*diffrow + eps4*predrow1
    dissrow1d = temp0*rspecd + rspec*(diffrow*eps2d+eps2*diffrowd+&
&     predrow1*eps4d+eps4*predrow1d)
    temp0 = eps2*diffroe + eps4*predroe1
    dissroe1d = temp0*rspecd + rspec*(diffroe*eps2d+eps2*diffroed+&
&     predroe1*eps4d+eps4*predroe1d)
! #include "rhs/spectralradius_j.F"
! correction Rossow JCP 2000
!#include "rhs/spectralradiusRossow_j.F"
!1st direction
    rhomrd = wd(i, j, 1)
    rhomr = w(i, j, 1)
    temp0 = w(i, j, 2)/rhomr
    urd = (wd(i, j, 2)-temp0*rhomrd)/rhomr
    ur = temp0
    temp0 = w(i, j, 3)/rhomr
    vrd = (wd(i, j, 3)-temp0*rhomrd)/rhomr
    vr = temp0
    c2rd = gam*rgaz*tlocd(i, j)
    c2r = gam*rgaz*tloc(i, j)
!
    rhomld = wd(i, j-1, 1)
    rhoml = w(i, j-1, 1)
    temp0 = w(i, j-1, 2)/rhoml
    uld = (wd(i, j-1, 2)-temp0*rhomld)/rhoml
    ul = temp0
    temp0 = w(i, j-1, 3)/rhoml
    vld = (wd(i, j-1, 3)-temp0*rhomld)/rhoml
    vl = temp0
    c2ld = gam*rgaz*tlocd(i, j-1)
    c2l = gam*rgaz*tloc(i, j-1)
!
    temp0 = rhomr/rhoml
    temp = SQRT(temp0)
    IF (temp0 .EQ. 0.0) THEN
      rd = 0.0_8
    ELSE
      rd = (rhomrd-temp0*rhomld)/(2.0*temp*rhoml)
    END IF
    r = temp
    temp0 = one/(one+r)
    rrd = -(temp0*rd/(one+r))
    rr = temp0
    omrrd = -rrd
    omrr = one - rr
!
    ud = rr*uld + ul*rrd + omrr*urd + ur*omrrd
    u = ul*rr + ur*omrr
    vd = rr*vld + vl*rrd + omrr*vrd + vr*omrrd
    v = vl*rr + vr*omrr
!
    c2xd = rr*c2ld + c2l*rrd + omrr*c2rd + c2r*omrrd
    c2x = c2l*rr + c2r*omrr
    nx2 = nx(i, j, 2)*nx(i, j, 2) + ny(i, j, 2)*ny(i, j, 2)
    x6d = nx(i, j, 2)*ud + ny(i, j, 2)*vd
    x6 = nx(i, j, 2)*u + ny(i, j, 2)*v
    IF (x6 .GE. 0.) THEN
      abd = x6d
      ab = x6
    ELSE
      abd = -x6d
      ab = -x6
    END IF
    temp0 = SQRT(nx2*c2x)
    IF (nx2*c2x .EQ. 0.0) THEN
      sqd = 0.0_8
    ELSE
      sqd = nx2*c2xd/(2.0*temp0)
    END IF
    sq = temp0
!
    rspecd = abd + sqd
    rspec = ab + sq
    IF (p(i, j-1) - two*p(i, j) + p(i, j+1) .GE. 0.) THEN
      abs10d = pd(i, j-1) - two*pd(i, j) + pd(i, j+1)
      abs10 = p(i, j-1) - two*p(i, j) + p(i, j+1)
    ELSE
      abs10d = two*pd(i, j) - pd(i, j-1) - pd(i, j+1)
      abs10 = -(p(i, j-1)-two*p(i, j)+p(i, j+1))
    END IF
    x18d = pd(i, j-1) + two*pd(i, j) + pd(i, j+1)
    x18 = p(i, j-1) + two*p(i, j) + p(i, j+1)
    IF (x18 .GE. 0.) THEN
      abs24d = x18d
      abs24 = x18
    ELSE
      abs24d = -x18d
      abs24 = -x18
    END IF
!
! 2nd direction
    k_sensor1d = (abs10d-abs10*abs24d/abs24)/abs24
    k_sensor1 = abs10/abs24
    IF (p(i, j-2) - two*p(i, j-1) + p(i, j) .GE. 0.) THEN
      abs11d = pd(i, j-2) - two*pd(i, j-1) + pd(i, j)
      abs11 = p(i, j-2) - two*p(i, j-1) + p(i, j)
    ELSE
      abs11d = two*pd(i, j-1) - pd(i, j-2) - pd(i, j)
      abs11 = -(p(i, j-2)-two*p(i, j-1)+p(i, j))
    END IF
    x19d = pd(i, j-2) + two*pd(i, j-1) + pd(i, j)
    x19 = p(i, j-2) + two*p(i, j-1) + p(i, j)
    IF (x19 .GE. 0.) THEN
      abs25d = x19d
      abs25 = x19
    ELSE
      abs25d = -x19d
      abs25 = -x19
    END IF
    k_sensor2d = (abs11d-abs11*abs25d/abs25)/abs25
    k_sensor2 = abs11/abs25
!     ducros1 is done in dissipation_ducros_x
    divud = gradud(i, j, 1) + gradvd(i, j, 2)
    divu = gradu(i, j, 1) + gradv(i, j, 2)
    divu2d = 2*divu*divud
    divu2 = divu*divu
    vort2d = 2*(gradv(i, j, 1)-gradu(i, j, 2))*(gradvd(i, j, 1)-gradud(i&
&     , j, 2))
    vort2 = (gradv(i, j, 1)-gradu(i, j, 2))*(gradv(i, j, 1)-gradu(i, j, &
&     2))
    temp0 = divu2/(divu2+vort2+1d-15)
    ducros1d = (divu2d-temp0*(divu2d+vort2d))/(divu2+vort2+1d-15)
    ducros1 = temp0
! dxm1      = HALF*(ONE-tanh(2.5d0+10.d0*vol(i,j)/(sq+1.d-15)*divu) )
    arg1d = nx2*c2rd
    arg1 = c2r*nx2
    temp0 = SQRT(arg1)
    IF (arg1 .EQ. 0.0) THEN
      result1d = 0.0_8
    ELSE
      result1d = arg1d/(2.0*temp0)
    END IF
    result1 = temp0
    temp0 = 10.d0*vol(i, j)
    temp = divu/(result1+1.d-15)
    arg2d = temp0*(divud-temp*result1d)/(result1+1.d-15)
    arg2 = temp0*temp + 2.5d0
    dxm1d = -(half*(1.0-TANH(arg2)**2)*arg2d)
    dxm1 = half*(one-TANH(arg2))
    divud = gradud(i, j-1, 1) + gradvd(i, j-1, 2)
    divu = gradu(i, j-1, 1) + gradv(i, j-1, 2)
    divu2d = 2*divu*divud
    divu2 = divu*divu
    vort2d = 2*(gradv(i, j-1, 1)-gradu(i, j-1, 2))*(gradvd(i, j-1, 1)-&
&     gradud(i, j-1, 2))
    vort2 = (gradv(i, j-1, 1)-gradu(i, j-1, 2))*(gradv(i, j-1, 1)-gradu(&
&     i, j-1, 2))
    temp0 = divu2/(divu2+vort2+1.d-15)
    ducros2d = (divu2d-temp0*(divu2d+vort2d))/(divu2+vort2+1.d-15)
    ducros2 = temp0
!sq = sound/dx
! dxm2       = HALF*(ONE-tanh(2.5d0+10.d0*vol(i,j-1)/(sq+1.d-15)*divu) )
    arg1d = nx2*c2ld
    arg1 = c2l*nx2
    temp0 = SQRT(arg1)
    IF (arg1 .EQ. 0.0) THEN
      result1d = 0.0_8
    ELSE
      result1d = arg1d/(2.0*temp0)
    END IF
    result1 = temp0
    temp0 = 10.d0*vol(i, j-1)
    temp = divu/(result1+1.d-15)
    arg2d = temp0*(divud-temp*result1d)/(result1+1.d-15)
    arg2 = temp0*temp + 2.5d0
    dxm2d = -(half*(1.0-TANH(arg2)**2)*arg2d)
    dxm2 = half*(one-TANH(arg2))
    IF (k_sensor1 .LT. k_sensor2) THEN
      max6d = k_sensor2d
      max6 = k_sensor2
    ELSE
      max6d = k_sensor1d
      max6 = k_sensor1
    END IF
    IF (ducros1 .LT. ducros2) THEN
      max13d = ducros2d
      max13 = ducros2
    ELSE
      max13d = ducros1d
      max13 = ducros1
    END IF
    IF (dxm1 .LT. dxm2) THEN
      max20d = dxm2d
      max20 = dxm2
    ELSE
      max20d = dxm1d
      max20 = dxm1
    END IF
!coef      = MAX( k_sensor1*ducros1*dxm1, &
!                 k_sensor2*ducros2*dxm2)
    coefd = max20*(max13*max6d+max6*max13d) + max6*max13*max20d
    coef = max6*max13*max20
! extension of shock capturing
!k_sensor1 = ABS(p(i,j) - TWO*p(i,j+1) + p(i,j+2)) / &
!            ABS(p(i,j) + TWO*p(i,j+1) + p(i,j+2))
!
!k_sensor2 = ABS(p(i,j-3) - TWO*p(i,j-2) + p(i,j-1)) / &
!            ABS(p(i,j-3) + TWO*p(i,j-2) + p(i,j-1))
!
!divu      = gradu(i,j+1,1)+gradv(i,j+1,2)
!divu2     = divu*divu
!vort2     = (gradv(i,j+1,1)-gradu(i,j+1,2)) * (gradv(i,j+1,1)-gradu(i,j+1,2))
!ducros1   = divu2/(divu2+vort2+1d-15)
!dxm1      = HALF*(ONE-tanh(2.5d0+10.d0*vol(i,j+1)/(sq+1.d-15)*divu) )
!
!
!divu      = gradu(i,j-2,1)+gradv(i,j-2,2)
!divu2     = divu*divu
!vort2     = (gradv(i,j-2,1)-gradu(i,j-2,2)) * (gradv(i,j-2,1)-gradu(i,j-2,2))
!ducros2   = divu2/(divu2+vort2+1d-15)
!dxm2      = HALF*(ONE-tanh(2.5d0+10.d0*vol(i,j-2)/(sq+1.d-15)*divu) )
!
!coef      = MAX( k_sensor1*ducros1*dxm1, &
!                 k_sensor2*ducros2*dxm2, coef)
!coef      = MAX(sensor(i  ,j-1,2), sensor(i  ,j,2), &
!                sensor(i-1,j-1,2), sensor(i-1,j,2), &
!                sensor(i+1,j-1,2), sensor(i+1,j,2)  )
!
!coef      = MAX(sensor(i,j-3,2), sensor(i,j-2,2), &
!                sensor(i,j-1,2), sensor(i,j  ,2), &
!                sensor(i,j+1,2), sensor(i,j+2,2)  )
!
!coef      = MAX(sensor(i,j-2,2), &
!                sensor(i,j-1,2), sensor(i,j,2), &
!                sensor(i,j+1,2))
!
!rspec      = rconv(i,j,2)
    eps2d = k2*coefd
    eps2 = k2*coef
    IF (zero .LT. k4 - 12.d0*eps2) THEN
      eps4d = -(12.d0*eps2d)
      eps4 = k4 - 12.d0*eps2
    ELSE
      eps4 = zero
      eps4d = 0.0_8
    END IF
    diffrod = half*(wd(i, j, 1)-wd(i, j-1, 1))
    diffro = half*(w(i, j, 1)-w(i, j-1, 1))
    diffroud = half*(wd(i, j, 2)-wd(i, j-1, 2))
    diffrou = half*(w(i, j, 2)-w(i, j-1, 2))
    diffrovd = half*(wd(i, j, 3)-wd(i, j-1, 3))
    diffrov = half*(w(i, j, 3)-w(i, j-1, 3))
    diffrowd = half*(wd(i, j, 4)-wd(i, j-1, 4))
    diffrow = half*(w(i, j, 4)-w(i, j-1, 4))
    diffroed = half*(wd(i, j, 5)-wd(i, j-1, 5))
    diffroe = half*(w(i, j, 5)-w(i, j-1, 5))
!
!
!     if (eps4.gt.1.d-12) then
! #include "rhs/wiggle_dirj.F"
!     endif
!
    temp0 = eps2*diffro + eps4*predro2
    dissro2d = temp0*rspecd + rspec*(diffro*eps2d+eps2*diffrod+predro2*&
&     eps4d+eps4*predro2d)
    temp0 = eps2*diffrou + eps4*predrou2
    dissrou2d = temp0*rspecd + rspec*(diffrou*eps2d+eps2*diffroud+&
&     predrou2*eps4d+eps4*predrou2d)
    temp0 = eps2*diffrov + eps4*predrov2
    dissrov2d = temp0*rspecd + rspec*(diffrov*eps2d+eps2*diffrovd+&
&     predrov2*eps4d+eps4*predrov2d)
    temp0 = eps2*diffrow + eps4*predrow2
    dissrow2d = temp0*rspecd + rspec*(diffrow*eps2d+eps2*diffrowd+&
&     predrow2*eps4d+eps4*predrow2d)
    temp0 = eps2*diffroe + eps4*predroe2
    dissroe2d = temp0*rspecd + rspec*(diffroe*eps2d+eps2*diffroed+&
&     predroe2*eps4d+eps4*predroe2d)
    sc1 = nx(i, j, 1)
    sc2 = ny(i, j, 1)
    arg1 = sc1*sc1 + sc2*sc2
    sn = SQRT(arg1)
    invsn = one/sn
    nxloc = sc1*invsn
    nyloc = sc2*invsn
    hnd(i, j, 1, 1) = fxro1d - dissro1d
!
    hnd(i, j, 2, 1) = fxrou1d - dissrou1d - sn*(nxloc*fvrou1d+nyloc*&
&     gvrou1d)
!
    hnd(i, j, 3, 1) = fxrov1d - dissrov1d - sn*(nxloc*fvrov1d+nyloc*&
&     gvrov1d)
!
    hnd(i, j, 4, 1) = fxrow1d - dissrow1d - sn*(nxloc*fvrow1d+nyloc*&
&     gvrow1d)
!
    hnd(i, j, 5, 1) = fxroe1d - dissroe1d - sn*(nxloc*fvroe1d+nyloc*&
&     gvroe1d)
    sc1 = nx(i, j, 2)
    sc2 = ny(i, j, 2)
    arg1 = sc1*sc1 + sc2*sc2
    sn = SQRT(arg1)
    invsn = one/sn
    nxloc = sc1*invsn
    nyloc = sc2*invsn
    hnd(i, j, 1, 2) = fxro2d - dissro2d
!
    hnd(i, j, 2, 2) = fxrou2d - dissrou2d - sn*(nxloc*fvrou2d+nyloc*&
&     gvrou2d)
!
    hnd(i, j, 3, 2) = fxrov2d - dissrov2d - sn*(nxloc*fvrov2d+nyloc*&
&     gvrov2d)
!
    hnd(i, j, 4, 2) = fxrow2d - dissrow2d - sn*(nxloc*fvrow2d+nyloc*&
&     gvrow2d)
!
    hnd(i, j, 5, 2) = fxroe2d - dissroe2d - sn*(nxloc*fvroe2d+nyloc*&
&     gvroe2d)
  END DO
! force dp/dn = 0. at 2nd oder
! 9/8
  ct0 = 1.125d0
!-1/8
  ct1 = -0.125d0
! force dp/dn = 0. at 3rd oder
! ct0 = 225.d0/184.d0
! ct1 = -25.d0/92.d0
! ct2 = 9.d0/184.d0
  j = 1
!DIR$ IVDEP
  DO i=1,im+1
! for idir (only works for infinite Wall)
    fxro1d = nx(i, j, 1)*(c1*(fd(i, j, 1)+fd(i-1, j, 1))+c2*(fd(i+1, j, &
&     1)+fd(i-2, j, 1))+c3*(fd(i+2, j, 1)+fd(i-3, j, 1))) + ny(i, j, 1)*&
&     (c1*(gd(i, j, 1)+gd(i-1, j, 1))+c2*(gd(i+1, j, 1)+gd(i-2, j, 1))+&
&     c3*(gd(i+2, j, 1)+gd(i-3, j, 1)))
    fxrou1d = nx(i, j, 1)*(c1*(fd(i, j, 2)+fd(i-1, j, 2))+c2*(fd(i+1, j&
&     , 2)+fd(i-2, j, 2))+c3*(fd(i+2, j, 2)+fd(i-3, j, 2))) + ny(i, j, 1&
&     )*(c1*(gd(i, j, 2)+gd(i-1, j, 2))+c2*(gd(i+1, j, 2)+gd(i-2, j, 2))&
&     +c3*(gd(i+2, j, 2)+gd(i-3, j, 2)))
    fxrov1d = nx(i, j, 1)*(c1*(fd(i, j, 3)+fd(i-1, j, 3))+c2*(fd(i+1, j&
&     , 3)+fd(i-2, j, 3))+c3*(fd(i+2, j, 3)+fd(i-3, j, 3))) + ny(i, j, 1&
&     )*(c1*(gd(i, j, 3)+gd(i-1, j, 3))+c2*(gd(i+1, j, 3)+gd(i-2, j, 3))&
&     +c3*(gd(i+2, j, 3)+gd(i-3, j, 3)))
    fxrow1d = nx(i, j, 1)*(c1*(fd(i, j, 4)+fd(i-1, j, 4))+c2*(fd(i+1, j&
&     , 4)+fd(i-2, j, 4))+c3*(fd(i+2, j, 4)+fd(i-3, j, 4))) + ny(i, j, 1&
&     )*(c1*(gd(i, j, 4)+gd(i-1, j, 4))+c2*(gd(i+1, j, 4)+gd(i-2, j, 4))&
&     +c3*(gd(i+2, j, 4)+gd(i-3, j, 4)))
    fxroe1d = nx(i, j, 1)*(c1*(fd(i, j, 5)+fd(i-1, j, 5))+c2*(fd(i+1, j&
&     , 5)+fd(i-2, j, 5))+c3*(fd(i+2, j, 5)+fd(i-3, j, 5))) + ny(i, j, 1&
&     )*(c1*(gd(i, j, 5)+gd(i-1, j, 5))+c2*(gd(i+1, j, 5)+gd(i-2, j, 5))&
&     +c3*(gd(i+2, j, 5)+gd(i-3, j, 5)))
    predro1d = d2*wd(i-2, j, 1) - d3*wd(i-3, j, 1) - d1*wd(i-1, j, 1) + &
&     d1*wd(i, j, 1) - d2*wd(i+1, j, 1) + d3*wd(i+2, j, 1)
    predro1 = -(d3*w(i-3, j, 1)) + d2*w(i-2, j, 1) - d1*w(i-1, j, 1) + &
&     d1*w(i, j, 1) - d2*w(i+1, j, 1) + d3*w(i+2, j, 1)
    predrou1d = d2*wd(i-2, j, 2) - d3*wd(i-3, j, 2) - d1*wd(i-1, j, 2) +&
&     d1*wd(i, j, 2) - d2*wd(i+1, j, 2) + d3*wd(i+2, j, 2)
    predrou1 = -(d3*w(i-3, j, 2)) + d2*w(i-2, j, 2) - d1*w(i-1, j, 2) + &
&     d1*w(i, j, 2) - d2*w(i+1, j, 2) + d3*w(i+2, j, 2)
    predrov1d = d2*wd(i-2, j, 3) - d3*wd(i-3, j, 3) - d1*wd(i-1, j, 3) +&
&     d1*wd(i, j, 3) - d2*wd(i+1, j, 3) + d3*wd(i+2, j, 3)
    predrov1 = -(d3*w(i-3, j, 3)) + d2*w(i-2, j, 3) - d1*w(i-1, j, 3) + &
&     d1*w(i, j, 3) - d2*w(i+1, j, 3) + d3*w(i+2, j, 3)
    predrow1d = d2*wd(i-2, j, 4) - d3*wd(i-3, j, 4) - d1*wd(i-1, j, 4) +&
&     d1*wd(i, j, 4) - d2*wd(i+1, j, 4) + d3*wd(i+2, j, 4)
    predrow1 = -(d3*w(i-3, j, 4)) + d2*w(i-2, j, 4) - d1*w(i-1, j, 4) + &
&     d1*w(i, j, 4) - d2*w(i+1, j, 4) + d3*w(i+2, j, 4)
    predroe1d = d2*wd(i-2, j, 5) - d3*wd(i-3, j, 5) - d1*wd(i-1, j, 5) +&
&     d1*wd(i, j, 5) - d2*wd(i+1, j, 5) + d3*wd(i+2, j, 5)
    predroe1 = -(d3*w(i-3, j, 5)) + d2*w(i-2, j, 5) - d1*w(i-1, j, 5) + &
&     d1*w(i, j, 5) - d2*w(i+1, j, 5) + d3*w(i+2, j, 5)
! grad for viscous fluxes o2 - 3p
!
    volm1 = volf(i, j, 1)
! Normals
    nx_n = half*(nx(i+1, j, 1)+nx(i, j, 1))
    nx_s = -(half*(nx(i-1, j, 1)+nx(i, j, 1)))
    nx_o = half*(nx(i-1, j+1, 2)+nx(i, j+1, 2))
    nx_e = -(half*(nx(i-1, j, 2)+nx(i, j, 2)))
!
    ny_n = half*(ny(i+1, j, 1)+ny(i, j, 1))
    ny_s = -(half*(ny(i-1, j, 1)+ny(i, j, 1)))
    ny_o = half*(ny(i-1, j+1, 2)+ny(i, j+1, 2))
    ny_e = -(half*(ny(i-1, j, 2)+ny(i, j, 2)))
    val_nd = velxd(i, j)
    val_n = velx(i, j)
    val_sd = velxd(i-1, j)
    val_s = velx(i-1, j)
    val_ed = fourth*(velxd(i, j)+velxd(i, j-1)+velxd(i-1, j)+velxd(i-1, &
&     j-1))
    val_e = fourth*(velx(i, j)+velx(i, j-1)+velx(i-1, j)+velx(i-1, j-1))
    val_od = fourth*(velxd(i, j)+velxd(i, j+1)+velxd(i-1, j)+velxd(i-1, &
&     j+1))
    val_o = fourth*(velx(i, j)+velx(i, j+1)+velx(i-1, j)+velx(i-1, j+1))
    uxd = volm1*(nx_n*val_nd+nx_s*val_sd+nx_o*val_od+nx_e*val_ed)
    ux = (val_n*nx_n+val_s*nx_s+val_o*nx_o+val_e*nx_e)*volm1
    uyd = volm1*(ny_n*val_nd+ny_s*val_sd+ny_o*val_od+ny_e*val_ed)
    uy = (val_n*ny_n+val_s*ny_s+val_o*ny_o+val_e*ny_e)*volm1
    val_nd = velyd(i, j)
    val_n = vely(i, j)
    val_sd = velyd(i-1, j)
    val_s = vely(i-1, j)
    val_ed = fourth*(velyd(i, j)+velyd(i, j-1)+velyd(i-1, j)+velyd(i-1, &
&     j-1))
    val_e = fourth*(vely(i, j)+vely(i, j-1)+vely(i-1, j)+vely(i-1, j-1))
    val_od = fourth*(velyd(i, j)+velyd(i, j+1)+velyd(i-1, j)+velyd(i-1, &
&     j+1))
    val_o = fourth*(vely(i, j)+vely(i, j+1)+vely(i-1, j)+vely(i-1, j+1))
    vxd = volm1*(nx_n*val_nd+nx_s*val_sd+nx_o*val_od+nx_e*val_ed)
    vx = (val_n*nx_n+val_s*nx_s+val_o*nx_o+val_e*nx_e)*volm1
    vyd = volm1*(ny_n*val_nd+ny_s*val_sd+ny_o*val_od+ny_e*val_ed)
    vy = (val_n*ny_n+val_s*ny_s+val_o*ny_o+val_e*ny_e)*volm1
    val_nd = velzd(i, j)
    val_n = velz(i, j)
    val_sd = velzd(i-1, j)
    val_s = velz(i-1, j)
    val_ed = fourth*(velzd(i, j)+velzd(i, j-1)+velzd(i-1, j)+velzd(i-1, &
&     j-1))
    val_e = fourth*(velz(i, j)+velz(i, j-1)+velz(i-1, j)+velz(i-1, j-1))
    val_od = fourth*(velzd(i, j)+velzd(i, j+1)+velzd(i-1, j)+velzd(i-1, &
&     j+1))
    val_o = fourth*(velz(i, j)+velz(i, j+1)+velz(i-1, j)+velz(i-1, j+1))
    wxd = volm1*(nx_n*val_nd+nx_s*val_sd+nx_o*val_od+nx_e*val_ed)
    wx = (val_n*nx_n+val_s*nx_s+val_o*nx_o+val_e*nx_e)*volm1
    wyd = volm1*(ny_n*val_nd+ny_s*val_sd+ny_o*val_od+ny_e*val_ed)
    wy = (val_n*ny_n+val_s*ny_s+val_o*ny_o+val_e*ny_e)*volm1
    val_nd = tlocd(i, j)
    val_n = tloc(i, j)
    val_sd = tlocd(i-1, j)
    val_s = tloc(i-1, j)
    val_ed = fourth*(tlocd(i, j)+tlocd(i, j-1)+tlocd(i-1, j)+tlocd(i-1, &
&     j-1))
    val_e = fourth*(tloc(i, j)+tloc(i, j-1)+tloc(i-1, j)+tloc(i-1, j-1))
    val_od = fourth*(tlocd(i, j)+tlocd(i, j+1)+tlocd(i-1, j)+tlocd(i-1, &
&     j+1))
    val_o = fourth*(tloc(i, j)+tloc(i, j+1)+tloc(i-1, j)+tloc(i-1, j+1))
!
    txd = volm1*(nx_n*val_nd+nx_s*val_sd+nx_o*val_od+nx_e*val_ed)
    tx = (val_n*nx_n+val_s*nx_s+val_o*nx_o+val_e*nx_e)*volm1
    tyd = volm1*(ny_n*val_nd+ny_s*val_sd+ny_o*val_od+ny_e*val_ed)
    ty = (val_n*ny_n+val_s*ny_s+val_o*ny_o+val_e*ny_e)*volm1
!
! Computation of viscous fluxes
!
    uud = half*(velxd(i, j)+velxd(i-1, j))
    uu = half*(velx(i, j)+velx(i-1, j))
    vvd = half*(velyd(i, j)+velyd(i-1, j))
    vv = half*(vely(i, j)+vely(i-1, j))
    wwd = half*(velzd(i, j)+velzd(i-1, j))
    ww = half*(velz(i, j)+velz(i-1, j))
!
    mmud = half*(mud(i, j)+mud(i-1, j))
    mmu = half*(mu(i, j)+mu(i-1, j))
    lambdad = half*cpprandtl*(mud(i, j)+mud(i-1, j))
    lambda = half*(mu(i, j)+mu(i-1, j))*cpprandtl
!
    fvrou1d = twothird*((two*ux-vy)*mmud+mmu*(two*uxd-vyd))
    fvrou1 = twothird*mmu*(two*ux-vy)
    fvrov1d = (uy+vx)*mmud + mmu*(uyd+vxd)
    fvrov1 = mmu*(uy+vx)
    fvrow1d = wx*mmud + mmu*wxd
    fvrow1 = mmu*wx
    fvroe1d = tx*lambdad + lambda*txd + fvrou1*uud + uu*fvrou1d + fvrov1&
&     *vvd + vv*fvrov1d + fvrow1*wwd + ww*fvrow1d
!
    gvrou1d = (uy+vx)*mmud + mmu*(uyd+vxd)
    gvrou1 = mmu*(uy+vx)
    gvrov1d = twothird*((two*vy-ux)*mmud+mmu*(two*vyd-uxd))
    gvrov1 = twothird*mmu*(-ux+two*vy)
    gvrow1d = wy*mmud + mmu*wyd
    gvrow1 = mmu*wy
    gvroe1d = ty*lambdad + lambda*tyd + gvrou1*uud + uu*gvrou1d + gvrov1&
&     *vvd + vv*gvrov1d + gvrow1*wwd + ww*gvrow1d
!!  fvrou1 = TWOTHIRD*mmu*( TWO*ux -     vy  -   wz  )
!!  fvrov1 =          mmu*(     uy +     vx          )
!!  fvrow1 =          mmu*(     uz           +   wx  )
!!  fvroe1 = lambda*tx + uu*fvrou1 + vv*fvrov1 + ww * fvrow1
!!  !
!!  gvrou1 =          mmu*(     uy +     vx          )
!!  gvrov1 = TWOTHIRD*mmu*(    -ux + TWO*vy   -  wz  )
!!  gvrow1 =          mmu*(              vz   +  wy  )
!!  gvroe1 = lambda*ty + uu*gvrou1 + vv*gvrov1 + ww * gvrow1
! #include "rhs/spectralradius_i.F"
! correction Rossow JCP 2000
!#include "rhs/spectralradiusRossow_i.F"
!1st direction
    rhomrd = wd(i, j, 1)
    rhomr = w(i, j, 1)
    temp0 = w(i, j, 2)/rhomr
    urd = (wd(i, j, 2)-temp0*rhomrd)/rhomr
    ur = temp0
    temp0 = w(i, j, 3)/rhomr
    vrd = (wd(i, j, 3)-temp0*rhomrd)/rhomr
    vr = temp0
    c2rd = gam*rgaz*tlocd(i, j)
    c2r = gam*rgaz*tloc(i, j)
!
    rhomld = wd(i-1, j, 1)
    rhoml = w(i-1, j, 1)
    temp0 = w(i-1, j, 2)/rhoml
    uld = (wd(i-1, j, 2)-temp0*rhomld)/rhoml
    ul = temp0
    temp0 = w(i-1, j, 3)/rhoml
    vld = (wd(i-1, j, 3)-temp0*rhomld)/rhoml
    vl = temp0
    c2ld = gam*rgaz*tlocd(i-1, j)
    c2l = gam*rgaz*tloc(i-1, j)
!
    temp0 = rhomr/rhoml
    temp = SQRT(temp0)
    IF (temp0 .EQ. 0.0) THEN
      rd = 0.0_8
    ELSE
      rd = (rhomrd-temp0*rhomld)/(2.0*temp*rhoml)
    END IF
    r = temp
    temp0 = one/(one+r)
    rrd = -(temp0*rd/(one+r))
    rr = temp0
    omrrd = -rrd
    omrr = one - rr
!
    ud = rr*uld + ul*rrd + omrr*urd + ur*omrrd
    u = ul*rr + ur*omrr
    vd = rr*vld + vl*rrd + omrr*vrd + vr*omrrd
    v = vl*rr + vr*omrr
!
    c2xd = rr*c2ld + c2l*rrd + omrr*c2rd + c2r*omrrd
    c2x = c2l*rr + c2r*omrr
    nx2 = nx(i, j, 1)*nx(i, j, 1) + ny(i, j, 1)*ny(i, j, 1)
    x7d = nx(i, j, 1)*ud + ny(i, j, 1)*vd
    x7 = nx(i, j, 1)*u + ny(i, j, 1)*v
    IF (x7 .GE. 0.) THEN
      abd = x7d
      ab = x7
    ELSE
      abd = -x7d
      ab = -x7
    END IF
    temp0 = SQRT(nx2*c2x)
    IF (nx2*c2x .EQ. 0.0) THEN
      sqd = 0.0_8
    ELSE
      sqd = nx2*c2xd/(2.0*temp0)
    END IF
    sq = temp0
!
    rspecd = abd + sqd
    rspec = ab + sq
    IF (p(i-1, j) - two*p(i, j) + p(i+1, j) .GE. 0.) THEN
      abs12d = pd(i-1, j) - two*pd(i, j) + pd(i+1, j)
      abs12 = p(i-1, j) - two*p(i, j) + p(i+1, j)
    ELSE
      abs12d = two*pd(i, j) - pd(i-1, j) - pd(i+1, j)
      abs12 = -(p(i-1, j)-two*p(i, j)+p(i+1, j))
    END IF
    x20d = pd(i-1, j) + two*pd(i, j) + pd(i+1, j)
    x20 = p(i-1, j) + two*p(i, j) + p(i+1, j)
    IF (x20 .GE. 0.) THEN
      abs26d = x20d
      abs26 = x20
    ELSE
      abs26d = -x20d
      abs26 = -x20
    END IF
!
!1st direction
    k_sensor1d = (abs12d-abs12*abs26d/abs26)/abs26
    k_sensor1 = abs12/abs26
    IF (p(i-2, j) - two*p(i-1, j) + p(i, j) .GE. 0.) THEN
      abs13d = pd(i-2, j) - two*pd(i-1, j) + pd(i, j)
      abs13 = p(i-2, j) - two*p(i-1, j) + p(i, j)
    ELSE
      abs13d = two*pd(i-1, j) - pd(i-2, j) - pd(i, j)
      abs13 = -(p(i-2, j)-two*p(i-1, j)+p(i, j))
    END IF
    x21d = pd(i-2, j) + two*pd(i-1, j) + pd(i, j)
    x21 = p(i-2, j) + two*p(i-1, j) + p(i, j)
    IF (x21 .GE. 0.) THEN
      abs27d = x21d
      abs27 = x21
    ELSE
      abs27d = -x21d
      abs27 = -x21
    END IF
    k_sensor2d = (abs13d-abs13*abs27d/abs27)/abs27
    k_sensor2 = abs13/abs27
    divud = gradud(i, j, 1) + gradvd(i, j, 2)
    divu = gradu(i, j, 1) + gradv(i, j, 2)
    divu2d = 2*divu*divud
    divu2 = divu*divu
    vort2d = 2*(gradv(i, j, 1)-gradu(i, j, 2))*(gradvd(i, j, 1)-gradud(i&
&     , j, 2))
    vort2 = (gradv(i, j, 1)-gradu(i, j, 2))*(gradv(i, j, 1)-gradu(i, j, &
&     2))
    temp0 = divu2/(divu2+vort2+1d-15)
    ducros1d = (divu2d-temp0*(divu2d+vort2d))/(divu2+vort2+1d-15)
    ducros1 = temp0
! dxm1      = HALF*(ONE-tanh(2.5d0+10.d0*vol(i,j)/(sq+1.d-15)*divu) )
    arg1d = nx2*c2rd
    arg1 = c2r*nx2
    temp0 = SQRT(arg1)
    IF (arg1 .EQ. 0.0) THEN
      result1d = 0.0_8
    ELSE
      result1d = arg1d/(2.0*temp0)
    END IF
    result1 = temp0
    temp0 = 10.d0*vol(i, j)
    temp = divu/(result1+1.d-15)
    arg2d = temp0*(divud-temp*result1d)/(result1+1.d-15)
    arg2 = temp0*temp + 2.5d0
    dxm1d = -(half*(1.0-TANH(arg2)**2)*arg2d)
    dxm1 = half*(one-TANH(arg2))
    divud = gradud(i-1, j, 1) + gradvd(i-1, j, 2)
    divu = gradu(i-1, j, 1) + gradv(i-1, j, 2)
    divu2d = 2*divu*divud
    divu2 = divu*divu
    vort2d = 2*(gradv(i-1, j, 1)-gradu(i-1, j, 2))*(gradvd(i-1, j, 1)-&
&     gradud(i-1, j, 2))
    vort2 = (gradv(i-1, j, 1)-gradu(i-1, j, 2))*(gradv(i-1, j, 1)-gradu(&
&     i-1, j, 2))
    temp0 = divu2/(divu2+vort2+1d-15)
    ducros2d = (divu2d-temp0*(divu2d+vort2d))/(divu2+vort2+1d-15)
    ducros2 = temp0
! dxm2      = HALF*(ONE-tanh(2.5d0+10.d0*vol(i-1,j)/(sq+1.d-15)*divu) )
    arg1d = nx2*c2ld
    arg1 = c2l*nx2
    temp0 = SQRT(arg1)
    IF (arg1 .EQ. 0.0) THEN
      result1d = 0.0_8
    ELSE
      result1d = arg1d/(2.0*temp0)
    END IF
    result1 = temp0
    temp0 = 10.d0*vol(i-1, j)
    temp = divu/(result1+1.d-15)
    arg2d = temp0*(divud-temp*result1d)/(result1+1.d-15)
    arg2 = temp0*temp + 2.5d0
    dxm2d = -(half*(1.0-TANH(arg2)**2)*arg2d)
    dxm2 = half*(one-TANH(arg2))
    IF (k_sensor1 .LT. k_sensor2) THEN
      max7d = k_sensor2d
      max7 = k_sensor2
    ELSE
      max7d = k_sensor1d
      max7 = k_sensor1
    END IF
    IF (ducros1 .LT. ducros2) THEN
      max14d = ducros2d
      max14 = ducros2
    ELSE
      max14d = ducros1d
      max14 = ducros1
    END IF
    IF (dxm1 .LT. dxm2) THEN
      max21d = dxm2d
      max21 = dxm2
    ELSE
      max21d = dxm1d
      max21 = dxm1
    END IF
!coef      = MAX( k_sensor1*ducros1*dxm1, &
!                 k_sensor2*ducros2*dxm2)
    coefd = max21*(max14*max7d+max7*max14d) + max7*max14*max21d
    coef = max7*max14*max21
!     ! extension of shock capturing
!
!k_sensor1 = ABS(p(i,j) - TWO*p(i+1,j) + p(i+2,j)) / &
!            ABS(p(i,j) + TWO*p(i+1,j) + p(i+2,j))
!
!k_sensor2 = ABS(p(i-3,j) - TWO*p(i-2,j) + p(i-1,j)) / &
!            ABS(p(i-3,j) + TWO*p(i-2,j) + p(i-1,j))
!
!divu      = gradu(i+1,j,1)+gradv(i+1,j,2)
!divu2     = divu*divu
!vort2     = (gradv(i+1,j,1)-gradu(i+1,j,2)) * (gradv(i+1,j,1)-gradu(i+1,j,2))
!ducros1   = divu2/(divu2+vort2+1d-15)
!dxm1      = HALF*(ONE-tanh(2.5d0+10.d0*vol(i+1,j)/(sq+1.d-15)*divu) )
!
!
!divu      = gradu(i-2,j,1)+gradv(i-2,j,2)
!divu2     = divu*divu
!vort2     = (gradv(i-2,j,1)-gradu(i-2,j,2)) * (gradv(i-2,j,1)-gradu(i-2,j,2))
!ducros2   = divu2/(divu2+vort2+1d-15)
!dxm2      = HALF*(ONE-tanh(2.5d0+10.d0*vol(i-2,j)/(sq+1.d-15)*divu) )
!coef      = MAX( k_sensor1*ducros1*dxm1, &
!                 k_sensor2*ducros2*dxm2, coef)
!coef      = MAX(sensor(i-1,j  ,1), sensor(i,j  ,1), &
!                sensor(i-1,j-1,1), sensor(i,j-1,1), &
!                sensor(i-1,j+1,1), sensor(i,j+1,1)  )
!
!coef      = MAX(sensor(i-3,j,1), sensor(i-2,j,1), &
!                sensor(i-1,j,1), sensor(i  ,j,1), &
!                sensor(i+1,j,1), sensor(i+2,j,1)  )
!
!coef      = MAX(sensor(i-2,j,1), &
!                sensor(i-1,j,1), sensor(i  ,j,1), &
!                sensor(i+1,j,1))
!
!rspec      = rconv(i,j,1)
!
    eps2d = k2*coefd
    eps2 = k2*coef
    IF (zero .LT. k4 - eps2*12.d0) THEN
      eps4d = -(12.d0*eps2d)
      eps4 = k4 - eps2*12.d0
    ELSE
      eps4 = zero
      eps4d = 0.0_8
    END IF
    diffrod = half*(wd(i, j, 1)-wd(i-1, j, 1))
    diffro = half*(w(i, j, 1)-w(i-1, j, 1))
    diffroud = half*(wd(i, j, 2)-wd(i-1, j, 2))
    diffrou = half*(w(i, j, 2)-w(i-1, j, 2))
    diffrovd = half*(wd(i, j, 3)-wd(i-1, j, 3))
    diffrov = half*(w(i, j, 3)-w(i-1, j, 3))
    diffrowd = half*(wd(i, j, 4)-wd(i-1, j, 4))
    diffrow = half*(w(i, j, 4)-w(i-1, j, 4))
    diffroed = half*(wd(i, j, 5)-wd(i-1, j, 5))
    diffroe = half*(w(i, j, 5)-w(i-1, j, 5))
!
!
!     if (eps4.gt.1.d-12) then
! #include "rhs/wiggle_diri.F"
!     endif
    temp0 = eps2*diffro + eps4*predro1
    dissro1d = temp0*rspecd + rspec*(diffro*eps2d+eps2*diffrod+predro1*&
&     eps4d+eps4*predro1d)
    temp0 = eps2*diffrou + eps4*predrou1
    dissrou1d = temp0*rspecd + rspec*(diffrou*eps2d+eps2*diffroud+&
&     predrou1*eps4d+eps4*predrou1d)
    temp0 = eps2*diffrov + eps4*predrov1
    dissrov1d = temp0*rspecd + rspec*(diffrov*eps2d+eps2*diffrovd+&
&     predrov1*eps4d+eps4*predrov1d)
    temp0 = eps2*diffrow + eps4*predrow1
    dissrow1d = temp0*rspecd + rspec*(diffrow*eps2d+eps2*diffrowd+&
&     predrow1*eps4d+eps4*predrow1d)
    temp0 = eps2*diffroe + eps4*predroe1
    dissroe1d = temp0*rspecd + rspec*(diffroe*eps2d+eps2*diffroed+&
&     predroe1*eps4d+eps4*predroe1d)
    sc1 = nx(i, j, 1)
    sc2 = ny(i, j, 1)
    arg1 = sc1*sc1 + sc2*sc2
    sn = SQRT(arg1)
    invsn = one/sn
    nxloc = sc1*invsn
    nyloc = sc2*invsn
    hnd(i, j, 1, 1) = fxro1d - dissro1d
!
    hnd(i, j, 2, 1) = fxrou1d - dissrou1d - sn*(nxloc*fvrou1d+nyloc*&
&     gvrou1d)
!
    hnd(i, j, 3, 1) = fxrov1d - dissrov1d - sn*(nxloc*fvrov1d+nyloc*&
&     gvrov1d)
!
    hnd(i, j, 4, 1) = fxrow1d - dissrow1d - sn*(nxloc*fvrow1d+nyloc*&
&     gvrow1d)
!
    hnd(i, j, 5, 1) = fxroe1d - dissroe1d - sn*(nxloc*fvroe1d+nyloc*&
&     gvroe1d)
!jdir
!Euler part
    pwd = ct0*pd(i, j) + ct1*pd(i, j+1)
!pw = p(i,j)
!!  ! order 3
!!  pw = ct0*p(i,j  ) +&
!!       ct1*p(i,j+1) +&
!!       ct2*p(i,j+2)
! fxro2  = ZERO
! fxrou2 = ZERO
    fxrov2d = pwd
! fxrow2 = ZERO
! fxroe2 = ZERO
!ns part
! viscosity is taken at the first center
    mmud = mud(i, j)
    mmu = mu(i, j)
!
! compute gradient-------------------------------------
! vel_wall = 0 ==> dveli/dxi = 2 * velcenter_i *nxi/vol
    temp0 = nx(i, j, 2)*volf(i, j, 2)
    uxd = temp0*two*velxd(i, j)
    ux = temp0*(two*velx(i, j))
    temp0 = nx(i, j, 2)*volf(i, j, 2)
    vxd = temp0*two*velyd(i, j)
    vx = temp0*(two*vely(i, j))
    temp0 = nx(i, j, 2)*volf(i, j, 2)
    wxd = temp0*two*velzd(i, j)
    wx = temp0*(two*velz(i, j))
    temp0 = ny(i, j, 2)*volf(i, j, 2)
    uyd = temp0*two*velxd(i, j)
    uy = temp0*(two*velx(i, j))
    temp0 = ny(i, j, 2)*volf(i, j, 2)
    vyd = temp0*two*velyd(i, j)
    vy = temp0*(two*vely(i, j))
    temp0 = ny(i, j, 2)*volf(i, j, 2)
    wyd = temp0*two*velzd(i, j)
    wy = temp0*(two*velz(i, j))
    temp0 = nx(i, j, 2)*volf(i, j, 2)
    txd = temp0*tlocd(i, j)
    tx = temp0*(tloc(i, j)-twall)
    temp0 = ny(i, j, 2)*volf(i, j, 2)
    tyd = temp0*tlocd(i, j)
    ty = temp0*(tloc(i, j)-twall)
! ux = ZERO
! vx = ZERO
! wx = ZERO
!
! set viscous fluxes at wall----------------------------
! dir normal to the wall
    fvrou2d = twothird*((two*ux-vy)*mmud+mmu*(two*uxd-vyd))
    fvrov2d = (uy+vx)*mmud + mmu*(uyd+vxd)
    fvrow2d = wx*mmud + mmu*wxd
    fvroe2d = tx*lambdad + lambda*txd
!
    gvrou2d = (uy+vx)*mmud + mmu*(uyd+vxd)
    gvrov2d = twothird*((two*vy-ux)*mmud+mmu*(two*vyd-uxd))
    gvrow2d = wy*mmud + mmu*wyd
!
    gvroe2d = ty*lambdad + lambda*tyd
!
    hnd(i, j, 1, 2) = 0.0_8
    hnd(i, j, 2, 2) = nx(i, j, 2)*fxrov2d - nx(i, j, 2)*fvrou2d - ny(i, &
&     j, 2)*gvrou2d
    hnd(i, j, 3, 2) = ny(i, j, 2)*fxrov2d - nx(i, j, 2)*fvrov2d - ny(i, &
&     j, 2)*gvrov2d
    hnd(i, j, 4, 2) = -(nx(i, j, 2)*fvrow2d) - ny(i, j, 2)*gvrow2d
    hnd(i, j, 5, 2) = -(nx(i, j, 2)*fvroe2d) - ny(i, j, 2)*gvroe2d
  END DO
  residud = 0.0_8
! fluxes balance
  DO j=1,jm
!DIR$ IVDEP
    DO i=1,im
      residud(i, j, 1) = hnd(i, j, 1, 1) - hnd(i+1, j, 1, 1) + hnd(i, j&
&       , 1, 2) - hnd(i, j+1, 1, 2)
      residud(i, j, 2) = hnd(i, j, 2, 1) - hnd(i+1, j, 2, 1) + hnd(i, j&
&       , 2, 2) - hnd(i, j+1, 2, 2)
      residud(i, j, 3) = hnd(i, j, 3, 1) - hnd(i+1, j, 3, 1) + hnd(i, j&
&       , 3, 2) - hnd(i, j+1, 3, 2)
      residud(i, j, 4) = hnd(i, j, 4, 1) - hnd(i+1, j, 4, 1) + hnd(i, j&
&       , 4, 2) - hnd(i, j+1, 4, 2)
      residud(i, j, 5) = hnd(i, j, 5, 1) - hnd(i+1, j, 5, 1) + hnd(i, j&
&       , 5, 2) - hnd(i, j+1, 5, 2)
    END DO
  END DO
END SUBROUTINE FLUX_NUM_DNC5_ISO_2D_D
!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

