! This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0. If a copy of the MPL was not distributed with this file, You can obtain one at https://mozilla.org/MPL/2.0/.
!        Generated by TAPENADE     (INRIA, Ecuador team)
!  Tapenade 3.16 (master) -  9 Oct 2020 17:47
!
!  Differentiation of flux_num_dnc7_euler_nowall_2d in reverse (adjoint) mode (with options with!SliceDeadControl with!SliceDeadI
!nstrs with!StaticTaping):
!   gradient     of useful results: residu
!   with respect to varying inputs: w residu
!   RW status of diff variables: w:out residu:in-out
! =============================================================================
!          consistent fluxes for DNC7 2D
! =============================================================================
!
SUBROUTINE FLUX_NUM_DNC7_EULER_NOWALL_2D_B(residu, residub, w, wb, x0, &
& y0, nx, ny, xc, yc, vol, gh, cp, cv, gam, rgaz, k2, k4, im, jm)
  IMPLICIT NONE
! variables for dimension -----------------------------------------
  INTEGER :: im, jm, gh
! required arguments ----------------------------------------------
! thermo
  REAL*8, INTENT(IN) :: cp, cv, gam, rgaz
! dissipation
  REAL*8, INTENT(IN) :: k2, k4
  REAL*8, DIMENSION(1-gh:im+gh+1, 1-gh:jm+gh+1), INTENT(IN) :: x0
  REAL*8, DIMENSION(1-gh:im+gh+1, 1-gh:jm+gh+1), INTENT(IN) :: y0
  REAL*8, DIMENSION(1-gh:im+gh+1, 1-gh:jm+gh+1, 2), INTENT(IN) :: nx
  REAL*8, DIMENSION(1-gh:im+gh+1, 1-gh:jm+gh+1, 2), INTENT(IN) :: ny
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh), INTENT(IN) :: xc
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh), INTENT(IN) :: yc
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh), INTENT(IN) :: vol
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh, 5), INTENT(IN) :: w
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh, 5) :: wb
! Returned objects ------------------------------------------------
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh, 5), INTENT(INOUT) :: residu
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh, 5), INTENT(INOUT) :: residub
! Non-required arguments -------------------------------------------
  REAL*8, DIMENSION(1-gh:im+gh+1, 1-gh:jm+gh+1, 5, 2) :: hn
  REAL*8, DIMENSION(1-gh:im+gh+1, 1-gh:jm+gh+1, 5, 2) :: hnb
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh, 5) :: f, g
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh, 5) :: fb, gb
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh) :: velx
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh) :: velxb
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh) :: vely
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh) :: velyb
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh) :: velz
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh) :: velzb
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh) :: tloc
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh) :: tlocb
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh) :: p
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh) :: pb
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh, 2) :: gradu, gradv, gradw
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh, 2) :: gradub, gradvb
  REAL*8, DIMENSION(5) :: deltar, deltal, t
  INTEGER :: i, j, h
  REAL*8 :: nx_n, nx_s, nx_e, nx_o, volm1, ux, vx, wx, tx
  REAL*8 :: ny_n, ny_s, ny_e, ny_o, uy, vy, wy, ty
  REAL*8 :: val_n, val_s, val_e, val_o
  REAL*8 :: fxro1, fxro2, fxrou1, fxrou2, fxrov1, fxrov2, fxrow1, fxrow2&
& , fxroe1, fxroe2
  REAL*8 :: fxro1b, fxro2b, fxrou1b, fxrou2b, fxrov1b, fxrov2b, fxrow1b&
& , fxrow2b, fxroe1b, fxroe2b
  REAL*8 :: fvro1, fvro2, fvrou1, fvrou2, fvrov1, fvrov2, fvrow1, fvrow2&
& , fvroe1, fvroe2
  REAL*8 :: gvro1, gvro2, gvrou1, gvrou2, gvrov1, gvrov2, gvrow1, gvrow2&
& , gvroe1, gvroe2
  REAL*8 :: dissro1, dissro2, dissrou1, dissrou2, dissrov1, dissrov2, &
& dissrow1, dissrow2, dissroe1, dissroe2
  REAL*8 :: dissro1b, dissro2b, dissrou1b, dissrou2b, dissrov1b, &
& dissrov2b, dissrow1b, dissrow2b, dissroe1b, dissroe2b
  REAL*8 :: uu, vv, ww, ro, rom1, htot, eloc, ec
  REAL*8 :: rob, rom1b, htotb, elocb, ecb
  REAL*8 :: predro1, predrou1, predrov1, predrow1, predroe1, eps2, eps4
  REAL*8 :: predro1b, predrou1b, predrov1b, predrow1b, predroe1b, eps2b&
& , eps4b
  REAL*8 :: predro2, predrou2, predrov2, predrow2, predroe2, rspec
  REAL*8 :: predro2b, predrou2b, predrov2b, predrow2b, predroe2b, rspecb
  REAL*8 :: divu, divu2, vort2, dxm1, dym1, dxm2, dym2
  REAL*8 :: divub, divu2b, vort2b, dxm1b, dxm2b
  REAL*8 :: gui, gvi, gwi, gmui
  REAL*8 :: guib, gvib
  REAL*8 :: guj, gvj, gwj, gmuj
  REAL*8 :: gujb, gvjb
  REAL*8 :: nxloc, nyloc, sn, invsn, sc1, sc2
  REAL*8 :: rhom, rhomr, rhoml, rhom1l, c2l, c2r, rr, r, u, ur, ul, vr, &
& vl, wr, wl, c2x, nx2, ny2
  REAL*8 :: rhomrb, rhomlb, c2lb, c2rb, rrb, rb, ub, urb, ulb, vrb, vlb&
& , c2xb
  REAL*8 :: ab, sq, ducros1, ducros2, k_sensor1, k_sensor2
  REAL*8 :: abb, sqb, ducros1b, ducros2b, k_sensor1b, k_sensor2b
  REAL*8 :: b1, b2, b3, b4, b5, c1, c2, c3, c4, c5, d1, d2, d3, d4, d5, &
& wiggle, denom, betas
  REAL*8 :: coef, omrr, test, diffro, diffrou, diffrov, diffrow, diffroe&
& , v
  REAL*8 :: coefb, omrrb, diffrob, diffroub, diffrovb, diffrowb, &
& diffroeb, vb
  REAL*8 :: half, one, zero, two, twothird, fourth, twelfth, cvm1
  REAL*8 :: twentyfourth, ccross
  REAL*8 :: mach2, alpha, vn2, cprim
  REAL*8 :: mach2b, alphab, vn2b, cprimb
  INTRINSIC SQRT
  INTRINSIC MIN
  INTRINSIC ABS
  INTRINSIC TANH
  INTRINSIC MAX
  REAL*8 :: x1
  REAL*8 :: x1b
  REAL*8 :: x2
  REAL*8 :: x2b
  REAL*8 :: x3
  REAL*8 :: x3b
  REAL*8 :: x4
  REAL*8 :: x4b
  REAL*8 :: x5
  REAL*8 :: x5b
  REAL*8 :: x6
  REAL*8 :: x6b
  REAL*8 :: abs0
  REAL*8 :: abs0b
  REAL*8 :: abs1
  REAL*8 :: abs1b
  REAL*8 :: abs2
  REAL*8 :: abs2b
  REAL*8 :: abs3
  REAL*8 :: abs3b
  REAL*8 :: abs4
  REAL*8 :: abs4b
  REAL*8 :: abs5
  REAL*8 :: abs5b
  REAL*8 :: abs6
  REAL*8 :: abs6b
  REAL*8 :: abs7
  REAL*8 :: abs7b
  REAL*8 :: temp
  REAL*8 :: tempb
  REAL*8 :: temp0
  REAL*8 :: tempb0
  REAL*8 :: ad_save
  REAL*8 :: ad_save0
  REAL*8 :: ad_save1
  REAL*8 :: ad_save2
  REAL*8 :: ad_save3
  REAL*8 :: ad_save4
  REAL*8 :: ad_save5
  REAL*8 :: ad_save6
  REAL*8 :: ad_save7
  REAL*8 :: ad_save8
  REAL*8 :: ad_save9
  REAL*8 :: ad_save10
  REAL*8 :: ad_save11
  REAL*8 :: ad_save12
  REAL*8 :: ad_save13
  REAL*8 :: ad_save14
  INTEGER :: ad_branch
  INTEGER :: ad_branch0
  INTEGER :: ad_branch1
  INTEGER :: ad_branch2
  INTEGER :: ad_branch3
  INTEGER :: ad_branch4
  INTEGER :: ad_branch5
  INTEGER :: ad_branch6
  INTEGER :: ad_branch7
  INTEGER :: ad_branch8
  INTEGER :: ad_branch9
  INTEGER :: ad_branch10
  INTEGER :: ad_branch11
  INTEGER :: ad_branch12
  INTEGER :: ad_branch13
  INTEGER :: ad_branch14
! -----------------------------------------------------------------
!
  half = 0.5d0
  one = 1.d0
  zero = 0.d0
  two = 2.d0
  cvm1 = one/cv
! k2 = 1.d0
! k4 = 1.d0/1260.d0 already in coef for predictor
  denom = 1.d0/840.d0
! Coef for grad o8
! 4.d0/5.d0
  b1 = 672.d0*denom
!-1.d0/5.d0
  b2 = -(168.d0*denom)
! 4.d0/105.d0
  b3 = 32.d0*denom
!-1.d0/280.d0
  b4 = -(3.d0*denom)
!expression for FV
! c4 = a4
! c3 = c4 + a3
! c2 = c3 + a2
! c1 = c2 + a1
!
  c1 = 533.d0*denom
  c2 = -(139.d0*denom)
  c3 = 29.d0*denom
  c4 = -(3.d0*denom)
! coef for predictor
  denom = 1.d0/280.d0
!
  d1 = 35.d0*denom
  d2 = 21.d0*denom
  d3 = 7.d0*denom
  d4 = 1.d0*denom
!$FWD-OF II-LOOP 
! Primitives
  DO j=1-gh,jm+gh
!DIR$ IVDEP
    DO i=1-gh,im+gh
      ro = w(i, j, 1)
      rom1 = one/ro
      velx(i, j) = w(i, j, 2)*rom1
      vely(i, j) = w(i, j, 3)*rom1
      velz(i, j) = w(i, j, 4)*rom1
!
      ec = half*(velx(i, j)*velx(i, j)+vely(i, j)*vely(i, j)+velz(i, j)*&
&       velz(i, j))
! ec  = HALF*( velx(i,j)*velx(i,j) &
!            + vely(i,j)*vely(i,j))
!
      eloc = (w(i, j, 5)-ec*ro)*rom1
!
      tloc(i, j) = eloc*cvm1
!
      p(i, j) = (gam-one)*ro*eloc
!  p(i,j)  = ro*rgaz*tloc(i,j)
      htot = (w(i, j, 5)+p(i, j))*rom1
      f(i, j, 1) = w(i, j, 2)
      f(i, j, 2) = w(i, j, 2)*velx(i, j) + p(i, j)
      f(i, j, 3) = w(i, j, 2)*vely(i, j)
      f(i, j, 4) = w(i, j, 2)*velz(i, j)
      f(i, j, 5) = w(i, j, 2)*htot
      g(i, j, 1) = w(i, j, 3)
      g(i, j, 2) = w(i, j, 3)*velx(i, j)
      g(i, j, 3) = w(i, j, 3)*vely(i, j) + p(i, j)
      g(i, j, 4) = w(i, j, 3)*velz(i, j)
      g(i, j, 5) = w(i, j, 3)*htot
    END DO
  END DO
!$FWD-OF II-LOOP 
!h(i,j,1)  = w(i,j,4)
!h(i,j,2)  = w(i,j,4) * velx(i,j)
!h(i,j,3)  = w(i,j,4) * vely(i,j)
!h(i,j,4)  = w(i,j,4) * velz(i,j) + p(i,j)
!h(i,j,5)  = w(i,j,4) * htot
  DO j=1,jm
!DIR$ IVDEP
    DO i=1,im
      gui = b1*(velx(i+1, j)-velx(i-1, j)) + b2*(velx(i+2, j)-velx(i-2, &
&       j)) + b3*(velx(i+3, j)-velx(i-3, j)) + b4*(velx(i+4, j)-velx(i-4&
&       , j))
      gvi = b1*(vely(i+1, j)-vely(i-1, j)) + b2*(vely(i+2, j)-vely(i-2, &
&       j)) + b3*(vely(i+3, j)-vely(i-3, j)) + b4*(vely(i+4, j)-vely(i-4&
&       , j))
      gwi = b1*(velz(i+1, j)-velz(i-1, j)) + b2*(velz(i+2, j)-velz(i-2, &
&       j)) + b3*(velz(i+3, j)-velz(i-3, j)) + b4*(velz(i+4, j)-velz(i-4&
&       , j))
      guj = b1*(velx(i, j+1)-velx(i, j-1)) + b2*(velx(i, j+2)-velx(i, j-&
&       2)) + b3*(velx(i, j+3)-velx(i, j-3)) + b4*(velx(i, j+4)-velx(i, &
&       j-4))
      gvj = b1*(vely(i, j+1)-vely(i, j-1)) + b2*(vely(i, j+2)-vely(i, j-&
&       2)) + b3*(vely(i, j+3)-vely(i, j-3)) + b4*(vely(i, j+4)-vely(i, &
&       j-4))
      gwj = b1*(velz(i, j+1)-velz(i, j-1)) + b2*(velz(i, j+2)-velz(i, j-&
&       2)) + b3*(velz(i, j+3)-velz(i, j-3)) + b4*(velz(i, j+4)-velz(i, &
&       j-4))
      volm1 = one/vol(i, j)
      dxm1 = half*(nx(i, j, 1)+nx(i+1, j, 1))*volm1
      dxm2 = half*(nx(i, j, 2)+nx(i, j+1, 2))*volm1
      dym1 = half*(ny(i, j, 1)+ny(i+1, j, 1))*volm1
      dym2 = half*(ny(i, j, 2)+ny(i, j+1, 2))*volm1
      gradu(i, j, 1) = dxm1*gui + dxm2*guj
      gradv(i, j, 1) = dxm1*gvi + dxm2*gvj
      gradw(i, j, 1) = dxm1*gwi + dxm2*gwj
      gradu(i, j, 2) = dym1*gui + dym2*guj
      gradv(i, j, 2) = dym1*gvi + dym2*gvj
      gradw(i, j, 2) = dym1*gwi + dym2*gwj
    END DO
  END DO
! trick for ducros in dissipation
  DO i=1,2
    DO h=1,gh
      gradu(:, 1-h, :) = two*gradu(:, 2-h, :) - gradu(:, 3-h, :)
      gradv(:, 1-h, :) = two*gradv(:, 2-h, :) - gradv(:, 3-h, :)
      gradu(:, jm+h, :) = two*gradu(:, jm-1+h, :) - gradu(:, jm-2+h, :)
      gradv(:, jm+h, :) = two*gradv(:, jm-1+h, :) - gradv(:, jm-2+h, :)
      gradu(1-h, :, :) = two*gradu(2-h, :, :) - gradu(3-h, :, :)
      gradv(1-h, :, :) = two*gradv(2-h, :, :) - gradv(3-h, :, :)
      gradu(im+h, :, :) = two*gradu(im-1+h, :, :) - gradu(im-2+h, :, :)
      gradv(im+h, :, :) = two*gradv(im-1+h, :, :) - gradv(im-2+h, :, :)
    END DO
  END DO
  hnb = 0.0_8
!$BWD-OF II-LOOP 
  DO j=1,jm
!$BWD-OF II-LOOP 
!DIR$ IVDEP
    DO i=1,im
      hnb(i, j, 5, 1) = hnb(i, j, 5, 1) + residub(i, j, 5)
      hnb(i+1, j, 5, 1) = hnb(i+1, j, 5, 1) - residub(i, j, 5)
      hnb(i, j, 5, 2) = hnb(i, j, 5, 2) + residub(i, j, 5)
      hnb(i, j+1, 5, 2) = hnb(i, j+1, 5, 2) - residub(i, j, 5)
      residub(i, j, 5) = 0.0_8
      hnb(i, j, 4, 1) = hnb(i, j, 4, 1) + residub(i, j, 4)
      hnb(i+1, j, 4, 1) = hnb(i+1, j, 4, 1) - residub(i, j, 4)
      hnb(i, j, 4, 2) = hnb(i, j, 4, 2) + residub(i, j, 4)
      hnb(i, j+1, 4, 2) = hnb(i, j+1, 4, 2) - residub(i, j, 4)
      residub(i, j, 4) = 0.0_8
      hnb(i, j, 3, 1) = hnb(i, j, 3, 1) + residub(i, j, 3)
      hnb(i+1, j, 3, 1) = hnb(i+1, j, 3, 1) - residub(i, j, 3)
      hnb(i, j, 3, 2) = hnb(i, j, 3, 2) + residub(i, j, 3)
      hnb(i, j+1, 3, 2) = hnb(i, j+1, 3, 2) - residub(i, j, 3)
      residub(i, j, 3) = 0.0_8
      hnb(i, j, 2, 1) = hnb(i, j, 2, 1) + residub(i, j, 2)
      hnb(i+1, j, 2, 1) = hnb(i+1, j, 2, 1) - residub(i, j, 2)
      hnb(i, j, 2, 2) = hnb(i, j, 2, 2) + residub(i, j, 2)
      hnb(i, j+1, 2, 2) = hnb(i, j+1, 2, 2) - residub(i, j, 2)
      residub(i, j, 2) = 0.0_8
      hnb(i, j, 1, 1) = hnb(i, j, 1, 1) + residub(i, j, 1)
      hnb(i+1, j, 1, 1) = hnb(i+1, j, 1, 1) - residub(i, j, 1)
      hnb(i, j, 1, 2) = hnb(i, j, 1, 2) + residub(i, j, 1)
      hnb(i, j+1, 1, 2) = hnb(i, j+1, 1, 2) - residub(i, j, 1)
      residub(i, j, 1) = 0.0_8
    END DO
  END DO
  wb = 0.0_8
  fb = 0.0_8
  gb = 0.0_8
  pb = 0.0_8
  gradub = 0.0_8
  gradvb = 0.0_8
  tlocb = 0.0_8
!$BWD-OF II-LOOP 
  DO j=1,jm+1
!$BWD-OF II-LOOP 
!DIR$ IVDEP
    DO i=1,im+1
!
      predro1 = d4*w(i-4, j, 1) - d3*w(i-3, j, 1) + d2*w(i-2, j, 1) - d1&
&       *w(i-1, j, 1) + d1*w(i, j, 1) - d2*w(i+1, j, 1) + d3*w(i+2, j, 1&
&       ) - d4*w(i+3, j, 1)
      predrou1 = d4*w(i-4, j, 2) - d3*w(i-3, j, 2) + d2*w(i-2, j, 2) - &
&       d1*w(i-1, j, 2) + d1*w(i, j, 2) - d2*w(i+1, j, 2) + d3*w(i+2, j&
&       , 2) - d4*w(i+3, j, 2)
      predrov1 = d4*w(i-4, j, 3) - d3*w(i-3, j, 3) + d2*w(i-2, j, 3) - &
&       d1*w(i-1, j, 3) + d1*w(i, j, 3) - d2*w(i+1, j, 3) + d3*w(i+2, j&
&       , 3) - d4*w(i+3, j, 3)
      predrow1 = d4*w(i-4, j, 4) - d3*w(i-3, j, 4) + d2*w(i-2, j, 4) - &
&       d1*w(i-1, j, 4) + d1*w(i, j, 4) - d2*w(i+1, j, 4) + d3*w(i+2, j&
&       , 4) - d4*w(i+3, j, 4)
      predroe1 = d4*w(i-4, j, 5) - d3*w(i-3, j, 5) + d2*w(i-2, j, 5) - &
&       d1*w(i-1, j, 5) + d1*w(i, j, 5) - d2*w(i+1, j, 5) + d3*w(i+2, j&
&       , 5) - d4*w(i+3, j, 5)
      predro2 = d4*w(i, j-4, 1) - d3*w(i, j-3, 1) + d2*w(i, j-2, 1) - d1&
&       *w(i, j-1, 1) + d1*w(i, j, 1) - d2*w(i, j+1, 1) + d3*w(i, j+2, 1&
&       ) - d4*w(i, j+3, 1)
      predrou2 = d4*w(i, j-4, 2) - d3*w(i, j-3, 2) + d2*w(i, j-2, 2) - &
&       d1*w(i, j-1, 2) + d1*w(i, j, 2) - d2*w(i, j+1, 2) + d3*w(i, j+2&
&       , 2) - d4*w(i, j+3, 2)
      predrov2 = d4*w(i, j-4, 3) - d3*w(i, j-3, 3) + d2*w(i, j-2, 3) - &
&       d1*w(i, j-1, 3) + d1*w(i, j, 3) - d2*w(i, j+1, 3) + d3*w(i, j+2&
&       , 3) - d4*w(i, j+3, 3)
      predrow2 = d4*w(i, j-4, 4) - d3*w(i, j-3, 4) + d2*w(i, j-2, 4) - &
&       d1*w(i, j-1, 4) + d1*w(i, j, 4) - d2*w(i, j+1, 4) + d3*w(i, j+2&
&       , 4) - d4*w(i, j+3, 4)
      predroe2 = d4*w(i, j-4, 5) - d3*w(i, j-3, 5) + d2*w(i, j-2, 5) - &
&       d1*w(i, j-1, 5) + d1*w(i, j, 5) - d2*w(i, j+1, 5) + d3*w(i, j+2&
&       , 5) - d4*w(i, j+3, 5)
! #include "rhs/spectralradius_i.F"
! correction Rossow JCP 2000
!1st direction
      rhomr = w(i, j, 1)
      ur = w(i, j, 2)/rhomr
      vr = w(i, j, 3)/rhomr
      c2r = gam*rgaz*tloc(i, j)
!
      rhoml = w(i-1, j, 1)
      ul = w(i-1, j, 2)/rhoml
      vl = w(i-1, j, 3)/rhoml
      c2l = gam*rgaz*tloc(i-1, j)
!
      r = SQRT(rhomr/rhoml)
      rr = one/(one+r)
      omrr = one - rr
!
      u = ul*rr + ur*omrr
      v = vl*rr + vr*omrr
!
      c2x = c2l*rr + c2r*omrr
      vn2 = u*u + v*v
      IF (vn2/c2x .GT. one) THEN
        ad_branch = 0
        mach2 = one
      ELSE
        mach2 = vn2/c2x
        ad_branch = 1
      END IF
      alpha = half*(one-mach2)
      cprim = alpha*alpha*vn2 + mach2*c2x
      nx2 = nx(i, j, 1)*nx(i, j, 1) + ny(i, j, 1)*ny(i, j, 1)
      x1 = nx(i, j, 1)*u + ny(i, j, 1)*v
      IF (x1 .GE. 0.) THEN
        ab = x1
        ad_branch0 = 0
      ELSE
        ab = -x1
        ad_branch0 = 1
      END IF
      sq = SQRT(cprim*nx2)
!
      rspec = ab + sq
      IF (p(i-1, j) - two*p(i, j) + p(i+1, j) .GE. 0.) THEN
        abs0 = p(i-1, j) - two*p(i, j) + p(i+1, j)
        ad_branch1 = 1
      ELSE
        abs0 = -(p(i-1, j)-two*p(i, j)+p(i+1, j))
        ad_branch1 = 0
      END IF
      x3 = p(i-1, j) + two*p(i, j) + p(i+1, j)
      IF (x3 .GE. 0.) THEN
        abs4 = x3
        ad_branch2 = 0
      ELSE
        abs4 = -x3
        ad_branch2 = 1
      END IF
!
!1st direction
      k_sensor1 = abs0/abs4
      IF (p(i-2, j) - two*p(i-1, j) + p(i, j) .GE. 0.) THEN
        abs1 = p(i-2, j) - two*p(i-1, j) + p(i, j)
        ad_branch3 = 1
      ELSE
        abs1 = -(p(i-2, j)-two*p(i-1, j)+p(i, j))
        ad_branch3 = 0
      END IF
      x4 = p(i-2, j) + two*p(i-1, j) + p(i, j)
      IF (x4 .GE. 0.) THEN
        abs5 = x4
        ad_branch4 = 0
      ELSE
        abs5 = -x4
        ad_branch4 = 1
      END IF
      k_sensor2 = abs1/abs5
      divu = gradu(i, j, 1) + gradv(i, j, 2)
      divu2 = divu*divu
      vort2 = (gradv(i, j, 1)-gradu(i, j, 2))*(gradv(i, j, 1)-gradu(i, j&
&       , 2))
      ducros1 = divu2/(divu2+vort2+1d-15)
      dxm1 = half*(one-TANH(2.5d0+10.d0*vol(i, j)/(sq+1d-15)*divu))
      divu = gradu(i-1, j, 1) + gradv(i-1, j, 2)
      ad_save = divu2
      divu2 = divu*divu
      vort2 = (gradv(i-1, j, 1)-gradu(i-1, j, 2))*(gradv(i-1, j, 1)-&
&       gradu(i-1, j, 2))
      ducros2 = divu2/(divu2+vort2+1d-15)
      dxm2 = half*(one-TANH(2.5d0+10.d0*vol(i, j)/(sq+1d-15)*divu))
      IF (k_sensor1*ducros1*dxm1 .LT. k_sensor2*ducros2*dxm2) THEN
        coef = k_sensor2*ducros2*dxm2
        ad_branch5 = 0
      ELSE
        coef = k_sensor1*ducros1*dxm1
        ad_branch5 = 1
      END IF
!     ! extension of shock capturing
!
!    k_sensor1 = ABS(p(i,j) - TWO*p(i+1,j) + p(i+2,j)) / &
!                ABS(p(i,j) + TWO*p(i+1,j) + p(i+2,j))
!
!    k_sensor2 = ABS(p(i-3,j) - TWO*p(i-2,j) + p(i-1,j)) / &
!                ABS(p(i-3,j) + TWO*p(i-2,j) + p(i-1,j))
!
!    divu2     = (gradu(i+1,j,1)+gradv(i+1,j,2)) * (gradu(i+1,j,1)+gradv(i+1,j,2))
!    vort2     = (gradv(i+1,j,1)-gradu(i+1,j,2)) * (gradv(i+1,j,1)-gradu(i+1,j,2))
!    ducros1   = divu2/(divu2+vort2+1d-15)
!
!    divu2     = (gradu(i-2,j,1)+gradv(i-2,j,2)) * (gradu(i-2,j,1)+gradv(i-2,j,2))
!    vort2     = (gradv(i-2,j,1)-gradu(i-2,j,2)) * (gradv(i-2,j,1)-gradu(i-2,j,2))
!    ducros2   = divu2/(divu2+vort2+1d-15)
!
!    coef      = MAX( k_sensor1*ducros1, &
!                      k_sensor2*ducros2, coef)
!
      eps2 = k2*coef
      IF (zero .LT. k4 - 12.d0*eps2) THEN
        eps4 = k4 - 12.d0*eps2
        ad_branch6 = 0
      ELSE
        ad_branch6 = 1
        eps4 = zero
      END IF
!
!
!     if (eps4.gt.1.d-12) then
! #include "rhs/wiggle_diri.F"
!     endif
! #include "rhs/spectralradius_j.F"
! correction Rossow JCP 2000
!2st direction
      rhomr = w(i, j, 1)
      ad_save0 = ur
      ur = w(i, j, 2)/rhomr
      ad_save1 = vr
      vr = w(i, j, 3)/rhomr
      c2r = gam*rgaz*tloc(i, j)
!
      rhoml = w(i, j-1, 1)
      ul = w(i, j-1, 2)/rhoml
      vl = w(i, j-1, 3)/rhoml
      c2l = gam*rgaz*tloc(i, j-1)
!
      ad_save2 = r
      r = SQRT(rhomr/rhoml)
      rr = one/(one+r)
      omrr = one - rr
!
      ad_save3 = u
      u = ul*rr + ur*omrr
      ad_save4 = v
      v = vl*rr + vr*omrr
!
      c2x = c2l*rr + c2r*omrr
      nx2 = nx(i, j, 2)*nx(i, j, 2) + ny(i, j, 2)*ny(i, j, 2)
      vn2 = u*u + v*v
      IF (vn2/c2x .GT. one) THEN
        ad_save5 = mach2
        mach2 = one
        ad_branch7 = 0
      ELSE
        ad_save6 = mach2
        mach2 = vn2/c2x
        ad_branch7 = 1
      END IF
      ad_save7 = alpha
      alpha = half*(one-mach2)
      cprim = alpha*alpha*vn2 + mach2*c2x
      x2 = nx(i, j, 2)*u + ny(i, j, 2)*v
      IF (x2 .GE. 0.) THEN
        ab = x2
        ad_branch8 = 0
      ELSE
        ab = -x2
        ad_branch8 = 1
      END IF
      ad_save8 = sq
      sq = SQRT(cprim*nx2)
!
      ad_save9 = rspec
      rspec = ab + sq
      IF (p(i, j-1) - two*p(i, j) + p(i, j+1) .GE. 0.) THEN
        abs2 = p(i, j-1) - two*p(i, j) + p(i, j+1)
        ad_branch9 = 1
      ELSE
        abs2 = -(p(i, j-1)-two*p(i, j)+p(i, j+1))
        ad_branch9 = 0
      END IF
      x5 = p(i, j-1) + two*p(i, j) + p(i, j+1)
      IF (x5 .GE. 0.) THEN
        abs6 = x5
        ad_branch10 = 0
      ELSE
        abs6 = -x5
        ad_branch10 = 1
      END IF
!
! 2nd direction
      k_sensor1 = abs2/abs6
      IF (p(i, j-2) - two*p(i, j-1) + p(i, j) .GE. 0.) THEN
        abs3 = p(i, j-2) - two*p(i, j-1) + p(i, j)
        ad_branch11 = 1
      ELSE
        abs3 = -(p(i, j-2)-two*p(i, j-1)+p(i, j))
        ad_branch11 = 0
      END IF
      x6 = p(i, j-2) + two*p(i, j-1) + p(i, j)
      IF (x6 .GE. 0.) THEN
        abs7 = x6
        ad_branch12 = 0
      ELSE
        abs7 = -x6
        ad_branch12 = 1
      END IF
      k_sensor2 = abs3/abs7
!     ducros1 is done in dissipation_ducros_x
      divu = gradu(i, j-1, 1) + gradv(i, j-1, 2)
      divu2 = divu*divu
      ad_save10 = vort2
      vort2 = (gradv(i, j-1, 1)-gradu(i, j-1, 2))*(gradv(i, j-1, 1)-&
&       gradu(i, j-1, 2))
      ducros2 = divu2/(divu2+vort2+1d-15)
!sq = sound/dx
      ad_save11 = dxm2
      dxm2 = half*(one-TANH(2.5d0+10.d0*vol(i, j)/(sq+1d-15)*divu))
      IF (k_sensor1*ducros1*dxm1 .LT. k_sensor2*ducros2*dxm2) THEN
        coef = k_sensor2*ducros2*dxm2
        ad_branch13 = 0
      ELSE
        coef = k_sensor1*ducros1*dxm1
        ad_branch13 = 1
      END IF
! extension of shock capturing
!    k_sensor1 = ABS(p(i,j) - TWO*p(i,j+1) + p(i,j+2)) / &
!                ABS(p(i,j) + TWO*p(i,j+1) + p(i,j+2))
!
!    k_sensor2 = ABS(p(i,j-3) - TWO*p(i,j-2) + p(i,j-1)) / &
!                ABS(p(i,j-3) + TWO*p(i,j-2) + p(i,j-1))
!
!    divu2     = (gradu(i,j+1,1)+gradv(i,j+1,2)) * (gradu(i,j+1,1)+gradv(i,j+1,2))
!    vort2     = (gradv(i,j+1,1)-gradu(i,j+1,2)) * (gradv(i,j+1,1)-gradu(i,j+1,2))
!    ducros1   = divu2/(divu2+vort2+1d-15)
!
!    divu2     = (gradu(i,j-2,1)+gradv(i,j-2,2)) * (gradu(i,j-2,1)+gradv(i,j-2,2))
!    vort2     = (gradv(i,j-2,1)-gradu(i,j-2,2)) * (gradv(i,j-2,1)-gradu(i,j-2,2))
!    ducros2   = divu2/(divu2+vort2+1d-15)
!
!    coef      = MAX( k_sensor1*ducros1, &
!                     k_sensor2*ducros2, coef)
      ad_save12 = eps2
      eps2 = k2*coef
      IF (zero .LT. k4 - 12.d0*eps2) THEN
        ad_save13 = eps4
        eps4 = k4 - 12.d0*eps2
        ad_branch14 = 0
      ELSE
        ad_save14 = eps4
        eps4 = zero
        ad_branch14 = 1
      END IF
      diffro = half*(w(i, j, 1)-w(i, j-1, 1))
      diffrou = half*(w(i, j, 2)-w(i, j-1, 2))
      diffrov = half*(w(i, j, 3)-w(i, j-1, 3))
      diffrow = half*(w(i, j, 4)-w(i, j-1, 4))
      diffroe = half*(w(i, j, 5)-w(i, j-1, 5))
!
!
!     if (eps4.gt.1.d-12) then
! #include "rhs/wiggle_dirj.F"
!     endif
!
      fxroe2b = hnb(i, j, 5, 2)
      dissroe2b = -hnb(i, j, 5, 2)
      hnb(i, j, 5, 2) = 0.0_8
      fxrow2b = hnb(i, j, 4, 2)
      dissrow2b = -hnb(i, j, 4, 2)
      hnb(i, j, 4, 2) = 0.0_8
      fxrov2b = hnb(i, j, 3, 2)
      dissrov2b = -hnb(i, j, 3, 2)
      hnb(i, j, 3, 2) = 0.0_8
      fxrou2b = hnb(i, j, 2, 2)
      dissrou2b = -hnb(i, j, 2, 2)
      hnb(i, j, 2, 2) = 0.0_8
      fxro2b = hnb(i, j, 1, 2)
      dissro2b = -hnb(i, j, 1, 2)
      hnb(i, j, 1, 2) = 0.0_8
      fxroe1b = hnb(i, j, 5, 1)
      dissroe1b = -hnb(i, j, 5, 1)
      hnb(i, j, 5, 1) = 0.0_8
      fxrow1b = hnb(i, j, 4, 1)
      dissrow1b = -hnb(i, j, 4, 1)
      hnb(i, j, 4, 1) = 0.0_8
      fxrov1b = hnb(i, j, 3, 1)
      dissrov1b = -hnb(i, j, 3, 1)
      hnb(i, j, 3, 1) = 0.0_8
      fxrou1b = hnb(i, j, 2, 1)
      dissrou1b = -hnb(i, j, 2, 1)
      hnb(i, j, 2, 1) = 0.0_8
      fxro1b = hnb(i, j, 1, 1)
      dissro1b = -hnb(i, j, 1, 1)
      hnb(i, j, 1, 1) = 0.0_8
      rspecb = (eps2*diffroe+eps4*predroe2)*dissroe2b + (eps2*diffrow+&
&       eps4*predrow2)*dissrow2b + (eps2*diffrov+eps4*predrov2)*&
&       dissrov2b + (eps2*diffrou+eps4*predrou2)*dissrou2b + (eps2*&
&       diffro+eps4*predro2)*dissro2b
      tempb0 = rspec*dissroe2b
      eps2b = diffroe*tempb0
      diffroeb = eps2*tempb0
      eps4b = predroe2*tempb0
      predroe2b = eps4*tempb0
      tempb0 = rspec*dissrow2b
      eps2b = eps2b + diffrow*tempb0
      diffrowb = eps2*tempb0
      eps4b = eps4b + predrow2*tempb0
      predrow2b = eps4*tempb0
      tempb0 = rspec*dissrov2b
      eps2b = eps2b + diffrov*tempb0
      diffrovb = eps2*tempb0
      eps4b = eps4b + predrov2*tempb0
      predrov2b = eps4*tempb0
      tempb0 = rspec*dissrou2b
      eps2b = eps2b + diffrou*tempb0
      diffroub = eps2*tempb0
      eps4b = eps4b + predrou2*tempb0
      predrou2b = eps4*tempb0
      tempb0 = rspec*dissro2b
      eps2b = eps2b + diffro*tempb0
      diffrob = eps2*tempb0
      eps4b = eps4b + predro2*tempb0
      predro2b = eps4*tempb0
      wb(i, j, 5) = wb(i, j, 5) + half*diffroeb
      wb(i, j-1, 5) = wb(i, j-1, 5) - half*diffroeb
      wb(i, j, 4) = wb(i, j, 4) + half*diffrowb
      wb(i, j-1, 4) = wb(i, j-1, 4) - half*diffrowb
      wb(i, j, 3) = wb(i, j, 3) + half*diffrovb
      wb(i, j-1, 3) = wb(i, j-1, 3) - half*diffrovb
      wb(i, j, 2) = wb(i, j, 2) + half*diffroub
      wb(i, j-1, 2) = wb(i, j-1, 2) - half*diffroub
      wb(i, j, 1) = wb(i, j, 1) + half*diffrob
      wb(i, j-1, 1) = wb(i, j-1, 1) - half*diffrob
      IF (ad_branch14 .EQ. 0) THEN
        eps4 = ad_save13
        eps2b = eps2b - 12.d0*eps4b
      ELSE
        eps4 = ad_save14
      END IF
      eps2 = ad_save12
      coefb = k2*eps2b
      IF (ad_branch13 .EQ. 0) THEN
        k_sensor2b = ducros2*dxm2*coefb
        ducros2b = k_sensor2*dxm2*coefb
        dxm2b = k_sensor2*ducros2*coefb
        dxm1b = 0.0_8
        k_sensor1b = 0.0_8
        ducros1b = 0.0_8
      ELSE
        k_sensor1b = ducros1*dxm1*coefb
        ducros1b = k_sensor1*dxm1*coefb
        dxm1b = k_sensor1*ducros1*coefb
        dxm2b = 0.0_8
        k_sensor2b = 0.0_8
        ducros2b = 0.0_8
      END IF
      dxm2 = ad_save11
      temp0 = divu/(sq+1d-15)
      temp = 10.d0*vol(i, j)
      tempb0 = -(temp*(1.0-TANH(temp*temp0+2.5d0)**2)*half*dxm2b/(sq+&
&       1d-15))
      divub = tempb0
      sqb = -(temp0*tempb0)
      tempb0 = ducros2b/(divu2+vort2+1d-15)
      tempb = -(divu2*tempb0/(divu2+vort2+1d-15))
      divu2b = tempb0 + tempb
      vort2b = tempb
      vort2 = ad_save10
      tempb0 = 2*(gradv(i, j-1, 1)-gradu(i, j-1, 2))*vort2b
      gradvb(i, j-1, 1) = gradvb(i, j-1, 1) + tempb0
      gradub(i, j-1, 2) = gradub(i, j-1, 2) - tempb0
      divub = divub + 2*divu*divu2b
      gradub(i, j-1, 1) = gradub(i, j-1, 1) + divub
      gradvb(i, j-1, 2) = gradvb(i, j-1, 2) + divub
      abs3b = k_sensor2b/abs7
      abs7b = -(abs3*k_sensor2b/abs7**2)
      IF (ad_branch12 .EQ. 0) THEN
        x6b = abs7b
      ELSE
        x6b = -abs7b
      END IF
      pb(i, j-2) = pb(i, j-2) + x6b
      pb(i, j-1) = pb(i, j-1) + two*x6b
      pb(i, j) = pb(i, j) + x6b
      IF (ad_branch11 .EQ. 0) THEN
        pb(i, j-1) = pb(i, j-1) + two*abs3b
        pb(i, j-2) = pb(i, j-2) - abs3b
        pb(i, j) = pb(i, j) - abs3b
      ELSE
        pb(i, j-2) = pb(i, j-2) + abs3b
        pb(i, j-1) = pb(i, j-1) - two*abs3b
        pb(i, j) = pb(i, j) + abs3b
      END IF
      abs2b = k_sensor1b/abs6
      abs6b = -(abs2*k_sensor1b/abs6**2)
      IF (ad_branch10 .EQ. 0) THEN
        x5b = abs6b
      ELSE
        x5b = -abs6b
      END IF
      pb(i, j-1) = pb(i, j-1) + x5b
      pb(i, j) = pb(i, j) + two*x5b
      pb(i, j+1) = pb(i, j+1) + x5b
      IF (ad_branch9 .EQ. 0) THEN
        pb(i, j) = pb(i, j) + two*abs2b
        pb(i, j-1) = pb(i, j-1) - abs2b
        pb(i, j+1) = pb(i, j+1) - abs2b
      ELSE
        pb(i, j-1) = pb(i, j-1) + abs2b
        pb(i, j) = pb(i, j) - two*abs2b
        pb(i, j+1) = pb(i, j+1) + abs2b
      END IF
      rspec = ad_save9
      abb = rspecb
      sqb = sqb + rspecb
      sq = ad_save8
      IF (nx2*cprim .EQ. 0.0) THEN
        cprimb = 0.0_8
      ELSE
        cprimb = nx2*sqb/(2.0*SQRT(nx2*cprim))
      END IF
      IF (ad_branch8 .EQ. 0) THEN
        x2b = abb
      ELSE
        x2b = -abb
      END IF
      ub = nx(i, j, 2)*x2b
      vb = ny(i, j, 2)*x2b
      alphab = 2*alpha*vn2*cprimb
      vn2b = alpha**2*cprimb
      mach2b = c2x*cprimb - half*alphab
      c2xb = mach2*cprimb
      alpha = ad_save7
      IF (ad_branch7 .EQ. 0) THEN
        mach2 = ad_save5
      ELSE
        mach2 = ad_save6
        vn2b = vn2b + mach2b/c2x
        c2xb = c2xb - vn2*mach2b/c2x**2
      END IF
      diffro = half*(w(i, j, 1)-w(i-1, j, 1))
      diffrou = half*(w(i, j, 2)-w(i-1, j, 2))
      diffrov = half*(w(i, j, 3)-w(i-1, j, 3))
      diffrow = half*(w(i, j, 4)-w(i-1, j, 4))
      ub = ub + 2*u*vn2b
      vb = vb + 2*v*vn2b
      c2lb = rr*c2xb
      c2rb = omrr*c2xb
      omrrb = c2r*c2xb + vr*vb + ur*ub
      rrb = c2l*c2xb + vl*vb + ul*ub - omrrb
      v = ad_save4
      vlb = rr*vb
      vrb = omrr*vb
      u = ad_save3
      ulb = rr*ub
      urb = omrr*ub
      rb = -(one*rrb/(one+r)**2)
      r = ad_save2
      IF (rhomr/rhoml .EQ. 0.0) THEN
        tempb0 = 0.0_8
      ELSE
        tempb0 = rb/(rhoml*2.0*SQRT(rhomr/rhoml))
      END IF
      rhomrb = tempb0 - w(i, j, 3)*vrb/rhomr**2 - w(i, j, 2)*urb/rhomr**&
&       2
      rhomlb = -(rhomr*tempb0/rhoml) - w(i, j-1, 3)*vlb/rhoml**2 - w(i, &
&       j-1, 2)*ulb/rhoml**2
      tlocb(i, j-1) = tlocb(i, j-1) + gam*rgaz*c2lb
      wb(i, j-1, 3) = wb(i, j-1, 3) + vlb/rhoml
      wb(i, j-1, 2) = wb(i, j-1, 2) + ulb/rhoml
      wb(i, j-1, 1) = wb(i, j-1, 1) + rhomlb
      tlocb(i, j) = tlocb(i, j) + gam*rgaz*c2rb
      rhoml = w(i-1, j, 1)
      rr = one/(one+r)
      vl = w(i-1, j, 3)/rhoml
      omrr = one - rr
      vr = ad_save1
      ul = w(i-1, j, 2)/rhoml
      ur = ad_save0
      diffroe = half*(w(i, j, 5)-w(i-1, j, 5))
      rspecb = (eps2*diffroe+eps4*predroe1)*dissroe1b + (eps2*diffrow+&
&       eps4*predrow1)*dissrow1b + (eps2*diffrov+eps4*predrov1)*&
&       dissrov1b + (eps2*diffrou+eps4*predrou1)*dissrou1b + (eps2*&
&       diffro+eps4*predro1)*dissro1b
      tempb0 = rspec*dissroe1b
      eps2b = diffroe*tempb0
      diffroeb = eps2*tempb0
      eps4b = predroe1*tempb0
      predroe1b = eps4*tempb0
      tempb0 = rspec*dissrow1b
      eps2b = eps2b + diffrow*tempb0
      diffrowb = eps2*tempb0
      eps4b = eps4b + predrow1*tempb0
      predrow1b = eps4*tempb0
      tempb0 = rspec*dissrov1b
      eps2b = eps2b + diffrov*tempb0
      diffrovb = eps2*tempb0
      wb(i, j, 3) = wb(i, j, 3) + vrb/rhomr + half*diffrovb
      eps4b = eps4b + predrov1*tempb0
      predrov1b = eps4*tempb0
      tempb0 = rspec*dissrou1b
      eps2b = eps2b + diffrou*tempb0
      diffroub = eps2*tempb0
      wb(i, j, 2) = wb(i, j, 2) + urb/rhomr + half*diffroub
      rhomr = w(i, j, 1)
      eps4b = eps4b + predrou1*tempb0
      predrou1b = eps4*tempb0
      tempb0 = rspec*dissro1b
      eps2b = eps2b + diffro*tempb0
      diffrob = eps2*tempb0
      wb(i, j, 1) = wb(i, j, 1) + rhomrb + half*diffrob
      eps4b = eps4b + predro1*tempb0
      predro1b = eps4*tempb0
      wb(i, j, 5) = wb(i, j, 5) + half*diffroeb
      wb(i-1, j, 5) = wb(i-1, j, 5) - half*diffroeb
      wb(i, j, 4) = wb(i, j, 4) + half*diffrowb
      wb(i-1, j, 4) = wb(i-1, j, 4) - half*diffrowb
      wb(i-1, j, 3) = wb(i-1, j, 3) - half*diffrovb
      wb(i-1, j, 2) = wb(i-1, j, 2) - half*diffroub
      wb(i-1, j, 1) = wb(i-1, j, 1) - half*diffrob
      IF (ad_branch6 .EQ. 0) eps2b = eps2b - 12.d0*eps4b
      coefb = k2*eps2b
      divu = gradu(i-1, j, 1) + gradv(i-1, j, 2)
      divu2 = divu*divu
      k_sensor1 = abs0/abs4
      k_sensor2 = abs1/abs5
      ducros2 = divu2/(divu2+vort2+1d-15)
      IF (ad_branch5 .EQ. 0) THEN
        k_sensor2b = ducros2*dxm2*coefb
        ducros2b = k_sensor2*dxm2*coefb
        dxm2b = k_sensor2*ducros2*coefb
        k_sensor1b = 0.0_8
      ELSE
        k_sensor1b = ducros1*dxm1*coefb
        ducros1b = ducros1b + k_sensor1*dxm1*coefb
        dxm1b = dxm1b + k_sensor1*ducros1*coefb
        dxm2b = 0.0_8
        k_sensor2b = 0.0_8
        ducros2b = 0.0_8
      END IF
      temp0 = divu/(sq+1d-15)
      temp = 10.d0*vol(i, j)
      tempb0 = -(temp*(1.0-TANH(temp*temp0+2.5d0)**2)*half*dxm2b/(sq+&
&       1d-15))
      divub = tempb0
      sqb = -(temp0*tempb0)
      tempb0 = ducros2b/(divu2+vort2+1d-15)
      tempb = -(divu2*tempb0/(divu2+vort2+1d-15))
      divu2b = tempb0 + tempb
      vort2b = tempb
      tempb0 = 2*(gradv(i-1, j, 1)-gradu(i-1, j, 2))*vort2b
      gradvb(i-1, j, 1) = gradvb(i-1, j, 1) + tempb0
      gradub(i-1, j, 2) = gradub(i-1, j, 2) - tempb0
      vort2 = (gradv(i, j, 1)-gradu(i, j, 2))*(gradv(i, j, 1)-gradu(i, j&
&       , 2))
      divu2 = ad_save
      divub = divub + 2*divu*divu2b
      gradub(i-1, j, 1) = gradub(i-1, j, 1) + divub
      gradvb(i-1, j, 2) = gradvb(i-1, j, 2) + divub
      divu = gradu(i, j, 1) + gradv(i, j, 2)
      temp0 = divu/(sq+1d-15)
      temp = 10.d0*vol(i, j)
      tempb0 = -(temp*(1.0-TANH(temp*temp0+2.5d0)**2)*half*dxm1b/(sq+&
&       1d-15))
      divub = tempb0
      sqb = sqb - temp0*tempb0
      tempb0 = ducros1b/(divu2+vort2+1d-15)
      tempb = -(divu2*tempb0/(divu2+vort2+1d-15))
      divu2b = tempb0 + tempb
      vort2b = tempb
      tempb0 = 2*(gradv(i, j, 1)-gradu(i, j, 2))*vort2b
      gradvb(i, j, 1) = gradvb(i, j, 1) + tempb0
      gradub(i, j, 2) = gradub(i, j, 2) - tempb0
      divub = divub + 2*divu*divu2b
      gradub(i, j, 1) = gradub(i, j, 1) + divub
      gradvb(i, j, 2) = gradvb(i, j, 2) + divub
      abs1b = k_sensor2b/abs5
      abs5b = -(abs1*k_sensor2b/abs5**2)
      IF (ad_branch4 .EQ. 0) THEN
        x4b = abs5b
      ELSE
        x4b = -abs5b
      END IF
      pb(i-2, j) = pb(i-2, j) + x4b
      pb(i-1, j) = pb(i-1, j) + two*x4b
      pb(i, j) = pb(i, j) + x4b
      IF (ad_branch3 .EQ. 0) THEN
        pb(i-1, j) = pb(i-1, j) + two*abs1b
        pb(i-2, j) = pb(i-2, j) - abs1b
        pb(i, j) = pb(i, j) - abs1b
      ELSE
        pb(i-2, j) = pb(i-2, j) + abs1b
        pb(i-1, j) = pb(i-1, j) - two*abs1b
        pb(i, j) = pb(i, j) + abs1b
      END IF
      abs0b = k_sensor1b/abs4
      abs4b = -(abs0*k_sensor1b/abs4**2)
      IF (ad_branch2 .EQ. 0) THEN
        x3b = abs4b
      ELSE
        x3b = -abs4b
      END IF
      pb(i-1, j) = pb(i-1, j) + x3b
      pb(i, j) = pb(i, j) + two*x3b
      pb(i+1, j) = pb(i+1, j) + x3b
      IF (ad_branch1 .EQ. 0) THEN
        pb(i, j) = pb(i, j) + two*abs0b
        pb(i-1, j) = pb(i-1, j) - abs0b
        pb(i+1, j) = pb(i+1, j) - abs0b
      ELSE
        pb(i-1, j) = pb(i-1, j) + abs0b
        pb(i, j) = pb(i, j) - two*abs0b
        pb(i+1, j) = pb(i+1, j) + abs0b
      END IF
      abb = rspecb
      sqb = sqb + rspecb
      c2r = gam*rgaz*tloc(i, j)
      c2l = gam*rgaz*tloc(i-1, j)
      c2x = c2l*rr + c2r*omrr
      vn2 = u*u + v*v
      nx2 = nx(i, j, 1)*nx(i, j, 1) + ny(i, j, 1)*ny(i, j, 1)
      cprim = alpha*alpha*vn2 + mach2*c2x
      IF (nx2*cprim .EQ. 0.0) THEN
        cprimb = 0.0_8
      ELSE
        cprimb = nx2*sqb/(2.0*SQRT(nx2*cprim))
      END IF
      IF (ad_branch0 .EQ. 0) THEN
        x1b = abb
      ELSE
        x1b = -abb
      END IF
      ub = nx(i, j, 1)*x1b
      vb = ny(i, j, 1)*x1b
      alphab = 2*alpha*vn2*cprimb
      vn2b = alpha**2*cprimb
      mach2b = c2x*cprimb - half*alphab
      c2xb = mach2*cprimb
      IF (ad_branch .NE. 0) THEN
        vn2b = vn2b + mach2b/c2x
        c2xb = c2xb - vn2*mach2b/c2x**2
      END IF
      ub = ub + 2*u*vn2b
      vb = vb + 2*v*vn2b
      c2lb = rr*c2xb
      c2rb = omrr*c2xb
      omrrb = c2r*c2xb + vr*vb + ur*ub
      rrb = c2l*c2xb + vl*vb + ul*ub - omrrb
      vlb = rr*vb
      vrb = omrr*vb
      ulb = rr*ub
      urb = omrr*ub
      rb = -(one*rrb/(one+r)**2)
      IF (rhomr/rhoml .EQ. 0.0) THEN
        tempb0 = 0.0_8
      ELSE
        tempb0 = rb/(rhoml*2.0*SQRT(rhomr/rhoml))
      END IF
      rhomrb = tempb0 - w(i, j, 3)*vrb/rhomr**2 - w(i, j, 2)*urb/rhomr**&
&       2
      rhomlb = -(rhomr*tempb0/rhoml) - w(i-1, j, 3)*vlb/rhoml**2 - w(i-1&
&       , j, 2)*ulb/rhoml**2
      tlocb(i-1, j) = tlocb(i-1, j) + gam*rgaz*c2lb
      wb(i-1, j, 3) = wb(i-1, j, 3) + vlb/rhoml - d1*predrov1b
      wb(i-1, j, 2) = wb(i-1, j, 2) + ulb/rhoml - d1*predrou1b
      wb(i-1, j, 1) = wb(i-1, j, 1) + rhomlb - d1*predro1b
      tlocb(i, j) = tlocb(i, j) + gam*rgaz*c2rb
      wb(i, j, 3) = wb(i, j, 3) + vrb/rhomr + d1*predrov2b + d1*&
&       predrov1b
      wb(i, j, 2) = wb(i, j, 2) + urb/rhomr + d1*predrou2b + d1*&
&       predrou1b
      wb(i, j, 1) = wb(i, j, 1) + rhomrb + d1*predro2b + d1*predro1b
      wb(i, j-4, 5) = wb(i, j-4, 5) + d4*predroe2b
      wb(i, j-3, 5) = wb(i, j-3, 5) - d3*predroe2b
      wb(i, j-2, 5) = wb(i, j-2, 5) + d2*predroe2b
      wb(i, j-1, 5) = wb(i, j-1, 5) - d1*predroe2b
      wb(i, j, 5) = wb(i, j, 5) + d1*predroe2b + d1*predroe1b
      wb(i, j+1, 5) = wb(i, j+1, 5) - d2*predroe2b
      wb(i, j+2, 5) = wb(i, j+2, 5) + d3*predroe2b
      wb(i, j+3, 5) = wb(i, j+3, 5) - d4*predroe2b
      wb(i, j-4, 4) = wb(i, j-4, 4) + d4*predrow2b
      wb(i, j-3, 4) = wb(i, j-3, 4) - d3*predrow2b
      wb(i, j-2, 4) = wb(i, j-2, 4) + d2*predrow2b
      wb(i, j-1, 4) = wb(i, j-1, 4) - d1*predrow2b
      wb(i, j, 4) = wb(i, j, 4) + d1*predrow2b + d1*predrow1b
      wb(i, j+1, 4) = wb(i, j+1, 4) - d2*predrow2b
      wb(i, j+2, 4) = wb(i, j+2, 4) + d3*predrow2b
      wb(i, j+3, 4) = wb(i, j+3, 4) - d4*predrow2b
      wb(i, j-4, 3) = wb(i, j-4, 3) + d4*predrov2b
      wb(i, j-3, 3) = wb(i, j-3, 3) - d3*predrov2b
      wb(i, j-2, 3) = wb(i, j-2, 3) + d2*predrov2b
      wb(i, j-1, 3) = wb(i, j-1, 3) - d1*predrov2b
      wb(i, j+1, 3) = wb(i, j+1, 3) - d2*predrov2b
      wb(i, j+2, 3) = wb(i, j+2, 3) + d3*predrov2b
      wb(i, j+3, 3) = wb(i, j+3, 3) - d4*predrov2b
      wb(i, j-4, 2) = wb(i, j-4, 2) + d4*predrou2b
      wb(i, j-3, 2) = wb(i, j-3, 2) - d3*predrou2b
      wb(i, j-2, 2) = wb(i, j-2, 2) + d2*predrou2b
      wb(i, j-1, 2) = wb(i, j-1, 2) - d1*predrou2b
      wb(i, j+1, 2) = wb(i, j+1, 2) - d2*predrou2b
      wb(i, j+2, 2) = wb(i, j+2, 2) + d3*predrou2b
      wb(i, j+3, 2) = wb(i, j+3, 2) - d4*predrou2b
      wb(i, j-4, 1) = wb(i, j-4, 1) + d4*predro2b
      wb(i, j-3, 1) = wb(i, j-3, 1) - d3*predro2b
      wb(i, j-2, 1) = wb(i, j-2, 1) + d2*predro2b
      wb(i, j-1, 1) = wb(i, j-1, 1) - d1*predro2b
      wb(i, j+1, 1) = wb(i, j+1, 1) - d2*predro2b
      wb(i, j+2, 1) = wb(i, j+2, 1) + d3*predro2b
      wb(i, j+3, 1) = wb(i, j+3, 1) - d4*predro2b
      wb(i-4, j, 5) = wb(i-4, j, 5) + d4*predroe1b
      wb(i-3, j, 5) = wb(i-3, j, 5) - d3*predroe1b
      wb(i-2, j, 5) = wb(i-2, j, 5) + d2*predroe1b
      wb(i-1, j, 5) = wb(i-1, j, 5) - d1*predroe1b
      wb(i+1, j, 5) = wb(i+1, j, 5) - d2*predroe1b
      wb(i+2, j, 5) = wb(i+2, j, 5) + d3*predroe1b
      wb(i+3, j, 5) = wb(i+3, j, 5) - d4*predroe1b
      wb(i-4, j, 4) = wb(i-4, j, 4) + d4*predrow1b
      wb(i-3, j, 4) = wb(i-3, j, 4) - d3*predrow1b
      wb(i-2, j, 4) = wb(i-2, j, 4) + d2*predrow1b
      wb(i-1, j, 4) = wb(i-1, j, 4) - d1*predrow1b
      wb(i+1, j, 4) = wb(i+1, j, 4) - d2*predrow1b
      wb(i+2, j, 4) = wb(i+2, j, 4) + d3*predrow1b
      wb(i+3, j, 4) = wb(i+3, j, 4) - d4*predrow1b
      wb(i-4, j, 3) = wb(i-4, j, 3) + d4*predrov1b
      wb(i-3, j, 3) = wb(i-3, j, 3) - d3*predrov1b
      wb(i-2, j, 3) = wb(i-2, j, 3) + d2*predrov1b
      wb(i+1, j, 3) = wb(i+1, j, 3) - d2*predrov1b
      wb(i+2, j, 3) = wb(i+2, j, 3) + d3*predrov1b
      wb(i+3, j, 3) = wb(i+3, j, 3) - d4*predrov1b
      wb(i-4, j, 2) = wb(i-4, j, 2) + d4*predrou1b
      wb(i-3, j, 2) = wb(i-3, j, 2) - d3*predrou1b
      wb(i-2, j, 2) = wb(i-2, j, 2) + d2*predrou1b
      wb(i+1, j, 2) = wb(i+1, j, 2) - d2*predrou1b
      wb(i+2, j, 2) = wb(i+2, j, 2) + d3*predrou1b
      wb(i+3, j, 2) = wb(i+3, j, 2) - d4*predrou1b
      wb(i-4, j, 1) = wb(i-4, j, 1) + d4*predro1b
      wb(i-3, j, 1) = wb(i-3, j, 1) - d3*predro1b
      wb(i-2, j, 1) = wb(i-2, j, 1) + d2*predro1b
      wb(i+1, j, 1) = wb(i+1, j, 1) - d2*predro1b
      wb(i+2, j, 1) = wb(i+2, j, 1) + d3*predro1b
      wb(i+3, j, 1) = wb(i+3, j, 1) - d4*predro1b
      tempb0 = nx(i, j, 2)*fxroe2b
      tempb = ny(i, j, 2)*fxroe2b
      gb(i, j, 5) = gb(i, j, 5) + c1*tempb
      gb(i, j-1, 5) = gb(i, j-1, 5) + c1*tempb
      gb(i, j+1, 5) = gb(i, j+1, 5) + c2*tempb
      gb(i, j-2, 5) = gb(i, j-2, 5) + c2*tempb
      gb(i, j+2, 5) = gb(i, j+2, 5) + c3*tempb
      gb(i, j-3, 5) = gb(i, j-3, 5) + c3*tempb
      gb(i, j+3, 5) = gb(i, j+3, 5) + c4*tempb
      gb(i, j-4, 5) = gb(i, j-4, 5) + c4*tempb
      fb(i, j, 5) = fb(i, j, 5) + c1*tempb0
      fb(i, j-1, 5) = fb(i, j-1, 5) + c1*tempb0
      fb(i, j+1, 5) = fb(i, j+1, 5) + c2*tempb0
      fb(i, j-2, 5) = fb(i, j-2, 5) + c2*tempb0
      fb(i, j+2, 5) = fb(i, j+2, 5) + c3*tempb0
      fb(i, j-3, 5) = fb(i, j-3, 5) + c3*tempb0
      fb(i, j+3, 5) = fb(i, j+3, 5) + c4*tempb0
      fb(i, j-4, 5) = fb(i, j-4, 5) + c4*tempb0
      tempb0 = nx(i, j, 2)*fxrow2b
      tempb = ny(i, j, 2)*fxrow2b
      gb(i, j, 4) = gb(i, j, 4) + c1*tempb
      gb(i, j-1, 4) = gb(i, j-1, 4) + c1*tempb
      gb(i, j+1, 4) = gb(i, j+1, 4) + c2*tempb
      gb(i, j-2, 4) = gb(i, j-2, 4) + c2*tempb
      gb(i, j+2, 4) = gb(i, j+2, 4) + c3*tempb
      gb(i, j-3, 4) = gb(i, j-3, 4) + c3*tempb
      gb(i, j+3, 4) = gb(i, j+3, 4) + c4*tempb
      gb(i, j-4, 4) = gb(i, j-4, 4) + c4*tempb
      fb(i, j, 4) = fb(i, j, 4) + c1*tempb0
      fb(i, j-1, 4) = fb(i, j-1, 4) + c1*tempb0
      fb(i, j+1, 4) = fb(i, j+1, 4) + c2*tempb0
      fb(i, j-2, 4) = fb(i, j-2, 4) + c2*tempb0
      fb(i, j+2, 4) = fb(i, j+2, 4) + c3*tempb0
      fb(i, j-3, 4) = fb(i, j-3, 4) + c3*tempb0
      fb(i, j+3, 4) = fb(i, j+3, 4) + c4*tempb0
      fb(i, j-4, 4) = fb(i, j-4, 4) + c4*tempb0
      tempb0 = nx(i, j, 2)*fxrov2b
      tempb = ny(i, j, 2)*fxrov2b
      gb(i, j, 3) = gb(i, j, 3) + c1*tempb
      gb(i, j-1, 3) = gb(i, j-1, 3) + c1*tempb
      gb(i, j+1, 3) = gb(i, j+1, 3) + c2*tempb
      gb(i, j-2, 3) = gb(i, j-2, 3) + c2*tempb
      gb(i, j+2, 3) = gb(i, j+2, 3) + c3*tempb
      gb(i, j-3, 3) = gb(i, j-3, 3) + c3*tempb
      gb(i, j+3, 3) = gb(i, j+3, 3) + c4*tempb
      gb(i, j-4, 3) = gb(i, j-4, 3) + c4*tempb
      fb(i, j, 3) = fb(i, j, 3) + c1*tempb0
      fb(i, j-1, 3) = fb(i, j-1, 3) + c1*tempb0
      fb(i, j+1, 3) = fb(i, j+1, 3) + c2*tempb0
      fb(i, j-2, 3) = fb(i, j-2, 3) + c2*tempb0
      fb(i, j+2, 3) = fb(i, j+2, 3) + c3*tempb0
      fb(i, j-3, 3) = fb(i, j-3, 3) + c3*tempb0
      fb(i, j+3, 3) = fb(i, j+3, 3) + c4*tempb0
      fb(i, j-4, 3) = fb(i, j-4, 3) + c4*tempb0
      tempb0 = nx(i, j, 2)*fxrou2b
      tempb = ny(i, j, 2)*fxrou2b
      gb(i, j, 2) = gb(i, j, 2) + c1*tempb
      gb(i, j-1, 2) = gb(i, j-1, 2) + c1*tempb
      gb(i, j+1, 2) = gb(i, j+1, 2) + c2*tempb
      gb(i, j-2, 2) = gb(i, j-2, 2) + c2*tempb
      gb(i, j+2, 2) = gb(i, j+2, 2) + c3*tempb
      gb(i, j-3, 2) = gb(i, j-3, 2) + c3*tempb
      gb(i, j+3, 2) = gb(i, j+3, 2) + c4*tempb
      gb(i, j-4, 2) = gb(i, j-4, 2) + c4*tempb
      fb(i, j, 2) = fb(i, j, 2) + c1*tempb0
      fb(i, j-1, 2) = fb(i, j-1, 2) + c1*tempb0
      fb(i, j+1, 2) = fb(i, j+1, 2) + c2*tempb0
      fb(i, j-2, 2) = fb(i, j-2, 2) + c2*tempb0
      fb(i, j+2, 2) = fb(i, j+2, 2) + c3*tempb0
      fb(i, j-3, 2) = fb(i, j-3, 2) + c3*tempb0
      fb(i, j+3, 2) = fb(i, j+3, 2) + c4*tempb0
      fb(i, j-4, 2) = fb(i, j-4, 2) + c4*tempb0
      tempb0 = nx(i, j, 2)*fxro2b
      tempb = ny(i, j, 2)*fxro2b
      gb(i, j, 1) = gb(i, j, 1) + c1*tempb
      gb(i, j-1, 1) = gb(i, j-1, 1) + c1*tempb
      gb(i, j+1, 1) = gb(i, j+1, 1) + c2*tempb
      gb(i, j-2, 1) = gb(i, j-2, 1) + c2*tempb
      gb(i, j+2, 1) = gb(i, j+2, 1) + c3*tempb
      gb(i, j-3, 1) = gb(i, j-3, 1) + c3*tempb
      gb(i, j+3, 1) = gb(i, j+3, 1) + c4*tempb
      gb(i, j-4, 1) = gb(i, j-4, 1) + c4*tempb
      fb(i, j-1, 1) = fb(i, j-1, 1) + c1*tempb0
      fb(i, j+1, 1) = fb(i, j+1, 1) + c2*tempb0
      fb(i, j-2, 1) = fb(i, j-2, 1) + c2*tempb0
      fb(i, j+2, 1) = fb(i, j+2, 1) + c3*tempb0
      fb(i, j-3, 1) = fb(i, j-3, 1) + c3*tempb0
      fb(i, j+3, 1) = fb(i, j+3, 1) + c4*tempb0
      fb(i, j-4, 1) = fb(i, j-4, 1) + c4*tempb0
      tempb = ny(i, j, 1)*fxroe1b
      gb(i, j, 5) = gb(i, j, 5) + c1*tempb
      gb(i-1, j, 5) = gb(i-1, j, 5) + c1*tempb
      gb(i+1, j, 5) = gb(i+1, j, 5) + c2*tempb
      gb(i-2, j, 5) = gb(i-2, j, 5) + c2*tempb
      gb(i+2, j, 5) = gb(i+2, j, 5) + c3*tempb
      gb(i-3, j, 5) = gb(i-3, j, 5) + c3*tempb
      gb(i+3, j, 5) = gb(i+3, j, 5) + c4*tempb
      gb(i-4, j, 5) = gb(i-4, j, 5) + c4*tempb
      tempb = ny(i, j, 1)*fxrow1b
      gb(i, j, 4) = gb(i, j, 4) + c1*tempb
      gb(i-1, j, 4) = gb(i-1, j, 4) + c1*tempb
      gb(i+1, j, 4) = gb(i+1, j, 4) + c2*tempb
      gb(i-2, j, 4) = gb(i-2, j, 4) + c2*tempb
      gb(i+2, j, 4) = gb(i+2, j, 4) + c3*tempb
      gb(i-3, j, 4) = gb(i-3, j, 4) + c3*tempb
      gb(i+3, j, 4) = gb(i+3, j, 4) + c4*tempb
      gb(i-4, j, 4) = gb(i-4, j, 4) + c4*tempb
      tempb = ny(i, j, 1)*fxrov1b
      gb(i, j, 3) = gb(i, j, 3) + c1*tempb
      gb(i-1, j, 3) = gb(i-1, j, 3) + c1*tempb
      gb(i+1, j, 3) = gb(i+1, j, 3) + c2*tempb
      gb(i-2, j, 3) = gb(i-2, j, 3) + c2*tempb
      gb(i+2, j, 3) = gb(i+2, j, 3) + c3*tempb
      gb(i-3, j, 3) = gb(i-3, j, 3) + c3*tempb
      gb(i+3, j, 3) = gb(i+3, j, 3) + c4*tempb
      gb(i-4, j, 3) = gb(i-4, j, 3) + c4*tempb
      tempb = ny(i, j, 1)*fxrou1b
      gb(i, j, 2) = gb(i, j, 2) + c1*tempb
      gb(i-1, j, 2) = gb(i-1, j, 2) + c1*tempb
      gb(i+1, j, 2) = gb(i+1, j, 2) + c2*tempb
      gb(i-2, j, 2) = gb(i-2, j, 2) + c2*tempb
      gb(i+2, j, 2) = gb(i+2, j, 2) + c3*tempb
      gb(i-3, j, 2) = gb(i-3, j, 2) + c3*tempb
      gb(i+3, j, 2) = gb(i+3, j, 2) + c4*tempb
      gb(i-4, j, 2) = gb(i-4, j, 2) + c4*tempb
      tempb = nx(i, j, 1)*fxro1b
      fb(i, j, 1) = fb(i, j, 1) + c1*tempb0 + c1*tempb
      tempb0 = nx(i, j, 1)*fxroe1b
      fb(i, j, 5) = fb(i, j, 5) + c1*tempb0
      fb(i-1, j, 5) = fb(i-1, j, 5) + c1*tempb0
      fb(i+1, j, 5) = fb(i+1, j, 5) + c2*tempb0
      fb(i-2, j, 5) = fb(i-2, j, 5) + c2*tempb0
      fb(i+2, j, 5) = fb(i+2, j, 5) + c3*tempb0
      fb(i-3, j, 5) = fb(i-3, j, 5) + c3*tempb0
      fb(i+3, j, 5) = fb(i+3, j, 5) + c4*tempb0
      fb(i-4, j, 5) = fb(i-4, j, 5) + c4*tempb0
      tempb0 = nx(i, j, 1)*fxrow1b
      fb(i, j, 4) = fb(i, j, 4) + c1*tempb0
      fb(i-1, j, 4) = fb(i-1, j, 4) + c1*tempb0
      fb(i+1, j, 4) = fb(i+1, j, 4) + c2*tempb0
      fb(i-2, j, 4) = fb(i-2, j, 4) + c2*tempb0
      fb(i+2, j, 4) = fb(i+2, j, 4) + c3*tempb0
      fb(i-3, j, 4) = fb(i-3, j, 4) + c3*tempb0
      fb(i+3, j, 4) = fb(i+3, j, 4) + c4*tempb0
      fb(i-4, j, 4) = fb(i-4, j, 4) + c4*tempb0
      tempb0 = nx(i, j, 1)*fxrov1b
      fb(i, j, 3) = fb(i, j, 3) + c1*tempb0
      fb(i-1, j, 3) = fb(i-1, j, 3) + c1*tempb0
      fb(i+1, j, 3) = fb(i+1, j, 3) + c2*tempb0
      fb(i-2, j, 3) = fb(i-2, j, 3) + c2*tempb0
      fb(i+2, j, 3) = fb(i+2, j, 3) + c3*tempb0
      fb(i-3, j, 3) = fb(i-3, j, 3) + c3*tempb0
      fb(i+3, j, 3) = fb(i+3, j, 3) + c4*tempb0
      fb(i-4, j, 3) = fb(i-4, j, 3) + c4*tempb0
      tempb0 = nx(i, j, 1)*fxrou1b
      fb(i, j, 2) = fb(i, j, 2) + c1*tempb0
      fb(i-1, j, 2) = fb(i-1, j, 2) + c1*tempb0
      fb(i+1, j, 2) = fb(i+1, j, 2) + c2*tempb0
      fb(i-2, j, 2) = fb(i-2, j, 2) + c2*tempb0
      fb(i+2, j, 2) = fb(i+2, j, 2) + c3*tempb0
      fb(i-3, j, 2) = fb(i-3, j, 2) + c3*tempb0
      fb(i+3, j, 2) = fb(i+3, j, 2) + c4*tempb0
      fb(i-4, j, 2) = fb(i-4, j, 2) + c4*tempb0
      tempb0 = ny(i, j, 1)*fxro1b
      gb(i, j, 1) = gb(i, j, 1) + c1*tempb0
      gb(i-1, j, 1) = gb(i-1, j, 1) + c1*tempb0
      gb(i+1, j, 1) = gb(i+1, j, 1) + c2*tempb0
      gb(i-2, j, 1) = gb(i-2, j, 1) + c2*tempb0
      gb(i+2, j, 1) = gb(i+2, j, 1) + c3*tempb0
      gb(i-3, j, 1) = gb(i-3, j, 1) + c3*tempb0
      gb(i+3, j, 1) = gb(i+3, j, 1) + c4*tempb0
      gb(i-4, j, 1) = gb(i-4, j, 1) + c4*tempb0
      fb(i-1, j, 1) = fb(i-1, j, 1) + c1*tempb
      fb(i+1, j, 1) = fb(i+1, j, 1) + c2*tempb
      fb(i-2, j, 1) = fb(i-2, j, 1) + c2*tempb
      fb(i+2, j, 1) = fb(i+2, j, 1) + c3*tempb
      fb(i-3, j, 1) = fb(i-3, j, 1) + c3*tempb
      fb(i+3, j, 1) = fb(i+3, j, 1) + c4*tempb
      fb(i-4, j, 1) = fb(i-4, j, 1) + c4*tempb
    END DO
  END DO
  DO i=2,1,-1
    DO h=gh,1,-1
      gradvb(im-1+h, :, :) = gradvb(im-1+h, :, :) + two*gradvb(im+h, :, &
&       :)
      gradvb(im-2+h, :, :) = gradvb(im-2+h, :, :) - gradvb(im+h, :, :)
      gradvb(im+h, :, :) = 0.0_8
      gradub(im-1+h, :, :) = gradub(im-1+h, :, :) + two*gradub(im+h, :, &
&       :)
      gradub(im-2+h, :, :) = gradub(im-2+h, :, :) - gradub(im+h, :, :)
      gradub(im+h, :, :) = 0.0_8
      gradvb(2-h, :, :) = gradvb(2-h, :, :) + two*gradvb(1-h, :, :)
      gradvb(3-h, :, :) = gradvb(3-h, :, :) - gradvb(1-h, :, :)
      gradvb(1-h, :, :) = 0.0_8
      gradub(2-h, :, :) = gradub(2-h, :, :) + two*gradub(1-h, :, :)
      gradub(3-h, :, :) = gradub(3-h, :, :) - gradub(1-h, :, :)
      gradub(1-h, :, :) = 0.0_8
      gradvb(:, jm-1+h, :) = gradvb(:, jm-1+h, :) + two*gradvb(:, jm+h, &
&       :)
      gradvb(:, jm-2+h, :) = gradvb(:, jm-2+h, :) - gradvb(:, jm+h, :)
      gradvb(:, jm+h, :) = 0.0_8
      gradub(:, jm-1+h, :) = gradub(:, jm-1+h, :) + two*gradub(:, jm+h, &
&       :)
      gradub(:, jm-2+h, :) = gradub(:, jm-2+h, :) - gradub(:, jm+h, :)
      gradub(:, jm+h, :) = 0.0_8
      gradvb(:, 2-h, :) = gradvb(:, 2-h, :) + two*gradvb(:, 1-h, :)
      gradvb(:, 3-h, :) = gradvb(:, 3-h, :) - gradvb(:, 1-h, :)
      gradvb(:, 1-h, :) = 0.0_8
      gradub(:, 2-h, :) = gradub(:, 2-h, :) + two*gradub(:, 1-h, :)
      gradub(:, 3-h, :) = gradub(:, 3-h, :) - gradub(:, 1-h, :)
      gradub(:, 1-h, :) = 0.0_8
    END DO
  END DO
  velxb = 0.0_8
  velyb = 0.0_8
!$BWD-OF II-LOOP 
  DO j=1,jm
!$BWD-OF II-LOOP 
!DIR$ IVDEP
    DO i=1,im
      volm1 = one/vol(i, j)
      dxm1 = half*(nx(i, j, 1)+nx(i+1, j, 1))*volm1
      dxm2 = half*(nx(i, j, 2)+nx(i, j+1, 2))*volm1
      dym1 = half*(ny(i, j, 1)+ny(i+1, j, 1))*volm1
      dym2 = half*(ny(i, j, 2)+ny(i, j+1, 2))*volm1
      gvib = dym1*gradvb(i, j, 2) + dxm1*gradvb(i, j, 1)
      gvjb = dym2*gradvb(i, j, 2) + dxm2*gradvb(i, j, 1)
      gradvb(i, j, 2) = 0.0_8
      guib = dym1*gradub(i, j, 2) + dxm1*gradub(i, j, 1)
      gujb = dym2*gradub(i, j, 2) + dxm2*gradub(i, j, 1)
      gradub(i, j, 2) = 0.0_8
      gradvb(i, j, 1) = 0.0_8
      gradub(i, j, 1) = 0.0_8
      velyb(i, j+1) = velyb(i, j+1) + b1*gvjb
      velyb(i, j-1) = velyb(i, j-1) - b1*gvjb
      velyb(i, j+2) = velyb(i, j+2) + b2*gvjb
      velyb(i, j-2) = velyb(i, j-2) - b2*gvjb
      velyb(i, j+3) = velyb(i, j+3) + b3*gvjb
      velyb(i, j-3) = velyb(i, j-3) - b3*gvjb
      velyb(i, j+4) = velyb(i, j+4) + b4*gvjb
      velyb(i, j-4) = velyb(i, j-4) - b4*gvjb
      velxb(i, j+1) = velxb(i, j+1) + b1*gujb
      velxb(i, j-1) = velxb(i, j-1) - b1*gujb
      velxb(i, j+2) = velxb(i, j+2) + b2*gujb
      velxb(i, j-2) = velxb(i, j-2) - b2*gujb
      velxb(i, j+3) = velxb(i, j+3) + b3*gujb
      velxb(i, j-3) = velxb(i, j-3) - b3*gujb
      velxb(i, j+4) = velxb(i, j+4) + b4*gujb
      velxb(i, j-4) = velxb(i, j-4) - b4*gujb
      velyb(i+1, j) = velyb(i+1, j) + b1*gvib
      velyb(i-1, j) = velyb(i-1, j) - b1*gvib
      velyb(i+2, j) = velyb(i+2, j) + b2*gvib
      velyb(i-2, j) = velyb(i-2, j) - b2*gvib
      velyb(i+3, j) = velyb(i+3, j) + b3*gvib
      velyb(i-3, j) = velyb(i-3, j) - b3*gvib
      velyb(i+4, j) = velyb(i+4, j) + b4*gvib
      velyb(i-4, j) = velyb(i-4, j) - b4*gvib
      velxb(i+1, j) = velxb(i+1, j) + b1*guib
      velxb(i-1, j) = velxb(i-1, j) - b1*guib
      velxb(i+2, j) = velxb(i+2, j) + b2*guib
      velxb(i-2, j) = velxb(i-2, j) - b2*guib
      velxb(i+3, j) = velxb(i+3, j) + b3*guib
      velxb(i-3, j) = velxb(i-3, j) - b3*guib
      velxb(i+4, j) = velxb(i+4, j) + b4*guib
      velxb(i-4, j) = velxb(i-4, j) - b4*guib
    END DO
  END DO
  velzb = 0.0_8
!$BWD-OF II-LOOP 
  DO j=1-gh,jm+gh
!$BWD-OF II-LOOP 
!DIR$ IVDEP
    DO i=1-gh,im+gh
      ro = w(i, j, 1)
      rom1 = one/ro
      velx(i, j) = w(i, j, 2)*rom1
      vely(i, j) = w(i, j, 3)*rom1
      velz(i, j) = w(i, j, 4)*rom1
!
      ec = half*(velx(i, j)*velx(i, j)+vely(i, j)*vely(i, j)+velz(i, j)*&
&       velz(i, j))
! ec  = HALF*( velx(i,j)*velx(i,j) &
!            + vely(i,j)*vely(i,j))
!
      eloc = (w(i, j, 5)-ec*ro)*rom1
!
!
      p(i, j) = (gam-one)*ro*eloc
!  p(i,j)  = ro*rgaz*tloc(i,j)
      htot = (w(i, j, 5)+p(i, j))*rom1
      htotb = w(i, j, 3)*gb(i, j, 5) + w(i, j, 2)*fb(i, j, 5)
      pb(i, j) = pb(i, j) + gb(i, j, 3) + fb(i, j, 2) + rom1*htotb
      elocb = ro*(gam-one)*pb(i, j) + cvm1*tlocb(i, j)
      tempb = rom1*elocb
      wb(i, j, 5) = wb(i, j, 5) + rom1*htotb + tempb
      rob = eloc*(gam-one)*pb(i, j) - ec*tempb
      ecb = -(ro*tempb)
      tempb = half*ecb
      velyb(i, j) = velyb(i, j) + w(i, j, 3)*gb(i, j, 3) + w(i, j, 2)*fb&
&       (i, j, 3) + 2*vely(i, j)*tempb
      wb(i, j, 3) = wb(i, j, 3) + htot*gb(i, j, 5) + velz(i, j)*gb(i, j&
&       , 4) + vely(i, j)*gb(i, j, 3) + velx(i, j)*gb(i, j, 2) + gb(i, j&
&       , 1) + rom1*velyb(i, j)
      gb(i, j, 5) = 0.0_8
      velzb(i, j) = velzb(i, j) + w(i, j, 3)*gb(i, j, 4) + w(i, j, 2)*fb&
&       (i, j, 4) + 2*velz(i, j)*tempb
      gb(i, j, 4) = 0.0_8
      gb(i, j, 3) = 0.0_8
      velxb(i, j) = velxb(i, j) + w(i, j, 3)*gb(i, j, 2) + w(i, j, 2)*fb&
&       (i, j, 2) + 2*velx(i, j)*tempb
      gb(i, j, 2) = 0.0_8
      gb(i, j, 1) = 0.0_8
      wb(i, j, 2) = wb(i, j, 2) + htot*fb(i, j, 5) + velz(i, j)*fb(i, j&
&       , 4) + vely(i, j)*fb(i, j, 3) + velx(i, j)*fb(i, j, 2) + fb(i, j&
&       , 1) + rom1*velxb(i, j)
      fb(i, j, 5) = 0.0_8
      fb(i, j, 4) = 0.0_8
      fb(i, j, 3) = 0.0_8
      fb(i, j, 2) = 0.0_8
      fb(i, j, 1) = 0.0_8
      rom1b = (w(i, j, 5)+p(i, j))*htotb + (w(i, j, 5)-ec*ro)*elocb + w(&
&       i, j, 4)*velzb(i, j) + w(i, j, 3)*velyb(i, j) + w(i, j, 2)*velxb&
&       (i, j)
      pb(i, j) = 0.0_8
      tlocb(i, j) = 0.0_8
      wb(i, j, 4) = wb(i, j, 4) + rom1*velzb(i, j)
      velzb(i, j) = 0.0_8
      velyb(i, j) = 0.0_8
      velxb(i, j) = 0.0_8
      rob = rob - one*rom1b/ro**2
      wb(i, j, 1) = wb(i, j, 1) + rob
    END DO
  END DO
END SUBROUTINE FLUX_NUM_DNC7_EULER_NOWALL_2D_B
!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

